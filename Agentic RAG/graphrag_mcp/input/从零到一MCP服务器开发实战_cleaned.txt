# ä»é›¶åˆ°ä¸€MCPå¼€å‘ä¸éƒ¨ç½²å®æˆ˜

[toc]

- å…¬å¼€è¯¾ä»£ç é¢†å–

  

## ä¸€ã€MCPæŠ€æœ¯å…¥é—¨ä»‹ç»

### 1.æ™ºèƒ½ä½“å¼€å‘æ ¸å¿ƒæŠ€æœ¯â€”MCP

#### 1.1 **Function callingæŠ€æœ¯å›é¡¾**

â€‹	å¦‚ä½•å¿«é€Ÿå¼€å‘ä¸€æ¬¾æ™ºèƒ½ä½“åº”ç”¨ï¼Œæœ€å…³é”®çš„æŠ€æœ¯éš¾ç‚¹å°±åœ¨äºå¦‚ä½•è®©å¤§æ¨¡å‹é«˜æ•ˆç¨³å®šçš„æ¥å…¥ä¸€äº›å¤–éƒ¨å·¥å…·ã€‚è€Œåœ¨MCPæŠ€æœ¯è¯ç”Ÿä¹‹å‰ï¼Œæœ€ä¸»æµçš„æ–¹æ³•ï¼Œæ˜¯å€ŸåŠ©Function callingæŠ€æœ¯æ¥æ‰“é€šå¤§æ¨¡å‹å’Œå¤–éƒ¨å·¥å…·ä¹‹é—´çš„è”ç³»ï¼Œæ¢è€Œè¨€ä¹‹ï¼Œä¹Ÿå°±æ˜¯å€ŸåŠ©Function callingï¼Œæ¥è®©å¤§æ¨¡å‹çµæ´»çš„è°ƒç”¨å¤–éƒ¨å·¥å…·ã€‚

â€‹	ä¾‹å¦‚ä¸€ä¸ªå…¸å‹çš„Function callingç¤ºä¾‹ï¼Œæˆ‘ä»¬å¸Œæœ›è®©å¤§æ¨¡å‹èƒ½å¤Ÿè°ƒç”¨ä¸€äº›å¤©æ°”APIæŸ¥è¯¢å³æ—¶å¤©æ°”ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦åˆ›å»ºä¸€ä¸ªæŸ¥è¯¢å¤©æ°”çš„å¤–éƒ¨å‡½æ•°ï¼Œè´Ÿè´£è°ƒç”¨å¤©æ°”APIæ¥æŸ¥è¯¢å¤©æ°”ï¼ŒåŒæ—¶å°†å¤–éƒ¨å‡½æ•°çš„è¯´æ˜ä¼ é€’ç»™å¤§æ¨¡å‹ï¼Œä½¿å…¶èƒ½å¤Ÿæ ¹æ®ç”¨æˆ·æ„å›¾ï¼Œåœ¨å¿…è¦çš„æ—¶å€™å‘å¤–éƒ¨å‡½æ•°å‘èµ·è°ƒç”¨è¯·æ±‚ã€‚



> Function callingæœ€æ—©ç”±OpenAIä¸2023å¹´6æœˆ13å·æ­£å¼æå‡ºï¼Œè¯¥é¡¹æŠ€æœ¯çš„åå­—ä¹Ÿç”±æ­¤å‘½åï¼šhttps://openai.com/index/function-calling-and-other-api-updates/
>
> 
>
> æ­¤å¤–ï¼ŒFunction callingä¹Ÿè¢«ç§°ä½œtool useã€tool callç­‰æŠ€æœ¯ã€‚

â€‹	æ¯«æ— ç–‘é—®ï¼ŒFunction callingçš„è¯ç”Ÿæ„ä¹‰é‡å¤§ï¼Œè¿™é¡¹æŠ€æœ¯ç›®å‰ä¹Ÿæˆä¸ºå¤§æ¨¡å‹è°ƒç”¨å¤–éƒ¨å·¥å…·çš„åŸºæœ¬æŠ€æœ¯èŒƒå¼ï¼Œå“ªæ€•æ˜¯MCPç››è¡Œçš„ä»Šå¤©ï¼Œåº•å±‚ä»ç„¶æ˜¯Function callingæ‰§è¡Œæµç¨‹ã€‚

#### 1.2 **Function callingå…¬å¼€è¯¾ä»‹ç»**

â€‹	è€Œå¯¹äºå¤§æ¨¡å‹å¼€å‘è€…æ¥è¯´ï¼Œæ— è®ºæ˜¯é‡‡ç”¨ä½•ç§Agentå¼€å‘æ¡†æ¶æˆ–MCPæŠ€æœ¯ï¼ŒæŒæ¡Function callingçš„å®ç°æµç¨‹å’Œåº•å±‚åŸç†è‡³å…³é‡è¦ï¼Œå…·ä½“Function callingå®ç°åŸç†å¯ä»¥å‚è€ƒå…¬å¼€è¯¾ã€Šæ™ºèƒ½ä½“ä»ä½•è€Œæ¥ï¼Ÿæ·±åº¦è¯¦è§£å¤§æ¨¡å‹è°ƒç”¨å·¥å…·åº•å±‚åŸç†ã€‹ï¼šhttps://www.bilibili.com/video/BV1w6dBYxELA/ï¼Œè€Œå…³äºDeepSeekæ¨¡å‹Function callingå®ç°æµç¨‹ï¼Œå¯ä»¥å‚è€ƒå…¬å¼€è¯¾ã€ŠDeepSeekæ™ºèƒ½ä½“å¼€å‘å®æˆ˜ï¼Œä»é›¶æ‰‹æ“Mini Manusï¼ã€‹ï¼šhttps://www.bilibili.com/video/BV1L3ZDYDEnE/ã€‚

#### 1.3 **Function callingèƒ½åŠ›ä»ä½•è€Œæ¥**

â€‹	ä¸è¿‡ä¸ºäº†æ›´å¥½çš„å­¦ä¹ æœ¬æœŸå…¬å¼€è¯¾ï¼Œéœ€è¦é‡ç‚¹å¼ºè°ƒçš„æ˜¯å…³äºå¤§æ¨¡å‹çš„Function callingçš„èƒ½åŠ›å¦‚ä½•è€Œæ¥ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¯¹äºå½“å‰å¤§æ¨¡å‹æ¥è¯´ï¼Œæœ‰äº›æ¨¡å‹æœ‰Function callingèƒ½åŠ›ï¼Œå¦‚DeepSeek-V3æ¨¡å‹ï¼Œè€Œæœ‰äº›æ¨¡å‹æ²¡æœ‰ï¼Œå¦‚DeepSeek-R1æ¨¡å‹ï¼š



ç”šè‡³å¯¹äºDeepSeek-V3-0324æ¨¡å‹æ¥è¯´ï¼Œè¿˜æ”¯æŒå·¥å…·çš„å¹¶è”ã€ä¸²è”è°ƒç”¨ç”šè‡³æ˜¯è‡ªåŠ¨debugï¼š



> å…·ä½“ä»£ç å®ç°æµç¨‹å¯å‚è€ƒå…¬å¼€è¯¾ã€ŠDeepSeekæ™ºèƒ½ä½“å¼€å‘å®æˆ˜ï¼Œä»é›¶æ‰‹æ“Mini Manusï¼ã€‹ï¼šhttps://www.bilibili.com/video/BV1L3ZDYDEnE/ã€‚

é‚£æ¨¡å‹æ˜¯å¦‚ä½•å…·å¤‡Function callingèƒ½åŠ›çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯é€šè¿‡æ¨¡å‹è®­ç»ƒã€‚å¯¹äºDeepSeek-V3æ¨¡å‹æ¥è¯´ï¼Œç”±äºåœ¨è®­ç»ƒé˜¶æ®µï¼ˆæŒ‡ä»¤å¾®è°ƒé˜¶æ®µï¼‰å°±å¸¦å…¥äº†å¤§é‡çš„ç±»ä¼¼å¦‚ä¸‹çš„å·¥å…·è°ƒç”¨å¯¹è¯æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œå› æ­¤èƒ½å¤Ÿè¯†åˆ«å¤–éƒ¨å·¥å…·å¹¶å‘èµ·å¯¹å¤–éƒ¨å·¥å…·è°ƒç”¨çš„è¯·æ±‚ã€‚è€Œç±»ä¼¼çš„ï¼ŒR1æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹æ²¡æœ‰å·¥å…·è°ƒç”¨æ•°æ®ï¼Œå› æ­¤å°±ä¸å…·å¤‡Function callingèƒ½åŠ›ã€‚



> æ›´å¤šå…³äºFunction callingåŸç†ï¼Œå¯ä»¥å‚è€ƒå…¬å¼€è¯¾ã€Šæ™ºèƒ½ä½“ä»ä½•è€Œæ¥ï¼Ÿæ·±åº¦è¯¦è§£å¤§æ¨¡å‹è°ƒç”¨å·¥å…·åº•å±‚åŸç†ã€‹ï¼šhttps://www.bilibili.com/video/BV1w6dBYxELA/ï¼Œ

è€ŒFunction callingçš„èƒ½åŠ›ï¼Œæ˜¯å¤§æ¨¡å‹é¡ºåˆ©å¼€å¯MCPåŠŸèƒ½çš„åŸºç¡€ã€‚

#### 1.4 MCPæŠ€æœ¯æœ¬è´¨ï¼šFunction callingçš„æ›´é«˜å±‚å®ç°

â€‹	è€Œè¿‘ä¸€æ®µæ—¶é—´å¤§ç«çš„MCPæŠ€æœ¯ï¼Œå…¶å®å°±å¯ä»¥å°†å…¶ç†è§£ä¸ºFunction callingæŠ€æœ¯çš„æ›´é«˜å±‚å°è£…å’Œå®ç°ã€‚ä¼ ç»Ÿçš„Function callingæŠ€æœ¯è¦æ±‚å›´ç»•ä¸åŒçš„å¤–éƒ¨å·¥å…·APIå•ç‹¬åˆ›å»ºä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼Œç±»ä¼¼ä¸€æŠŠé”å•ç‹¬é…ä¸€æŠŠé’¥åŒ™ï¼Œè€Œä¸€ä¸ªæ™ºèƒ½ä½“åˆå¾€å¾€æ¶‰åŠåˆ°å¤šä¸ªå¤–éƒ¨å·¥å…·è®¾è®¡ï¼Œå› æ­¤å¼€å‘å·¥ä½œé‡å¾ˆå¤§ã€‚



è€ŒMCPæŠ€æœ¯ï¼Œå…¨ç§°ä¸ºModel Context Protocolï¼Œæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼Œæ˜¯ä¸€ç§å¼€å‘è€…å…±åŒéµå®ˆçš„åè®®ï¼Œåœ¨è¿™ä¸ªåè®®æ¡†æ¶ä¸‹ï¼Œå¤§å®¶å›´ç»•æŸä¸ªAPIå¼€å‘çš„å¤–éƒ¨å·¥å…·å°±èƒ½å¤Ÿå…±ç”¨ï¼Œä»è€Œå¤§å¹…å‡å°‘é‡å¤é€ è½®å­çš„æ—¶é—´ã€‚



#### 1.5 MCPæŠ€æœ¯å¸¦æ¥çš„æ™ºèƒ½ä½“å¼€å‘æ•ˆç‡é©å‘½

â€‹	ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨æˆ‘ä»¬å¼€è®¾çš„ã€Šå¤§æ¨¡å‹åŸç†ä¸å®æˆ˜è¯¾ç¨‹ã€‹ï¼šhttps://whakv.xetslk.com/s/3p66pNç³»åˆ—è¯¾ç¨‹ä¸­ï¼Œ2023å¹´çš„ç¬¬ä¸€æœŸè¯¾ç¨‹é‡Œæ›¾ç»è®²è§£è¿‡ä¸€ä¸ªAgentå®æˆ˜é¡¹ç›®ï¼Œ





å…¶ä¸­æ¶‰åŠå…³äºå¤§æ¨¡å‹å¯¹è¯é•¿çŸ­æœŸè®°å¿†å­˜å‚¨å’Œç®¡ç†ç›¸å…³åŠŸèƒ½å®ç°æ—¶ï¼Œå…‰æ˜¯ç¼–å†™æ¶ˆæ¯ç±»ï¼ˆMessagesï¼‰å¯¹è±¡çš„å„ç§æ“ä½œæ–¹æ³•ä»¥åŠå›´ç»•æœ¬åœ°æ–‡ä»¶å¤¹çš„å„ç±»æ“ä½œï¼Œå¦‚åˆ›å»ºã€åˆ é™¤ã€å†™å…¥æ–‡æ¡£ã€æ¸…ç©ºå¯¹è¯ã€ç»Ÿè®¡æ–‡æœ¬é•¿åº¦ç­‰ï¼Œå°±å†™äº†300å¤šè¡Œä»£ç ï¼š

<video src="https://ml2022.oss-cn-hangzhou.aliyuncs.com/452c6c9140ae5c41827d619c7f830241_raw.mp4"></video>

è€Œç°åœ¨ï¼Œå€ŸåŠ©MCPæŠ€æœ¯ï¼Œé‡‡ç”¨åˆ«äººå·²ç»å¼€å‘å¥½çš„Filesystemå·¥å…·ï¼Œä»…éœ€å‡ è¡Œä»£ç ï¼Œå¯¼å…¥å·¥å…·é…ç½®å³å¯å®ç°å®Œå…¨ç›¸åŒçš„åŠŸèƒ½ã€‚ç”±æ­¤Agentå¼€å‘æ•ˆç‡å¤§å¹…æé«˜ï¼Œè€Œè¿™å°±æ˜¯MCPæŠ€æœ¯æ­å»ºèµ·æ¥çš„åä½œä½“ç³»çš„åŠ›é‡ã€‚



### 2. MCPæœåŠ¡å™¨æ¥å…¥ç¤ºä¾‹

â€‹	è€Œåœ¨MCPæŠ€æœ¯å¤§çˆ†å‘çš„ä»Šå¤©ï¼Œæ¥å…¥ä¸€ä¸ªMCPå·¥å…·ä¹Ÿæ˜¯éå¸¸ç®€å•ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªå°†é«˜å¾·åœ°å›¾å¯¼èˆªMCPï¼ˆæœåŠ¡å™¨ï¼‰æ¥å…¥Cherry Studioï¼ˆå®¢æˆ·ç«¯ï¼‰çš„ç¤ºä¾‹ï¼š

<video src="https://ml2022.oss-cn-hangzhou.aliyuncs.com/2025-04-14%2014-29-22.mp4"></video>

> æˆ‘ä»¬å¯ä»¥æš‚æ—¶æŠŠMCPæœåŠ¡å™¨è§†ä½œMCPå·¥å…·ã€‚

æˆ‘ä»¬èƒ½çœ‹åˆ°ï¼Œç°åœ¨å¦‚æœæƒ³è¦æ¥å…¥ä¸€ä¸ªMCPå·¥å…·ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ”¯æŒMCPåŠŸèƒ½çš„å®¢æˆ·ç«¯ä¸­å†™å…¥ç›¸å…³é…ç½®å³å¯ã€‚ä¾‹å¦‚æˆ‘ä»¬åªéœ€è¦åœ¨Cherry Studioçš„MCPé…ç½®æ–‡æ¡£ä¸­å†™å…¥å¦‚ä¸‹å­—æ®µï¼š

```json
    "amap-maps": {
      "isActive": true,
      "command": "npx",
      "args": [
        "-y",
        "@amap/amap-maps-mcp-server"
      ],
      "env": {
        "AMAP_MAPS_API_KEY": "YOUR_API_KRY"
      },
      "name": "amap-maps"
    }
```



å³å¯è®©å¤§æ¨¡å‹è‡ªåŠ¨å…³è”é«˜å¾·MCPå·¥å…·ï¼ˆæœåŠ¡å™¨ï¼‰ï¼Œè€Œä¸€ä¸ªé«˜å¾·MCPæœåŠ¡å™¨çš„APIæœ‰å‡ åç§ä¹‹å¤šï¼š



å¯ä»¥è¯´æ˜¯è¦†ç›–äº†å‡ºè¡Œç”Ÿæ´»çš„æ”¾æ–¹é¢ã€‚è€Œå½“ä¸€ä¸ªå¤§æ¨¡å‹æ¥å…¥é«˜å¾·MCPæœåŠ¡å™¨åï¼Œå°±èƒ½ç¬é—´åŒ–èº«å‡ºè¡Œè§„åˆ’æ™ºèƒ½ä½“ã€‚

> æ›´å¤šå®¢æˆ·ç«¯æ¥å…¥æœåŠ¡å™¨æ–¹æ³•ï¼Œè¯¦è§å…¬å¼€è¯¾ã€Šé›¶é—¨æ§›æ¥å…¥MCPï¼Cursorã€é˜¿é‡Œäº‘ç™¾ç‚¼ã€Open-WebUIã€Cherry Studioæ¥å…¥10å¤§æœ€çƒ­é—¨MCPå·¥å…·ã€‹ï¼šhttps://www.bilibili.com/video/BV1dCo7YdEgK/

è€Œè¦çŸ¥é“çš„æ˜¯ï¼Œå¦‚æœæ²¡æœ‰MCPå·¥å…·ï¼Œæˆ‘ä»¬éœ€è¦å•ç‹¬å›´ç»•è¿™äº›APIå°†å…¶å°è£…ä¸ºä¸€ä¸ªä¸ªå¤–éƒ¨å‡½æ•°ï¼Œå†æ®æ­¤åˆ›å»ºä¸€ä¸ªå‡ºè¡Œè§„åˆ’æ™ºèƒ½ä½“ï¼Œå…¶å·¥ä½œé‡å¯æƒ³è€ŒçŸ¥ã€‚

### 3. MCPå·¥å…·æ ‡å‡†æ¥å…¥æµç¨‹

â€‹	åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œä¸€ä¸ªMCPæœåŠ¡å™¨æ ‡å‡†æ¥å…¥æµç¨‹æ˜¯é€šè¿‡å†™å…¥ä¸€ä¸ªé…ç½®æ–‡ä»¶æ¥å®Œæˆçš„ã€‚è€Œåœ¨æ”¯æŒMCPåŠŸèƒ½çš„å®¢æˆ·ç«¯ï¼ˆå¦‚Cherry Studioï¼‰ä¸­å†™å…¥MCPå·¥å…·çš„é…ç½®ï¼Œå…¶æœ¬è´¨å°±æ˜¯å…ˆå°†æŒ‡å®šçš„MCPå·¥å…·ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶ååœ¨æœ‰éœ€è¦çš„æ—¶å€™å¯¹å…¶è¿›è¡Œè°ƒç”¨ã€‚ä¾‹å¦‚é«˜å¾·MCPé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š

```json
    "amap-maps": {
      "isActive": true,
      "command": "npx",
      "args": [
        "-y",
        "@amap/amap-maps-mcp-server"
      ],
      "env": {
        "AMAP_MAPS_API_KEY": "YOUR_API_KRY"
      },
      "name": "amap-maps"
    }
```

ä»£è¡¨çš„å«ä¹‰å°±æ˜¯æˆ‘ä»¬éœ€è¦å…ˆä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š

```bash
npx -y @amap/amap-maps-mcp-server
```

å¯¹è¿™ä¸ªåº“`@amap/amap-maps-mcp-server`è¿›è¡Œä¸‹è½½ï¼Œç„¶ååœ¨æœ¬åœ°è¿è¡Œï¼Œå½“æœ‰å¿…è¦çš„æ—¶å€™è°ƒç”¨è¿™ä¸ªåº“é‡Œé¢çš„å‡½æ•°æ‰§è¡Œç›¸å…³åŠŸèƒ½ã€‚

â€‹	è€Œè¿™ä¸ª`@amap/amap-maps-mcp-server`åº“æ˜¯ä¸€ä¸ªæ‰˜ç®¡åœ¨https://www.npmjs.com/ä¸Šçš„åº“ï¼Œ



å¯ä»¥ä½¿ç”¨npxå‘½ä»¤è¿›è¡Œä¸‹è½½ã€‚æœç´¢åº“åå³å¯çœ‹åˆ°è¿™ä¸ªåº“çš„å®Œæ•´ä»£ç ï¼Œhttps://www.npmjs.com/package/@amap/amap-maps-mcp-serverï¼š



è€Œè¿™ç§é€šè¿‡é…ç½®æ–‡ä»¶æ¥è¿›è¡ŒMCPå·¥å…·ä¸‹è½½çš„æ–¹å¼ï¼Œæœ€æ—©ç”±Claudeï¼ˆMCPæŠ€æœ¯çš„æå‡ºè€…ï¼‰æå‡ºå¹¶è¢«å¹¿æ³›æ¥çº³ã€‚

### 4. MCPæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯

#### 4.1 MCPæœåŠ¡å™¨ï¼ˆserverï¼‰ä¸å®¢æˆ·ç«¯ï¼ˆclientï¼‰æ¦‚å¿µä»‹ç»

â€‹	åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒCherry Studioæ˜¯ä¸€ä¸ªæ”¯æŒMCPåŠŸèƒ½çš„å®¢æˆ·ç«¯ï¼Œè€Œæ¥å…¥çš„é«˜å¾·MCPæ˜¯ä¸€ä¸ªMCPæœåŠ¡å™¨ï¼Œè¿™é‡Œçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åˆæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ

â€‹	è¿™å…¶å®æ˜¯MCPæŠ€æœ¯ä½“ç³»ä¸­å¯¹äºå¤§æ¨¡å‹å’Œå¤–éƒ¨å·¥å…·çš„å¦ä¸€ç§åˆ’åˆ†æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨MCPæŠ€æœ¯ä½“ç³»ä¸­ï¼Œä¼šå°†å¤–éƒ¨å·¥å…·è¿è¡Œè„šæœ¬ç§°ä½œæœåŠ¡å™¨ï¼Œè€Œæ¥å…¥è¿™äº›å¤–éƒ¨å·¥å…·çš„å¤§æ¨¡å‹è¿è¡Œç¯å¢ƒç§°ä½œå®¢æˆ·ç«¯ã€‚



ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥æ¥å…¥å¤šä¸ªä¸åŒç±»å‹çš„æœåŠ¡å™¨çš„ï¼Œä½†è¦æ±‚æ˜¯éƒ½å¯ä»¥éµå¾ªMCPé€šä¿¡åè®®ã€‚ç®€å•ç†è§£å°±æ˜¯MCPæœåŠ¡å™¨çš„è¾“å‡ºå†…å®¹æ˜¯ä¸€ç§æ ‡å‡†æ ¼å¼çš„å†…å®¹ï¼Œåªèƒ½è¢«MCPå®¢æˆ·ç«¯æ‰€è¯†åˆ«ã€‚åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½éµå¾ªMCPåè®®çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯å°±èƒ½å¤ŸåƒFunction callingä¸­å¤§æ¨¡å‹è°ƒç”¨å¤–éƒ¨å·¥å…·ä¸€æ ·ï¼Œè°ƒç”¨MCPæœåŠ¡å™¨é‡Œé¢çš„å·¥å…·ã€‚



#### 4.2 MCPæœåŠ¡å™¨é›†åˆ

â€‹	æš‚æ—¶æŠ›å¼€åº•å±‚åŸç†ä¸è°ˆï¼Œåœ¨MCPæŠ€æœ¯çˆ†å‘çš„è¿™å‡ ä¸ªæœˆï¼Œå¸‚é¢ä¸Šå·²ç»è¯ç”Ÿäº†æˆç™¾ä¸Šåƒçš„MCPæœåŠ¡å™¨ï¼Œç”šè‡³è¿˜å‡ºç°äº†å¤§é‡çš„MCPæœåŠ¡å™¨é›†åˆç½‘ç«™ï¼š

- MCPå®˜æ–¹æœåŠ¡å™¨åˆé›†ï¼šhttps://github.com/modelcontextprotocol/servers

  

- MCP Githubçƒ­é—¨å¯¼èˆªï¼šhttps://github.com/punkpeye/awesome-mcp-servers

  

- Smitheryï¼šhttps://smithery.ai/

  

- MCPå¯¼èˆªï¼šhttps://mcp.so/

  

åœ¨å®é™…è¿›è¡Œæ™ºèƒ½ä½“å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒè¿™äº›ç½‘ç«™ä¸Šçš„MCPå·¥å…·ï¼Œå¹¶æœ‰é€‰æ‹©çš„å¯¹å…¶è¿›è¡Œè°ƒç”¨ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ— è®ºè¿™äº›ç½‘ç«™çš„ç»„ç»‡å½¢å¼å¤šä¹ˆèŠ±æ ·ç™¾å‡ºï¼Œä½†å®é™…ä¸Šå½“æˆ‘ä»¬æœ¬åœ°è°ƒç”¨MCPå·¥å…·çš„æ—¶å€™ï¼Œéƒ½æ˜¯é€šè¿‡uvxæˆ–è€…npxå°†å¯¹åº”çš„åº“ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åå†è¿›è¡Œè¿è¡Œã€‚

### 5. MCPä¸Function callingæŠ€æœ¯å¯¹æ¯”ä»‹ç»

â€‹	æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¡¥å……ä¸€ç‚¹çš„æ˜¯å…³äºFunction callingå’ŒMCPæŠ€æœ¯çš„å…³ç³»ã€‚é€šè¿‡åœ¨MCPè¿è¡Œè¿‡ç¨‹çš„æŠ“åŒ…å¯çŸ¥ï¼ŒMCPåº•å±‚å®é™…ä¸Šä»ç„¶æ˜¯å€ŸåŠ©å¤§æ¨¡å‹åŸç”Ÿçš„Function callingæ¥å®Œæˆå¤–éƒ¨å·¥å…·è°ƒç”¨ï¼Œåªä¸è¿‡è¿›è¡Œäº†æ›´é«˜å±‚çš„å°è£…ã€‚



å®é™…ä¸ŠMCPå®¢æˆ·ç«¯å¯¹MCPæœåŠ¡å™¨ä¸Šçš„å·¥å…·è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š

- **Step 1. å»ºç«‹å’ŒæœåŠ¡å™¨çš„é€šä¿¡**ï¼›
- **Step 2. æŸ¥è¯¢æœåŠ¡å™¨ä¸Šæ€»å…±æœ‰å¤šå°‘ä¸ªå¤–éƒ¨å·¥å…·ï¼›**
- **Step 3. å°†å¤–éƒ¨å·¥å…·ç»„æˆåˆ—è¡¨ï¼Œå¸¦å…¥åˆ°å½“å‰å¯¹è¯ä¸­ï¼›**
- **Step 4. å€ŸåŠ©Function callingè¿›è¡Œå¤–éƒ¨å·¥å…·è°ƒç”¨ã€‚**

ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ¨¡å‹æœ¬èº«ä¸æ”¯æŒFunction callingï¼Œé‚£ä¹ˆæ˜¯æ— æ³•é¡ºåˆ©å¼€å¯MCPåŠŸèƒ½çš„ã€‚

â€‹	ä¸è¿‡è¿™é‡Œä¹Ÿæœ‰ä¾‹å¤–ï¼Œé‚£å°±æ˜¯Open-WebUIå’Œclineä½œä¸ºMCPå®¢æˆ·ç«¯æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸å…·å¤‡Function callingåŠŸèƒ½çš„DeepSeek-R1æ¨¡å‹è¿›è¡ŒMCPå·¥å…·è°ƒç”¨ï¼Œè¿™æ˜¯ä¸ºä½•å‘¢ï¼Ÿ

â€‹	åŸå› éå¸¸ç®€å•ï¼Œé‚£å°±æ˜¯è¿™äº›å®¢æˆ·ç«¯å†…ç½®äº†ä¸€äº›æç¤ºè¯æ¨¡æ¿ï¼Œå€ŸåŠ©æç¤ºè®©å¤§æ¨¡å‹è¾“å‡ºç±»ä¼¼Function call messageï¼ˆè°ƒç”¨å¤–éƒ¨å·¥å…·çš„ä¿¡æ¯ï¼‰çš„å†…å®¹ï¼Œç„¶åå¼€å¯Function callingï¼Œä»è€Œèƒ½å¤Ÿè°ƒç”¨MCPå·¥å…·ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºclineæ¥è¯´ä¼šé€šè¿‡ä¸€æ®µéå¸¸é•¿çš„æç¤ºè¯ï¼Œå¼•å¯¼æ¨¡å‹è¾“å‡ºFunction call messageï¼š



>  clineé¡¹ç›®å®˜ç½‘ï¼šhttps://github.com/cline/cline

æˆ‘ä»¬å¯ä»¥å°†å…¶ç²¾ç®€ä¸ºå¦‚ä¸‹å½¢å¼ï¼š

```python
system_message = (
    "You are a helpful assistant with access to these tools:\n\n"
    f"{tools_description}\n"
    "Choose the appropriate tool based on the user's question. "
    "If no tool is needed, reply directly.\n\n"
    "IMPORTANT: When you need to use a tool, you must ONLY respond with "
    "the exact JSON object format below, nothing else:\n"
    "{\n"
    '    "tool": "tool-name",\n'
    '    "arguments": {\n'
    '        "argument-name": "value"\n'
    "    }\n"
    "}\n\n"
    "After receiving a tool's response:\n"
    "1. Transform the raw data into a natural, conversational response\n"
    "2. Keep responses concise but informative\n"
    "3. Focus on the most relevant information\n"
    "4. Use appropriate context from the user's question\n"
    "5. Avoid simply repeating the raw data\n\n"
    "Please use only the tools that are explicitly defined above."
)
```

ç¿»è¯‘å¦‚ä¸‹ï¼š

````markdown
ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š

```
{tools_description}
```

è¯·æ ¹æ®ç”¨æˆ·çš„é—®é¢˜é€‰æ‹©åˆé€‚çš„å·¥å…·ã€‚  
å¦‚æœä¸éœ€è¦ä½¿ç”¨å·¥å…·ï¼Œè¯·ç›´æ¥å›å¤ã€‚

é‡è¦æç¤ºï¼šå¦‚æœéœ€è¦ä½¿ç”¨å·¥å…·ï¼Œ**ä½ å¿…é¡»ä»…ä»¥ä»¥ä¸‹ç²¾ç¡®çš„ JSON å¯¹è±¡æ ¼å¼è¿›è¡Œå›å¤ï¼Œä¸è¦æ·»åŠ å…¶ä»–å†…å®¹**ï¼š

```json
{
    "tool": "å·¥å…·åç§°",
    "arguments": {
        "å‚æ•°åç§°": "å‚æ•°å€¼"
    }
}
```

åœ¨æ”¶åˆ°å·¥å…·è¿”å›çš„ç»“æœåï¼š

1. å°†åŸå§‹æ•°æ®è½¬åŒ–ä¸ºè‡ªç„¶ã€å¯¹è¯å¼çš„å›ç­”  
2. ä¿æŒå›ç­”ç®€æ´ä½†å¯Œæœ‰ä¿¡æ¯é‡  
3. èšç„¦äºæœ€ç›¸å…³çš„ä¿¡æ¯  
4. ä½¿ç”¨ç”¨æˆ·é—®é¢˜ä¸­çš„ç›¸å…³ä¸Šä¸‹æ–‡  
5. é¿å…ç›´æ¥ç…§æ¬åŸå§‹æ•°æ®

è¯·**åªä½¿ç”¨ä¸Šè¿°æ˜ç¡®å®šä¹‰çš„å·¥å…·**ã€‚
````

åœ¨è¿™äº›æç¤ºè¯å¼•å¯¼ä¸‹ï¼Œä¸€äº›ä¸å…·å¤‡Function callingçš„å¤§æ¨¡å‹ï¼Œä¹Ÿèƒ½é¡ºåˆ©ä½¿ç”¨MCPå·¥å…·ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå€ŸåŠ©æç¤ºè¯å¼€å¯çš„MCPåŠŸèƒ½ï¼Œæ¯•ç«Ÿä¸å¦‚æ¨¡å‹åŸç”Ÿèƒ½åŠ›ç¨³å®šï¼Œå› æ­¤å¦‚æœå¸Œæœ›æ­å»ºä¼ä¸šçº§åº”ç”¨çš„Agentï¼Œæœ€å¥½è¿˜æ˜¯ä½¿ç”¨å…·å¤‡Function callingåŠŸèƒ½çš„å¤§æ¨¡å‹ã€‚

### 6. MCPæŠ€æœ¯ç”Ÿæ€

â€‹	æœ€åéœ€è¦ä»‹ç»å½“å‰MCPå®Œæ•´çš„æŠ€æœ¯ç”Ÿæ€ã€‚MCPæŠ€æœ¯å‘å±•è‡³ä»Šï¼Œå·²ç»ä¸å†æ˜¯ç®€å•çš„â€œåè®®â€ï¼Œè€Œæ˜¯ä¸€ä¸ªåŒ…å«äº†åè®®ã€å¼€å‘å·¥å…·å’Œç°æˆçš„å·²ç»å¼€å‘å¥½çš„MCPå·¥å…·æ‰€å…±åŒç»„æˆçš„å®Œæ•´æŠ€æœ¯ç”Ÿæ€ã€‚



å…¶ä¸­ï¼š

- **MCPåè®®ï¼š**æŒ‡çš„æ˜¯â€œè™šâ€çš„è§„èŒƒï¼Œä¾‹å¦‚å¤§æ¨¡å‹å’Œå·¥å…·è°ƒåº¦è§„èŒƒã€æœåŠ¡å™¨å®¢æˆ·ç«¯çš„é€šä¿¡è§„èŒƒç­‰ï¼Œéµå¾ªè¿™äº›åè®®çš„å¯¹è±¡å°±æ˜¯MCPæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ï¼›
- **MCPå¼€å‘å·¥å…·ï¼š**åŒ…å«å¤šç§è¯­è¨€çš„SDKï¼Œä¹Ÿå°±æ˜¯å¼€å‘å·¥å…·åŒ…ï¼Œå¼€å‘äººå‘˜èƒ½å¤Ÿä½¿ç”¨è¿™äº›SDKå¿«é€Ÿå®ŒæˆMCPçš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¼€å‘ï¼›
- **MCPæœåŠ¡å™¨ç”Ÿæ€ï¼š**å¼€æºçš„MCPæœåŠ¡å™¨ï¼Œæ˜¯åŸºäºMCPåè®®çš„åºå¤§çš„æŠ€æœ¯ç”Ÿæ€ï¼Œæ™ºèƒ½ä½“å¼€å‘äººå‘˜å¯ä»¥ç›´æ¥ä½¿ç”¨å¼€æºçš„MCPå·¥å…·æ¥åŠ å¿«å¼€å‘è¿›ç¨‹ã€‚

- å…¬å¼€è¯¾ä»£ç é¢†å–



## äºŒã€ä»é›¶åˆ°ä¸€è¿›è¡ŒMCPé¡¹ç›®å¼€å‘

â€‹	åœ¨åŸºæœ¬äº†è§£MCPæŠ€æœ¯æ¦‚å¿µä¹‹åï¼Œæ¥ä¸‹æ¥ä¸ºå¤§å®¶è¯¦ç»†ä»‹ç»å¦‚ä½•ä»é›¶åˆ°ä¸€å®ŒæˆMCPé¡¹ç›®å¼€å‘ã€‚æ ¹æ®æ­¤å‰çš„ä»‹ç»ä¸éš¾å‘ç°ï¼ŒMCPé¡¹ç›®å¼€å‘ä¼šæ¶‰åŠä¸¤ä¸ªæ–¹é¢ï¼Œåˆ†åˆ«æ˜¯MCPå®¢æˆ·ç«¯å¼€å‘å’ŒæœåŠ¡å™¨å¼€å‘ï¼Œæœ¬èŠ‚å…¬å¼€è¯¾æˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»MCPæœåŠ¡å™¨å¼€å‘ï¼ŒåŒæ—¶ä¸ºå¤§å®¶æä¾›ä¸€ä¸ªé€šç”¨çš„å®¢æˆ·ç«¯æ¨¡æ¿ã€‚

### 1. MCPæœåŠ¡å™¨å¼€å‘æµç¨‹ä»‹ç»

â€‹	MCPæœåŠ¡å™¨é€šç”¨å¼€å‘æµç¨‹å¦‚ä¸‹ï¼š

- **Step 1.åˆ›å»ºåŠŸèƒ½å‡½æ•°ï¼Œå¹¶åœ¨ä»£ç ç¯å¢ƒä¸­å®Œæˆæµ‹è¯•ï¼›**
- **Step 2.åˆ›å»ºMCPæœåŠ¡å™¨é¡¹ç›®ï¼Œå®ŒæˆæœåŠ¡å™¨é¡¹ç›®å¼€å‘ï¼›**
- **Step 3.å€ŸåŠ©MCPå®˜æ–¹å·¥å…·Inspectorè¿›è¡ŒMCPæœåŠ¡å™¨debugï¼›**
- **Step 4.å€ŸåŠ©MCPå®¢æˆ·ç«¯ï¼Œè¿›è¡Œæœ¬åœ°é€šä¿¡æµ‹è¯•**
- **Step 5.ã€å¯é€‰ã€‘å°†MCPæœåŠ¡å™¨å‘å¸ƒåˆ°npmæˆ–è€…pypiå¹³å°ï¼Œä¾›å…¶ä»–å¼€å‘äººå‘˜ä½¿ç”¨ï¼›**
- **Step 6.ã€å¯é€‰ã€‘å°†MCPæœåŠ¡å™¨é¡¹ç›®ç¦»çº¿æ‹·è´å¹¶åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚**



æ¥ä¸‹æ¥æˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»è¿™6ä¸ªç¯èŠ‚çš„å®ç°æ–¹æ³•ã€‚

### 2. MCP Serveræ ¸å¿ƒåŠŸèƒ½å¼€å‘

#### 2.1 Mini DeepResearché¡¹ç›®ä»‹ç»

â€‹	åœ¨è§„åˆ’MCPæœåŠ¡å™¨é¡¹ç›®å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç¡®å®šå½“å‰MCPæœåŠ¡å™¨çš„æ ¸å¿ƒåŠŸèƒ½ã€‚æˆ‘ä»¬è¿™é‡Œå°è¯•åˆ›å»ºä¸€ä¸ªæ­¤å‰å…¬å¼€è¯¾ä»‹ç»çš„Mini DeepResearché¡¹ç›®çš„MCPæœåŠ¡å™¨ï¼Œå³ä¸€ä¸ªé›†æˆäº†Mini DeepResearchåŠŸèƒ½çš„MCPæœåŠ¡å™¨ï¼Œèƒ½å¤Ÿå›´ç»•ç”¨æˆ·ç»™å‡ºçš„ä¸»é¢˜è¿›è¡Œæ·±åº¦æœç´¢ï¼Œå¹¶ç»™å‡ºæœ€ç»ˆç»“æœã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†æŠŠMini DeepResearchå°è£…ä¸ºMCPæœåŠ¡å™¨ï¼Œä¸€æ–¹é¢è¯¦ç»†ä»‹ç»MCP Serverå¼€å‘æµç¨‹ï¼ŒåŒæ—¶ä¹Ÿä»‹ç»**å¦‚ä½•å°†ä¸€ä¸ªMulti-Agentå°è£…ä¸ºMCP serverå¹¶å¸¦å…¥åˆ°å…¶ä»–åº”ç”¨åœºæ™¯ä¸­ã€‚**

- é¡¹ç›®æ•ˆæœæ¼”ç¤º

â€‹	é¡¹ç›®æ•ˆæœç±»ä¼¼äºChatGPT DeepResearchåŠŸèƒ½ï¼Œå…·ä½“é¡¹ç›®æ¼”ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š

<video src="https://ml2022.oss-cn-hangzhou.aliyuncs.com/Mini%20DeepResearch%E6%BC%94%E7%A4%BA.mp4"></video>

æ­¤æ—¶è¾“å…¥ï¼š`ä½ å¥½ï¼Œæˆ‘æƒ³äº†è§£ä¸‹MCPï¼ˆModel Context Protocolï¼‰è¿™é¡¹æŠ€æœ¯`

è¾“å‡ºï¼š

```markdown
# MCPï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰æŠ€æœ¯æ·±å…¥è§£ææŠ¥å‘Š

æœ¬æ–‡æ—¨åœ¨å¯¹ MCPï¼ˆModel Protocol Contextï¼Œæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰æŠ€æœ¯è¿›è¡Œå…¨é¢è€Œæ·±å…¥çš„è§£æã€‚ä»å…¶æŠ€æœ¯èƒŒæ™¯ã€å‘å±•å†ç¨‹ã€æ ¸å¿ƒæ¶æ„ï¼Œåˆ°åº”ç”¨é¢†åŸŸå’Œæœªæ¥å‘å±•è¶‹åŠ¿ï¼Œæœ¬æ–‡å°†ä»¥è¯¦ç»†çš„è¯´æ˜å’Œå®ä¾‹åˆ†æï¼Œå¸®åŠ©è¯»è€…å¯¹ MCP æŠ€æœ¯æœ‰ä¸€ä¸ªé€å½»çš„è®¤è¯†ã€‚

---

## 1. å¼•è¨€

éšç€äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰çš„è¿…é€Ÿå‘å±•å’Œå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æ™®åŠï¼Œä¼ ç»Ÿçš„ä¾èµ–é™æ€è®­ç»ƒæ•°æ®çš„æ¨¡å¼é€æ¸æš´éœ²å‡ºå±€é™æ€§ã€‚AI æ¨¡å‹åœ¨é¢å¯¹å¤æ‚ã€åŠ¨æ€çš„åº”ç”¨åœºæ™¯æ—¶ï¼ŒäºŸéœ€ä¸€ç§èƒ½å¤Ÿå®æ—¶é“¾æ¥å¤–éƒ¨æ•°æ®æºå’Œå·¥å…·çš„æŠ€æœ¯æ–¹æ¡ˆã€‚MCPï¼Œå³æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼Œæ­£æ˜¯åœ¨è¿™ç§èƒŒæ™¯ä¸‹åº”è¿è€Œç”Ÿã€‚MCP æä¾›äº†æ ‡å‡†åŒ–çš„æ¥å£ï¼Œä½¿ AI æ¨¡å‹å¯ä»¥å®‰å…¨ã€ä¾¿æ·åœ°ä¸å¤–éƒ¨ç³»ç»Ÿè¿›è¡Œæ•°æ®äº¤äº’å’ŒåŠŸèƒ½è°ƒç”¨ã€‚æœ¬æ–‡å°†è¯¦ç»†æ¢è®¨ MCP çš„æŠ€æœ¯æ¶æ„ã€æ ¸å¿ƒä¼˜åŠ¿ã€å®é™…åº”ç”¨æ¡ˆä¾‹åŠæœªæ¥å±•æœ›ã€‚

---

## 2. MCP æŠ€æœ¯çš„èµ·æºä¸å‘å±•

MCP æŠ€æœ¯æœ€åˆç”± Anthropic å…¬å¸æå‡ºï¼Œä½œä¸ºä¸€ç§å¼€æ”¾æ ‡å‡†åè®®ï¼Œå…¶ç›®æ ‡åœ¨äºè§£å†³ AI æ¨¡å‹ä¿¡æ¯è·å–å—é™ä»¥åŠå®šåˆ¶æ¥å£å¼€å‘æˆæœ¬é«˜æ˜‚çš„é—®é¢˜ã€‚ä¼ ç»Ÿçš„å¤§å‹è¯­è¨€æ¨¡å‹ä»…ä»…ä¾é ä¹‹å‰çš„è®­ç»ƒæ•°æ®è¿›è¡Œé—®ç­”æˆ–ç”Ÿæˆå†…å®¹ï¼Œè€Œä¸€æ—¦é‡åˆ°åº”ç”¨åœºæ™¯ä¸­æ–°äº§ç”Ÿçš„æ•°æ®æˆ–éœ€æ±‚ï¼Œå°±ä¼šé™·å…¥ä¿¡æ¯æ›´æ–°æ»åçš„å°´å°¬ã€‚MCP åè®®é€šè¿‡æä¾›ä¸€ç§æ ‡å‡†åŒ–çš„é€šä¿¡æ–¹æ³•ï¼Œå®ç°äº† AI æ¨¡å‹ä¸å¤–éƒ¨æ•°æ®æºå’Œå·¥å…·çš„æ— ç¼è¡”æ¥ã€‚

### 2.1 èƒŒæ™¯ä»‹ç»

- **AI å‘å±•å¸¦æ¥çš„æ–°è¦æ±‚**ï¼šéšç€ç®—æ³•å’Œç®—åŠ›çš„æå‡ï¼ŒAI æ¨¡å‹åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ã€å›¾åƒè¯†åˆ«ã€åŒ»å­¦å½±åƒåˆ†æç­‰é¢†åŸŸå±•ç°äº†å“è¶Šçš„èƒ½åŠ›ã€‚ç„¶è€Œï¼Œè¿™äº›æ¨¡å‹çš„è®­ç»ƒæ•°æ®ç›¸å¯¹é™æ€ï¼Œéš¾ä»¥å®æ—¶åæ˜ ç°å®ä¸–ç•Œä¸­å¤§é‡åŠ¨æ€å˜åŒ–çš„ä¿¡æ¯ã€‚MCP çš„è®¾è®¡åˆè¡·å°±æ˜¯ä¸ºäº†è§£å†³è¿™ç±»é™æ€æ•°æ®ä¸åŠ¨æ€åº”ç”¨ä¹‹é—´çš„è„±èŠ‚é—®é¢˜ã€‚
- **ä¼ ç»Ÿæ¥å£çš„å±€é™æ€§**ï¼šåœ¨ä¼ ç»Ÿåº”ç”¨ä¸­ï¼Œå¼€å‘è€…é€šå¸¸éœ€è¦ä¸ºæ¯ä¸ªå¤–éƒ¨æ•°æ®æºæˆ–å·¥å…·ç¼–å†™ä¸“é—¨çš„æ¥å£ï¼Œé€ æˆäº†å¼€å‘å‘¨æœŸé•¿ã€æ¥å£ç¢ç‰‡åŒ–çš„é—®é¢˜ã€‚MCP çš„å‡ºç°ä½¿å¾—å„ç±»æ•°æ®æºå¯ä»¥é€šè¿‡ç»Ÿä¸€å…¥å£è¢« AI æ¨¡å‹è°ƒç”¨ï¼Œå¤§å¹…é™ä½äº†å¼€å‘è€…çš„é›†æˆæˆæœ¬ã€‚

### 2.2 å‘å±•å†ç¨‹

è‡ªæå‡ºä»¥æ¥ï¼ŒMCP è¿…é€Ÿå¼•èµ·å„ç•Œå…³æ³¨ã€‚ä»æœ€åˆçš„æ ‡å‡†æ„æ¶åˆ°ç›®å‰æ”¯æŒ STDIO ä¸ HTTP+SSE ä¸¤ç§æ•°æ®ä¼ è¾“æ–¹å¼ï¼ŒMCP æ­£åœ¨ä¸æ–­å®Œå–„è‡ªèº«çš„åè®®è§„èŒƒï¼Œæ”¯æŒæ›´å¤šæ ·åŒ–çš„æ•°æ®äº¤äº’æ¨¡å¼ã€‚å­¦æœ¯ç•Œå’Œå·¥ä¸šç•Œçº·çº·å¼€å±•é’ˆå¯¹ MCP çš„ç ”ç©¶å’Œåº”ç”¨ï¼ŒåŠ›æ±‚æ›´å¥½åœ°ä¸ç°æœ‰ç³»ç»Ÿé›†æˆï¼Œä»è€Œæ¨åŠ¨ AI æ¨¡å‹çš„åº”ç”¨è¾¹ç•Œä¸æ–­æ‹“å®½ã€‚

---

## 3. MCP çš„æŠ€æœ¯åŸç†ä¸æ¶æ„

MCP åè®®é‡‡ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹ï¼Œç”±ä¸‰å¤§æ ¸å¿ƒç»„ä»¶æ„æˆï¼šMCP ä¸»æœºã€MCP å®¢æˆ·ç«¯ä»¥åŠ MCP æœåŠ¡å™¨ã€‚è¿™ä¸€æ¨¡å‹ç¡®ä¿ AI æ¨¡å‹èƒ½å¤Ÿé€šè¿‡æ ‡å‡†åŒ–æ¥å£ä¸å¤–éƒ¨å·¥å…·æˆ–æ•°æ®æºè¿›è¡Œé«˜æ•ˆäº¤äº’ã€‚

### 3.1 æ ¸å¿ƒç»„ä»¶

- **MCP ä¸»æœº**ï¼šé€šå¸¸æŒ‡è¿è¡Œåœ¨æ¡Œé¢ç‰ˆå·¥å…·ã€é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰æˆ– AI è¾…åŠ©åº”ç”¨ä¸­çš„ä¸»ç¨‹åºï¼Œè´Ÿè´£å‘èµ·ä¸å¤–éƒ¨ç³»ç»Ÿçš„è¿æ¥è¯·æ±‚ã€‚
- **MCP å®¢æˆ·ç«¯**ï¼šä½äºä¸»æœºç¨‹åºå†…éƒ¨ï¼Œå’Œ MCP æœåŠ¡å™¨ä¿æŒ 1:1 çš„è¿æ¥å…³ç³»ï¼Œæ‰§è¡Œåè®®å±‚é¢çš„æ¶ˆæ¯ä¼ é€’å’Œå“åº”å¤„ç†ã€‚
- **MCP æœåŠ¡å™¨**ï¼šç‹¬ç«‹çš„è½»é‡çº§ç¨‹åºï¼Œé€šè¿‡æ ‡å‡†åŒ–çš„ MCP æ¥å£ï¼Œè¿æ¥å„ç§æœ¬åœ°æˆ–è¿œç¨‹çš„æ•°æ®æºä¸å¤–éƒ¨æœåŠ¡ï¼Œå¹¶æŒ‰ç…§åè®®è¦æ±‚æä¾›ç›¸åº”çš„åŠŸèƒ½ã€‚

### 3.2 åè®®é€šä¿¡æœºåˆ¶

MCP åè®®é‡‡ç”¨ JSON-RPC 2.0 æ ¼å¼å®šä¹‰æ¶ˆæ¯ä¼ è¾“ï¼Œç¡®ä¿é€šä¿¡å†…å®¹å…·æœ‰æ¸…æ™°çš„è¯·æ±‚ä¸å“åº”é€»è¾‘ã€‚ä¸»è¦åŒ…å«ä»¥ä¸‹ä¸¤ç§ä¼ è¾“æ–¹å¼ï¼š

- **STDIO ä¼ è¾“**ï¼šåˆ©ç”¨æ ‡å‡†è¾“å…¥è¾“å‡ºæµå®Œæˆæ•°æ®ä¼ è¾“ï¼Œå…·æœ‰ä½å»¶è¿Ÿçš„ä¼˜ç‚¹ï¼Œé€‚ç”¨äºé«˜æ•ˆé€šä¿¡éœ€æ±‚çš„åœºæ™¯ã€‚
- **HTTP+SSE ä¼ è¾“**ï¼šé€šè¿‡ HTTP åè®®ç»“åˆæœåŠ¡å™¨å‘é€äº‹ä»¶ï¼ˆServer-Sent Eventsï¼‰ï¼Œå®ç°å®æ—¶æ•°æ®æµå’Œé•¿è¿æ¥é€šä¿¡ï¼Œé€‚åˆäºè·¨ç½‘ç»œç¯å¢ƒçš„æ•°æ®åŒæ­¥å’Œæ›´æ–°ã€‚

è¿™ç§çµæ´»çš„é€šä¿¡æœºåˆ¶ä¸ä»…æ»¡è¶³äº†é«˜æ€§èƒ½åº”ç”¨çš„è¦æ±‚ï¼Œä¹Ÿä¸ºå¼€å‘è€…å…è®¸å®ç°å®šåˆ¶çš„ä¼ è¾“æ–¹å¼æä¾›äº†å¯èƒ½æ€§ï¼Œä½†å‰ææ˜¯å¿…é¡»ä¿ç•™ MCP æŒ‡å®šçš„æ¶ˆæ¯æ ¼å¼å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†è¦æ±‚ã€‚

### 3.3 æ¶ˆæ¯äº¤æ¢å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†

MCP åè®®é‡‡ç”¨æ˜ç¡®çš„æ¶ˆæ¯å¸§æ ¼å¼ï¼Œå¯¹è¯·æ±‚ã€å“åº”ã€é€šçŸ¥ç­‰å¤šç§æ¶ˆæ¯æ¨¡å¼è¿›è¡Œäº†è¯¦ç»†å®šä¹‰ã€‚æ•´ä¸ªé€šä¿¡ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ï¼š

1. **åˆå§‹åŒ–é˜¶æ®µ**ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œå¹¶è¿›è¡Œèº«ä»½è®¤è¯å’ŒåŠŸèƒ½åå•†ã€‚
2. **æ¶ˆæ¯äº¤æ¢é˜¶æ®µ**ï¼šåœ¨è¿æ¥ä¿æŒæœŸé—´ï¼ŒåŒæ–¹é€šè¿‡è¯·æ±‚-å“åº”æ¨¡å‹æˆ–æ¨é€é€šçŸ¥æ¨¡å¼è¿›è¡Œæ•°æ®ä¼ è¾“å’ŒæŒ‡ä»¤äº¤äº’ã€‚
3. **ç»ˆæ­¢é˜¶æ®µ**ï¼šå½“é€šä¿¡ä»»åŠ¡å®Œæˆæˆ–å‡ºç°å¼‚å¸¸æ—¶ï¼Œå®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ç»ˆæ­¢è¿æ¥ï¼Œå¹¶è¿›è¡Œèµ„æºå›æ”¶ã€‚

è¿™ç§è®¾è®¡ç¡®ä¿äº†é€šä¿¡çš„ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œæå¤§åœ°é™ä½äº†ç³»ç»Ÿé›†æˆçš„å¤æ‚æ€§ã€‚

---

## 4. MCP çš„å…³é”®ä¼˜åŠ¿ä¸åº”ç”¨åœºæ™¯

### 4.1 å…³é”®ä¼˜åŠ¿

- **ç»Ÿä¸€æ ‡å‡†**ï¼šMCP æä¾›äº†å¼€æ”¾ã€ç»Ÿä¸€çš„é€šä¿¡æ¥å£ï¼Œè§£å†³äº†ä¼ ç»Ÿ API æ¥å£ç¢ç‰‡åŒ–çš„é—®é¢˜ï¼Œä½¿å¾—ä¸åŒç³»ç»Ÿä¹‹é—´çš„é›†æˆæ›´åŠ ç®€å•é«˜æ•ˆã€‚
- **åŠ¨æ€æ•°æ®äº¤äº’**ï¼šå€ŸåŠ© MCPï¼ŒAI æ¨¡å‹å¯ä»¥åœ¨è¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€è·å–å¤–éƒ¨æ•°æ®ï¼Œè€Œä¸å†å±€é™äºé¢„å…ˆè®­ç»ƒæ•°æ®çš„å†…å®¹ï¼Œè¿™å¤§å¤§æå‡äº†æ¨¡å‹çš„å®ç”¨æ€§å’Œæ™ºèƒ½åŒ–æ°´å¹³ã€‚
- **å®‰å…¨æ€§ä¸ç”¨æˆ·æ§åˆ¶**ï¼šMCP çš„è®¾è®¡å¼ºè°ƒç”¨æˆ·å¯¹æ•°æ®äº¤äº’çš„æ§åˆ¶æƒï¼Œé€šè¿‡æ ‡å‡†åŒ–å’Œä¸¥æ ¼çš„è®¤è¯æœºåˆ¶ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿éšœäº†æ•°æ®å®‰å…¨å’Œéšç§ä¿æŠ¤ã€‚
- **æ‰©å±•æ€§å¼º**ï¼šæƒ åŠå¤šç§ä¼ è¾“æ–¹å¼å’Œåº”ç”¨åœºæ™¯ï¼Œä¸è®ºæ˜¯æœ¬åœ°æ•°æ®è®¿é—®è¿˜æ˜¯è¿œç¨‹æœåŠ¡è°ƒç”¨ï¼Œéƒ½èƒ½å¤Ÿçµæ´»é€‚é…ã€‚

### 4.2 åº”ç”¨åœºæ™¯

#### 4.2.1 è½¯ä»¶å¼€å‘ä¸è°ƒè¯•

åœ¨è½¯ä»¶å¼€å‘é¢†åŸŸï¼Œé›†æˆäº† MCP çš„ç¼–ç å·¥å…·èƒ½å¤Ÿè‡ªåŠ¨è¯»å–å’Œä¿®æ”¹ä»£ç åº“ï¼Œåˆ©ç”¨å®æ—¶æ•°æ®è¿›è¡Œé™æ€æ£€æŸ¥å’Œä»£ç ä¼˜åŒ–ï¼Œä»è€Œæå‡å¼€å‘æ•ˆç‡ã€‚ä¾‹å¦‚ï¼ŒIDE é€šå¸¸ä¼šé›†æˆ MCP å®¢æˆ·ç«¯ï¼Œå®ç°è‡ªåŠ¨åŒ–é”™è¯¯æç¤ºå’Œä¿®æ­£å»ºè®®ã€‚

#### 4.2.2 æ•°æ®ç§‘å­¦ä¸å®‰å…¨å®¡è®¡

æ•°æ®ç§‘å­¦å®¶å¯ä»¥é€šè¿‡ MCP å®‰å…¨åœ°æŸ¥è¯¢å†…éƒ¨æ•°æ®åº“æˆ–è€…è°ƒç”¨å¤§æ•°æ®å¹³å°æ¥å£ï¼Œæ— éœ€æš´éœ²åº•å±‚æ•æ„Ÿå‡­æ®ã€‚åŒæ—¶ï¼ŒMCP åè®®æ”¯æŒå®‰å…¨å®¡è®¡æœºåˆ¶ï¼Œå‡å°‘äº†å®‰å…¨å®¡è®¡é¡¹ï¼Œä»è€Œé™ä½ç³»ç»Ÿç»´æŠ¤æˆæœ¬ã€‚

#### 4.2.3 åŒ»ç–—ä¸å¥åº·ç®¡ç†

åœ¨åŒ»ç–—é¢†åŸŸï¼ŒåŒ»ç–—ç³»ç»Ÿé€šè¿‡ MCP åè®®æ•´åˆæ‚£è€…ç”Ÿç†æ•°æ®ã€å½±åƒä¿¡æ¯åŠå®éªŒå®¤æ£€æµ‹ç»“æœï¼Œç”Ÿæˆæ›´ä¸ºç²¾ç¡®çš„è¯Šæ–­æŠ¥å‘Šã€‚è¿™ç§è·¨ç³»ç»Ÿçš„æ•°æ®æ•´åˆï¼Œæ˜¾è‘—æå‡äº†åŒ»ç–—å†³ç­–çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ã€‚

#### 4.2.4 äº‘å¹³å°ä¸å¤šé›†ç¾¤ç®¡ç†

éƒ¨åˆ†äº‘å¹³å°ï¼Œå¦‚åä¸ºäº‘çš„å¤šäº‘å®¹å™¨å¹³å°ï¼Œå·²ç»å¼€å§‹å€ŸåŠ© MCP å®ç°è·¨äº‘å’Œå¤šé›†ç¾¤çš„ç»Ÿä¸€ç®¡ç†ã€‚é€šè¿‡ MCPï¼Œä¼ä¸šå¯ä»¥å®ç°åº”ç”¨åœ¨å¤šé›†ç¾¤é—´çš„åŠ¨æ€éƒ¨ç½²å’Œå¼¹æ€§ä¼¸ç¼©ï¼Œæœ‰æ•ˆè§£å†³å¤šäº‘ç¯å¢ƒä¸‹åº”ç”¨ç®¡ç†å’Œèµ„æºè°ƒåº¦çš„æŒ‘æˆ˜ã€‚

---

## 5. æ¡ˆä¾‹åˆ†æä¸æŠ€æœ¯æ¯”è¾ƒ

### 5.1 å®é™…åº”ç”¨æ¡ˆä¾‹

ä»¥æŸä¸‰ç”²åŒ»é™¢çš„åŒ»ç–—ä¿¡æ¯ç³»ç»Ÿä¸ºä¾‹ï¼Œé€šè¿‡å¼•å…¥ MCPï¼ŒåŒ»é™¢å¤§å¤§ç¼©çŸ­äº†åŒ»ç–—å½±åƒç³»ç»Ÿä¸ç”µå­ç—…å†å¯¹æ¥çš„å‘¨æœŸã€‚ä»¥å‰éœ€è¦æ•°æœˆæ—¶é—´å®Œæˆçš„æ•°æ®å¯¹æ¥ï¼Œå¦‚ä»Šå¯åœ¨çŸ­çŸ­å‡ å¤©å†…å®ç°ï¼Œæ—¢æé«˜äº†åŒ»ç–—æœåŠ¡æ•ˆç‡ï¼Œä¹Ÿé™ä½äº†ç³»ç»Ÿçš„é›†æˆæˆæœ¬ã€‚

### 5.2 ä¸ä¼ ç»Ÿ API çš„æ¯”è¾ƒ

ä¼ ç»Ÿ API æ¥å£å¾€å¾€éœ€è¦é’ˆå¯¹æ¯ä¸ªæ•°æ®æºè¿›è¡Œå•ç‹¬å¼€å‘å’Œç»´æŠ¤ï¼Œå­˜åœ¨å®šåˆ¶æˆæœ¬é«˜ã€é€‚é…æ€§å·®ç­‰é—®é¢˜ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒMCP çš„æ ‡å‡†åŒ–æ¥å£èƒ½å¤Ÿå¿«é€Ÿå¯¹æ¥å„ç§å¤–éƒ¨å·¥å…·å’Œæ•°æ®æºï¼Œæå¤§åœ°æå‡äº† AI æ¨¡å‹åœ¨å®é™…åœºæ™¯ä¸­çš„å“åº”é€Ÿåº¦å’Œå‡†ç¡®æ€§ã€‚

---

## 6. MCP æŠ€æœ¯çš„å‘å±•è¶‹åŠ¿ä¸é¢ä¸´çš„æŒ‘æˆ˜

### 6.1 å‘å±•è¶‹åŠ¿

éšç€æŠ€æœ¯ä¸æ–­æ¼”è¿›ï¼ŒMCP æ­£åœ¨å‘æ›´é«˜çš„é›†æˆåŒ–å’Œæ™ºèƒ½åŒ–æ–¹å‘å‘å±•ã€‚æœªæ¥çš„å‘å±•è¶‹åŠ¿ä¸»è¦åŒ…æ‹¬ï¼š

- **æ ‡å‡†çš„ä¸æ–­å®Œå–„**ï¼šéšç€è¶Šæ¥è¶Šå¤šçš„å¼€å‘è€…å’Œä¼ä¸šå‚ä¸ï¼ŒMCP çš„åè®®è§„èŒƒå°†è¿›ä¸€æ­¥ç»†åŒ–ï¼Œæ¶µç›–æ›´å¤šåº”ç”¨åœºæ™¯ã€‚
- **è·¨å¹³å°çš„å¹¿æ³›åº”ç”¨**ï¼šMCP çš„ç»Ÿä¸€æ ‡å‡†ä¸ä»…é€‚ç”¨äºæ¡Œé¢å·¥å…·å’Œäº‘å¹³å°ï¼Œè¿˜å°†æ‰©å±•åˆ°ç§»åŠ¨è®¾å¤‡ã€ç‰©è”ç½‘è®¾å¤‡ç­‰å„ç±»ç»ˆç«¯ä¸­ã€‚
- **å¤šæ™ºèƒ½ä½“åä½œ**ï¼šæœªæ¥çš„ AI åº”ç”¨å°†è¶Šæ¥è¶Šä¾èµ–å¤šä¸ªæ¨¡å‹ä¹‹é—´çš„ååŒå·¥ä½œï¼ŒMCP å°†ä¸ºè¿™äº›å¤šæ™ºèƒ½ä½“ç³»ç»Ÿæä¾›é«˜æ•ˆçš„ä¸Šä¸‹æ–‡ä¼ é€’å’ŒçŠ¶æ€åŒæ­¥èƒ½åŠ›ã€‚
- **å®‰å…¨æ€§ä¸éšç§ä¿æŠ¤è¿›ä¸€æ­¥åŠ å¼º**ï¼šåœ¨æ•°æ®å®‰å…¨å’Œç”¨æˆ·éšç§æ–¹é¢ï¼ŒMCP å°†å¼•å…¥æ›´å¤šå…ˆè¿›çš„åŠ å¯†å’Œè®¤è¯æŠ€æœ¯ï¼Œä»¥æ»¡è¶³æ—¥ç›Šä¸¥æ ¼çš„å®‰å…¨éœ€æ±‚ã€‚

### 6.2 é¢ä¸´çš„æŒ‘æˆ˜

å°½ç®¡ MCP æŠ€æœ¯å…·å¤‡è¯¸å¤šä¼˜åŠ¿ï¼Œä½†åœ¨æ¨å¹¿å’Œåº”ç”¨è¿‡ç¨‹ä¸­ä»é¢ä¸´ä¸€äº›æŒ‘æˆ˜ï¼š

- **æŠ€æœ¯æ™®åŠå’Œæ ‡å‡†ç»Ÿä¸€**ï¼šä½œä¸ºæ–°å…´æŠ€æœ¯ï¼ŒMCP éœ€è¦æ›´å¤šçš„è¡Œä¸šå‚ä¸è€…å’Œå¼€å‘è€…æ”¯æŒï¼Œæ‰èƒ½å½¢æˆç»Ÿä¸€çš„æ ‡å‡†ç”Ÿæ€ã€‚
- **å…¼å®¹æ€§ä¸æ‰©å±•æ€§å¹³è¡¡**ï¼šåœ¨è®¾è®¡ä¸Šï¼Œå¦‚ä½•åœ¨ä¿è¯æ ‡å‡†åŒ–çš„åŒæ—¶ï¼Œåˆèƒ½çµæ´»åº”å¯¹ä¸åŒåº”ç”¨çš„ç‰¹æ®Šéœ€æ±‚ï¼Œæ˜¯ MCP éœ€è¦è§£å†³çš„é—®é¢˜ã€‚
- **å®‰å…¨æ€§ä¿éšœ**ï¼šåœ¨è·¨å¹³å°ã€è·¨ç³»ç»Ÿæ•°æ®äº¤äº’è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•ç¡®ä¿æ•°æ®ä¸è¢«æ³„éœ²å¹¶ä¸¥æ ¼æ§åˆ¶è®¿é—®æƒé™ï¼Œæ˜¯æŠ€æœ¯å®ç°ä¸­çš„é‡ç‚¹å’Œéš¾ç‚¹ã€‚

---

## 7. æ€»ç»“ä¸å±•æœ›

MCPï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰ä½œä¸ºä¸€ç§å‰æ²¿çš„å¼€æ”¾æ ‡å‡†åè®®ï¼Œé€šè¿‡æ ‡å‡†åŒ–çš„æ¥å£ï¼Œå®ç°äº† AI æ¨¡å‹ä¸å¤–éƒ¨æ•°æ®æºå’Œå·¥å…·ä¹‹é—´é«˜æ•ˆã€å®‰å…¨çš„äº¤äº’ã€‚æœ¬æ–‡ä» MCP çš„èµ·æºã€æŠ€æœ¯æ¶æ„ã€ä¼˜åŠ¿ã€åº”ç”¨æ¡ˆä¾‹åŠæœªæ¥å‘å±•è¶‹åŠ¿ç­‰å¤šä¸ªæ–¹é¢è¿›è¡Œäº†è¯¦ç»†é˜è¿°ï¼Œå±•ç¤ºäº†å…¶åœ¨è½¯ä»¶å¼€å‘ã€åŒ»ç–—ä¿¡æ¯ç³»ç»Ÿã€äº‘å¹³å°ç®¡ç†ç­‰é¢†åŸŸçš„æ½œåœ¨ä»·å€¼ã€‚

å¯ä»¥é¢„è§ï¼Œåœ¨ AI åº”ç”¨ä¸æ–­æ·±å…¥å’Œåœºæ™¯æ—¥ç›Šå¤æ‚çš„èƒŒæ™¯ä¸‹ï¼ŒMCP æœ‰æœ›æˆä¸ºè¿æ¥é™æ€æ¨¡å‹ä¸åŠ¨æ€æ•°æ®çš„é‡è¦æ¡¥æ¢ï¼Œæ¨åŠ¨äººå·¥æ™ºèƒ½è¿ˆå‘æ›´åŠ æ™ºèƒ½å’Œé«˜æ•ˆçš„æœªæ¥ã€‚é¢å¯¹æœªæ¥ï¼Œè¡Œä¸šå†…å„æ–¹éœ€è¦è¿›ä¸€æ­¥ååŒåˆä½œï¼Œå®Œå–„æ ‡å‡†ã€æå‡å®‰å…¨é˜²æŠ¤ï¼Œå¹¶ä¸æ–­æ‰©å±•åè®®çš„åº”ç”¨é¢†åŸŸï¼Œå…±åŒæ¢ç´¢ MCP æŠ€æœ¯çš„æœ€ä½³å®è·µå’Œå‘å±•è·¯å¾„ã€‚

---

## å‚è€ƒæ–‡çŒ®ä¸è¿›ä¸€æ­¥é˜…è¯»

1. [æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆWikipediaï¼‰](https://zh.wikipedia.org/wiki/%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE)
2. [Model Context Protocol å®˜æ–¹æ–‡æ¡£](https://modelcontextprotocol.info/zh-cn/docs/introduction/)
3. [æœ‰å…³ MCP åœ¨ AI é›†æˆä¸­çš„åº”ç”¨æ¢è®¨](https://blog.eimoon.com/p/mcp-introduction/?utm_source=openai)

---

*æ³¨ï¼šæœ¬æ–‡ä¸»è¦èšç„¦äº MCP ä½œä¸ºä¸€é¡¹å¼€æ”¾æ ‡å‡†åè®®çš„æŠ€æœ¯ä½“ç³»ï¼Œä¸åŒé¢†åŸŸä¸­åŒæ ·ç¼©å†™ä¸º MCP çš„å…¶ä»–æŠ€æœ¯ï¼ˆå¦‚å¤šèŠ¯ç‰‡å°è£…ã€å¾®é€šé“æ¿ï¼‰åˆ™å±äºæˆªç„¶ä¸åŒçš„æŠ€æœ¯ä½“ç³»ï¼Œè¯»è€…åœ¨æŸ¥é˜…ç›¸å…³æ–‡çŒ®æ—¶éœ€æ³¨æ„åŒºåˆ†ã€‚*
```

- è¯¾ä»¶é¢†å–

Mini DeepResearchå…¬å¼€è¯¾èµ„æ–™è§æœ¬èŠ‚å…¬å¼€è¯¾ç½‘ç›˜ï¼š







- Mini DeepResearchæŠ€æœ¯æ ˆ

â€‹	Mini DeepResearchä»¥OpenAIæ¨¡å‹åŠå¼€æºAgents SDKæ¡†æ¶ä¸ºä¸»è¿›è¡Œçš„å¼€å‘ï¼Œå®é™…è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦è¾“å…¥OpenAI API-KEYã€‚OpenAI API-KEYè·å–æ–¹æ³•è¯¦è§è¯¾ä»¶ä¸­çš„å‚è€ƒèµ„æ–™ã€ŠOpenAIæ³¨å†ŒæŒ‡å—ã€‹éƒ¨åˆ†ï¼Œæ­¤å¤–ä¹Ÿå¯ä»¥ç›´æ¥åœ¨æŸå®ä¸Šè´­ä¹°å®˜æ–¹API-KEYã€‚æ­¤å¤–ï¼Œé¡¹ç›®ä¸­è‡ªå¸¦å›½å†…åå‘ä»£ç†åœ°å€ï¼Œæ— éœ€é¢å¤–ç½‘ç»œé—¨æ§›å³å¯ä½¿ç”¨ã€‚

> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¿…é¡»è¦ä½¿ç”¨OpenAIå®˜æ–¹API-KEYæ‰èƒ½è¿è¡Œé¡¹ç›®ï¼Œä¸­è½¬API-KEYæ— æ³•è¿è¡Œã€‚

- Mini DeepResearchå‘½ä»¤è¡Œå¿«é€Ÿä¸Šæ‰‹ä½¿ç”¨

â€‹	åœ¨è¯¾ä»¶ä¸­ä¸‹è½½MiniDeepResearch.zipå‹ç¼©åŒ…å¹¶è§£å‹ç¼©ï¼Œç„¶åå³å¯åœ¨ä¸»ç›®å½•ä¸‹è¿è¡Œè¯¥é¡¹ç›®ï¼š



éœ€è¦æå‰å®‰è£…openaiåº“å’Œagentsåº“

```bash
pip install openai openai-agents
```

å¹¶ä¸”åœ¨ä¸‰ä¸ª_agent.pyæ–‡ä»¶ä¸­å†™å…¥å›½å†…åå‘ä»£ç†åœ°å€å’ŒOpenAIå®˜æ–¹API-KEYï¼Œç„¶åè¾“å…¥å¦‚ä¸‹å‘½ä»¤å³å¯è¿è¡Œï¼š

```bash
python -m ChatBot.main
```

#### 2.2 Mini DeepResearché¡¹ç›®æ¶æ„ä»‹ç»

â€‹	æ¥ä¸‹æ¥è®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾è¿™ä¸ªMulti-Agentç³»ç»Ÿæ ¸å¿ƒä»£ç ç»“æ„ã€‚Mini DeepResearchä¸»è¦ç”±ä¸‰ä¸ªAgentæ„æˆï¼š

| Agent           | åŠŸèƒ½                                    |
| --------------- | --------------------------------------- |
| `planner_agent` | ç”Ÿæˆç ”ç©¶å…³é”®è¯å’Œæœç´¢ç­–ç•¥                |
| `search_agent`  | è´Ÿè´£æ‰§è¡Œç½‘ç»œæœç´¢ + æ€»ç»“å†…å®¹ï¼ˆä½¿ç”¨å·¥å…·ï¼‰ |
| `writer_agent`  | æ±‡æ€»æ‰€æœ‰æœç´¢ç»“æœï¼Œç¼–å†™æŠ¥å‘Š              |

å¹¶ä¸”å®é™…è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸‰ä¸ªAgentç»„æˆä¸€ä¸ªçº¿æ€§çš„workflowè¿›è¡Œè¿è¡Œï¼š



è¿™å…¶å®æ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„Multi-Agentç³»ç»Ÿï¼Œå¹¶ä¸”åœ¨æœ€æ–°GPT-4.1å’Œo4-miniæ¨¡å‹åŠ æŒä¸‹ï¼Œä»¥åŠæ­é…å¼€æºçš„Agents-SDKæ¡†æ¶å’ŒGPTæ¨¡å‹åŸç”Ÿçš„ç½‘ç»œæœç´¢åŠŸèƒ½ï¼Œèƒ½å¤Ÿéå¸¸é«˜æ•ˆç¨³å®šçš„å®ç°ç±»DeepResearchåŠŸèƒ½ã€‚

â€‹	æ¥ä¸‹æ¥æˆ‘ä»¬é€ä¸ªä»‹ç»è¿™ä¸‰ä¸ªAgentä»£ç å®ç°ã€‚ä»¥ä¸‹ä»£ç å‡åœ¨Jupyterä¸­å®Œæˆæµ‹è¯•ï¼Œä»£ç è¯¾ä»¶è¯¦è§ï¼š







#### 2.3 planner_agentåŠŸèƒ½å®ç°

- åŸºç¡€ä¾èµ–åº“å®‰è£…

```bash
pip install openai openai-agents
```

- åŸºç¡€ä»£ç æµ‹è¯•

â€‹	è¿™é‡Œé¦–å…ˆéœ€è¦è®¾ç½®åŸºç¡€Agents-SDKå¼€å‘ç¯å¢ƒå¹¶è¿›è¡Œç®€å•æµ‹è¯•ï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š

```python
from openai import AsyncOpenAI
from agents import OpenAIChatCompletionsModel,Agent,Runner,set_default_openai_client, set_tracing_disabled
from agents.model_settings import ModelSettings
from pydantic import BaseModel
from agents import Agent, WebSearchTool
from agents.model_settings import ModelSettings
import os
from dotenv import load_dotenv
load_dotenv(override=True)

external_client = AsyncOpenAI(
    base_url = os.getenv("BASE_URL"),
    api_key = os.getenv("API_KEY"), 
)
set_default_openai_client(external_client)
set_tracing_disabled(True)
agent = Agent(name="Assistant", instructions="ä½ æ˜¯ä¸€ååŠ©äººä¸ºä¹çš„åŠ©æ‰‹ã€‚")
result = await Runner.run(agent, "è¯·å†™ä¸€é¦–å…³äºç¼–ç¨‹ä¸­é€’å½’çš„ä¿³å¥ã€‚") 
print(result.final_output)
```

è¿™é‡Œéœ€è¦åœ¨base_urlä¸­å¡«å†™å›½å†…åå‘ä»£ç†åœ°å€ï¼Œéœ€è¦åœ¨api_keyä¸­å¡«å†™OpenAIçš„API-KEYã€‚å®é™…è¿è¡Œç»“æœå¦‚ä¸‹ï¼š



- planner_agentä»£ç è¯¦è§£ä¸åŠŸèƒ½ä»‹ç»

â€‹	æ¥ä¸‹æ¥åˆ›å»ºplanner_agentï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```python
PROMPT = (
    "You are a helpful research assistant. Given a query, come up with a set of web searches "
    "to perform to best answer the query. Output between 10 and 20 terms to query for."
)


class WebSearchItem(BaseModel):
    reason: str
    "Your reasoning for why this search is important to the query."

    query: str
    "The search term to use for the web search."


class WebSearchPlan(BaseModel):
    searches: list[WebSearchItem]
    """A list of web searches to perform to best answer the query."""


planner_agent = Agent(
    name="PlannerAgent",
    instructions=PROMPT,
    model="o4-mini",
    output_type=WebSearchPlan,
)
```

â€‹	å…¶ä¸­Planner Agent çš„èŒè´£æ˜¯æ¥æ”¶ä¸€ä¸ªç ”ç©¶ä¸»é¢˜ï¼Œç”Ÿæˆä¸€ä»½â€œæœç´¢è®¡åˆ’ï¼ˆWebSearchPlanï¼‰â€ï¼Œå‘Šè¯‰ç³»ç»Ÿåº”è¯¥æœç´¢å“ªäº›å­é—®é¢˜/å…³é”®è¯ä»¥åŠæœç´¢è¿™äº›å…³é”®è¯çš„ç†ç”±ã€‚å…·ä½“ä»£ç è§£é‡Šå¦‚ä¸‹ï¼š

```python
from pydantic import BaseModel
```

å¯¼å…¥ Pydanticï¼Œç”¨äºå®šä¹‰ç»“æ„åŒ–æ•°æ®æ¨¡å‹ã€‚å®ƒæ˜¯æ•´ä¸ª Agents SDK ä¸­ç”¨äº**ç±»å‹æ ¡éªŒ + æ•°æ®ç»“æ„å®šä¹‰**çš„æ ¸å¿ƒåº“ã€‚

```python
from agents import Agent
```

å¯¼å…¥ SDK çš„æ ¸å¿ƒç±» `Agent`ï¼Œæˆ‘ä»¬åé¢ä¼šå®ä¾‹åŒ–ä¸€ä¸ªå…·ä½“çš„ Agent å®ä½“ `planner_agent`ã€‚

```python
PROMPT = (
    "You are a helpful research assistant. Given a query, come up with a set of web searches "
    "to perform to best answer the query. Output between 20 and 30 terms to query for."
)
```

å®šä¹‰è¿™ä¸ª Agent çš„æç¤ºè¯ï¼ˆPromptï¼‰ï¼Œå‘Šè¯‰ LLMï¼š

- ä½ æ˜¯ä¸€ä¸ªç ”ç©¶åŠ©æ‰‹ï¼›
- æ”¶åˆ°ä¸€ä¸ªä¸»é¢˜åï¼Œè¯·ç”Ÿæˆ 20 åˆ° 30 æ¡æœç´¢å»ºè®®ï¼›
- æ¯æ¡å»ºè®®åº”å½“åŒ…æ‹¬ **æœç´¢å…³é”®è¯ + æœç´¢åŸå› **ã€‚


æ¥ä¸‹æ¥æ˜¯ä¸¤ä¸ªé‡è¦çš„æ•°æ®ç»“æ„å®šä¹‰ï¼š

```python
class WebSearchItem(BaseModel):
    reason: str
    "Your reasoning for why this search is important to the query."

    query: str
    "The search term to use for the web search."
```

è¿™æ˜¯ä¸€ä¸ªâ€œå•ä¸ªæœç´¢å»ºè®®â€çš„ç»“æ„ï¼ŒåŒ…å«ä¸¤ä¸ªå­—æ®µï¼š

| å­—æ®µ     | è¯´æ˜                                           |
| -------- | ---------------------------------------------- |
| `reason` | ä½ ä¸ºä»€ä¹ˆè¦æœç´¢è¿™ä¸ªå…³é”®è¯ï¼Ÿï¼ˆç”¨äºè§£é‡Šæœç´¢åŠ¨æœºï¼‰ |
| `query`  | ä½ è¦æœç´¢çš„å…³é”®è¯æœ¬èº«                           |


```python
class WebSearchPlan(BaseModel):
    searches: list[WebSearchItem]
    """A list of web searches to perform to best answer the query."""
```

è¿™æ˜¯â€œæœç´¢è®¡åˆ’â€çš„æ•´ä½“ç»“æ„ï¼ŒåŒ…å«ä¸€ä¸ªåˆ—è¡¨ `searches`ï¼Œæ¯é¡¹æ˜¯ä¸Šé¢çš„ `WebSearchItem`ã€‚

å…¶ä¸­æ¨¡å‹è¾“å‡ºç»“æ„åŒ–çš„å…³é”®åœ¨è¿™ï¼š

```python
output_type=WebSearchPlan,
```

å®ƒå‘Šè¯‰ `planner_agent` **â€œä½ å¿…é¡»è¾“å‡ºä¸€ä»½ç»“æ„åŒ–çš„ WebSearchPlan å¯¹è±¡ï¼Œé‡Œé¢åŒ…å«å¤šä¸ª WebSearchItemã€‚â€**è¿™æ ·å¯ä»¥çº¦æŸæ¨¡å‹è¾“å‡ºæ ¼å¼ï¼Œä¹Ÿä¾¿äºä¸‹ä¸€æ­¥è‡ªåŠ¨è§£æå†…å®¹ã€‚

â€‹	å®é™…è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š



è¾“å‡ºäº†14ä¸ªæœç´¢å…³é”®è¯å’Œå¯¹åº”çš„æœç´¢åŸå› ã€‚

#### 2.4 search_agentåŠŸèƒ½å®ç°

â€‹	æ¥ä¸‹æ¥æ˜¯è´Ÿè´£å®é™…æ‰§è¡Œæœç´¢å·¥ä½œçš„search_agentï¼Œä»£ç å¦‚ä¸‹ï¼š

```python
from agents import Agent, WebSearchTool
from agents.model_settings import ModelSettings

INSTRUCTIONS = (
    "You are a research assistant. Given a search term, you search the web for that term and "
    "produce a concise summary of the results. The summary must 2-3 paragraphs and less than 300 "
    "words. Capture the main points. Write succinctly, no need to have complete sentences or good "
    "grammar. This will be consumed by someone synthesizing a report, so its vital you capture the "
    "essence and ignore any fluff. Do not include any additional commentary other than the summary "
    "itself."
)

search_agent = Agent(
    name="Search agent",
    instructions=INSTRUCTIONS,
    tools=[WebSearchTool()],
    model_settings=ModelSettings(tool_choice="required"),
)
```

`search_agent` çš„ä½œç”¨æ˜¯æ¥æ”¶ä¸€ä¸ª**æœç´¢å…³é”®è¯**ï¼Œè°ƒç”¨ Web æœç´¢å·¥å…·ï¼Œç„¶åæ ¹æ®æœç´¢ç»“æœç”Ÿæˆä¸€ä»½ç®€æ´çš„æ‘˜è¦ï¼ˆ2-3 æ®µï¼Œ<300è¯ï¼‰ï¼Œ**ä¸å¸¦è¯„è®ºï¼Œåªä¿ç•™ä¿¡æ¯æœ¬èº«**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ˜¯æ•´ä¸ªç³»ç»Ÿä¸­çœŸæ­£â€œå»ç½‘ä¸ŠæŸ¥èµ„æ–™â€çš„è§’è‰²ã€‚å…·ä½“ä»£ç è§£é‡Šå¦‚ä¸‹ï¼š

```python
from agents import Agent, WebSearchTool
from agents.model_settings import ModelSettings
```

å…¶ä¸­ï¼š

- `Agent`ï¼šå¯¼å…¥ SDK çš„æ™ºèƒ½ä½“åŸºç±»ï¼›
- `WebSearchTool`ï¼šä¸€ä¸ªç”± Agents SDK å†…ç½®çš„**ç½‘é¡µæœç´¢å·¥å…·**ï¼Œè°ƒç”¨å®ƒå¯ä»¥æ¨¡æ‹Ÿ â€œä¸Šç½‘æœç´¢â€ çš„æ•ˆæœï¼›
- `ModelSettings`ï¼šå¯ä»¥é…ç½®ä¸€äº›æ¨¡å‹ä½¿ç”¨æ—¶çš„è¡Œä¸ºï¼Œæ¯”å¦‚æ˜¯å¦å¿…é¡»ä½¿ç”¨å·¥å…·ã€‚

ç„¶åæ˜¯é‡ç‚¹æç¤ºè¯ `INSTRUCTIONS`

```python
INSTRUCTIONS = (
    "You are a research assistant. Given a search term, you search the web for that term and"
    "produce a concise summary of the results. The summary must 2-3 paragraphs and less than 300"
    "words. Capture the main points. Write succinctly, no need to have complete sentences or good"
    "grammar. This will be consumed by someone synthesizing a report, so its vital you capture the"
    "essence and ignore any fluff. Do not include any additional commentary other than the summary"
    "itself."
)
```

è¿™æ˜¯æ¨¡å‹çš„è¡Œä¸ºæç¤ºï¼Œç¿»è¯‘ä¸€ä¸‹è¿™æ®µå†…å®¹çš„ç²¾é«“ï¼š

| æŒ‡ä»¤å«ä¹‰                           | è¯´æ˜                                    |
| ---------------------------------- | --------------------------------------- |
| ä½ æ˜¯ä¸€ä¸ªç ”ç©¶åŠ©æ‰‹                   | æ¨¡æ‹Ÿä¸€ä¸ªèƒ½æŸ¥èµ„æ–™çš„äºº                    |
| ç»™ä½ å…³é”®è¯åä¸Šç½‘æœç´¢               | å…³é”®è¯æ¥è‡ª planner_agent                |
| å†™å‡º 2-3 æ®µç®€æ´æ€»ç»“                | æ¯æ¬¡æœç´¢ç»“æœå¿…é¡»å‹ç¼©æˆ 300 å­—ä»¥å†…çš„æ‘˜è¦ |
| ç”¨è¦ç‚¹å¼è¯­è¨€ã€å¯ä»¥è¯­æ³•ä¸å®Œæ•´       | ä¸è¦æ±‚åƒè®ºæ–‡ï¼Œé‡ç‚¹æ˜¯ä¿¡æ¯å¯†åº¦é«˜          |
| ä¸è¦æ·»åŠ è‡ªå·±çš„è¯„è®º                 | ä¸èƒ½ä¸»è§‚åˆ¤æ–­ï¼Œåªæå–ä¿¡æ¯                |
| æœ€ç»ˆç›®çš„æ˜¯ä¸ºåç»­å†™æŠ¥å‘Šçš„äººå‡†å¤‡ç´ æ | æ‰€ä»¥æ ¼å¼è‡ªç”±ï¼Œå†…å®¹é›†ä¸­å°±è¡Œ              |

æ¥ä¸‹æ¥åˆ›å»ºåˆ›å»º Agent å¯¹è±¡

```python
search_agent = Agent(
    name="Search agent",
    instructions=INSTRUCTIONS,
    tools=[WebSearchTool()],
    model_settings=ModelSettings(tool_choice="required"),
)
```

å…¶ä¸­`name="Search agent"`æ˜¯Agent åç§°ï¼Œç”¨äºæ—¥å¿—å’Œä¸Šä¸‹æ–‡æ˜¾ç¤ºã€‚è€Œ`instructions=INSTRUCTIONS`å‘Šè¯‰å¤§è¯­è¨€æ¨¡å‹å®ƒè¦æ€ä¹ˆå®Œæˆä»»åŠ¡ã€‚`tools=[WebSearchTool()]`è®¾ç½®å®ƒå¯ä»¥ä½¿ç”¨çš„å·¥å…·ã€‚åœ¨è¿™ä¸ª case ä¸­ï¼Œå®ƒåªèƒ½ç”¨ `WebSearchTool`ï¼Œè¿™æ˜¯ SDK å†…ç½®çš„ç½‘é¡µæœç´¢å·¥å…·ã€‚è€Œ`model_settings=ModelSettings(tool_choice="required")`åˆ™è¡¨ç¤ºï¼š**å¼ºåˆ¶è¦æ±‚æ¨¡å‹ä¸€å®šè¦è°ƒç”¨å·¥å…·ï¼ˆWebSearchToolï¼‰æ¥å®Œæˆä»»åŠ¡**ã€‚ä¸å…è®¸æ¨¡å‹â€œå‡­ç©ºå›ç­”â€æˆ–â€œèƒ¡ç¼–æœç´¢å†…å®¹â€ï¼Œè¿™æœ‰åŠ©äºæå‡çœŸå®æ€§ã€‚

æ€»ç»“æµç¨‹å¦‚ä¸‹ï¼š

```
å…³é”®è¯ï¼ˆæ¥è‡ª planner_agentï¼‰ â†’ search_agent â†’
     ğŸ” ä½¿ç”¨ WebSearchTool æœç´¢
     âœ‚ï¸ æ ¹æ®ç»“æœç”Ÿæˆ 2-3 æ®µæ‘˜è¦
     ğŸ“¦ è¿”å›ç»™ writer_agent å†™æ•´åˆæŠ¥å‘Š
```

å¸¦å…¥planner_agentçš„ä¸€ä¸ªæœç´¢æ¡ç›®åè¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š



#### 2.5 writer_agentåŠŸèƒ½å®ç°

â€‹	æœ€ååˆ™æ˜¯writer_agentçš„åŠŸèƒ½ä»‹ç»ï¼Œå…¶æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š

```python
from pydantic import BaseModel
from agents import Agent

PROMPT_TEMP = (
    "You are a senior researcher tasked with writing a cohesive report for a research query. "
    "You will be provided with the original query, and some initial research done by a research "
    "assistant.\n"
    "You should first come up with an outline for the report that describes the structure and "
    "flow of the report. Then, generate the report and return that as your final output.\n"
    "The final output should be in markdown format, and it should be lengthy and detailed. Aim "
    "for 10-20 pages of content, at least 1500 words."
    "æœ€ç»ˆç»“æœè¯·ç”¨ä¸­æ–‡è¾“å‡ºã€‚"
)


class ReportData(BaseModel):
    short_summary: str
    """A short 2-3 sentence summary of the findings."""

    markdown_report: str
    """The final report"""

    follow_up_questions: list[str]
    """Suggested topics to research further"""


writer_agent = Agent(
    name="WriterAgent",
    instructions=PROMPT_TEMP,
    model="o4-mini",
    output_type=ReportData,
)
```

Writer Agentè¿™æ˜¯ **æ•´ä¸ªç ”ç©¶ç³»ç»Ÿçš„â€œè¾“å‡ºç»ˆç»“è€…â€**ï¼Œè´Ÿè´£æŠŠä¹‹å‰æ‰€æœ‰æœç´¢åˆ°çš„ä¿¡æ¯ï¼Œ**ç»¼åˆæˆä¸€ä»½å®Œæ•´ã€ç»“æ„åŒ–ã€å¯é˜…è¯»çš„é•¿ç¯‡æŠ¥å‘Š**ã€‚è¯¥ Agent çš„ä»»åŠ¡æ˜¯ï¼š

- æ”¶åˆ°ç ”ç©¶ä¸»é¢˜å’Œä¹‹å‰çš„æ‰€æœ‰æœç´¢æ‘˜è¦ï¼›
- **å…ˆå†™ä¸€ä¸ªå¤§çº²ï¼ˆoutlineï¼‰**ï¼›
- ç„¶åæ ¹æ®å¤§çº²å†™å‡ºä¸€ä»½ **è¯¦ç»†çš„ Markdown æ ¼å¼æŠ¥å‘Š**ï¼›
- åŒæ—¶ç”Ÿæˆä¸€ä¸ªç®€çŸ­æ€»ç»“å’Œä¸€äº›åç»­å¯ä»¥ç ”ç©¶çš„é—®é¢˜ã€‚

å…·ä½“ä»£ç è§£é‡Šå¦‚ä¸‹ï¼š

```python
# Agent used to synthesize a final report from the individual summaries.
from pydantic import BaseModel
from agents import Agent
```

- å’Œå‰ä¸¤ä¸ª Agent ä¸€æ ·ï¼Œæˆ‘ä»¬å¯¼å…¥äº†ï¼š
  - `BaseModel`ï¼šç”¨äºå®šä¹‰ç»“æ„åŒ–è¾“å‡ºï¼›
  - `Agent`ï¼šAgent SDK ä¸­çš„æ ¸å¿ƒç±»ã€‚

ç„¶åæ˜¯æç¤ºè¯å®šä¹‰ï¼ˆPromptï¼‰

```python
PROMPT = (
    "You are a senior researcher tasked with writing a cohesive report for a research query. "
    "You will be provided with the original query, and some initial research done by a research "
    "assistant.\n"
    "You should first come up with an outline for the report that describes the structure and "
    "flow of the report. Then, generate the report and return that as your final output.\n"
    "The final output should be in markdown format, and it should be lengthy and detailed. Aim "
    "for 15-20 pages of content, at least 3000 words."
    "æœ€ç»ˆç»“æœè¯·ç”¨ä¸­æ–‡è¾“å‡ºã€‚"
)
```

æç¤ºè¯è¦ç‚¹ï¼š

| è¡Œä¸º     | è¯´æ˜                                          |
| -------- | --------------------------------------------- |
| è§’è‰²è®¾å®š | ä½ æ˜¯ä¸€ä¸ªèµ„æ·±ç ”ç©¶å‘˜ï¼ˆsenior researcherï¼‰       |
| è¾“å…¥     | ä¼šæ‹¿åˆ°ï¼šç ”ç©¶ä¸»é¢˜ + æœç´¢æ‘˜è¦                   |
| ç¬¬ä¸€æ­¥   | å†™å‡ºæŠ¥å‘Šç»“æ„ï¼ˆoutlineï¼‰                       |
| ç¬¬äºŒæ­¥   | å†™å‡º Markdown æŠ¥å‘Šæ­£æ–‡                        |
| è¦æ±‚     | é•¿ã€è¯¦ç»†ã€æœ‰é€»è¾‘ï¼ˆ10-20é¡µï¼Œ1500+è¯ï¼‰          |
| è¾“å‡ºæ ¼å¼ | Markdown æ ¼å¼ï¼ˆå¦‚ `# ä¸€çº§æ ‡é¢˜`, `- åˆ—è¡¨` ç­‰ï¼‰ |
| è¯­è¨€é£æ ¼ | ç²¾ç‚¼ã€å­¦æœ¯ã€ç»“æ„æ¸…æ™°                          |

è¿™ä¸ª prompt æ˜¯æ•´ä¸ªç³»ç»Ÿä¸­æœ€â€œç”Ÿæˆå‹â€çš„ä¸€ä¸ª promptã€‚ç´§æ¥ç€æ˜¯è¾“å‡ºæ•°æ®ç»“æ„å®šä¹‰ï¼Œå®šä¹‰ä¸€ä¸ª `ReportData` ç±»ï¼Œç”¨æ¥çº¦æŸæ¨¡å‹çš„è¾“å‡ºç»“æ„ï¼š

```python
class ReportData(BaseModel):
    short_summary: str
    """A short 2-3 sentence summary of the findings."""

    markdown_report: str
    """The final report"""

    follow_up_questions: list[str]
    """Suggested topics to research further"""
```

å…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š

| å­—æ®µå                | ç±»å‹        | è¯´æ˜                              |
| --------------------- | ----------- | --------------------------------- |
| `short_summary`       | `str`       | å¯¹ç ”ç©¶ç»“æœçš„ç®€è¦æ€»ç»“ï¼ˆ2~3 å¥è¯ï¼‰  |
| `markdown_report`     | `str`       | æŠ¥å‘Šæ­£æ–‡ï¼ŒMarkdown æ ¼å¼ï¼Œå†…å®¹è¯¦å® |
| `follow_up_questions` | `list[str]` | å»ºè®®åç»­å¯ä»¥è¿›ä¸€æ­¥ç ”ç©¶çš„é—®é¢˜åˆ—è¡¨  |

æ³¨æ„ï¼šè¿™ä¸ªç»“æ„å°±æ˜¯é€šè¿‡ `output_type=ReportData` æ¥å‘Šè¯‰ SDK è¦æ±‚æ¨¡å‹è¾“å‡ºè¿™ä¸ªç»“æ„ï¼Œå¦åˆ™ SDK ä¼šæŠ¥é”™æˆ–è§£æå¤±è´¥ã€‚

ç´§æ¥ç€åˆ›å»º Agent å®ä¾‹

```python
writer_agent = Agent(
    name="WriterAgent",
    instructions=PROMPT,
    model="gpt-4.1",
    output_type=ReportData,
)
```

| å‚æ•°           | å«ä¹‰                                                     |
| -------------- | -------------------------------------------------------- |
| `name`         | Agent å                                                 |
| `instructions` | æç¤ºè¯æŒ‡ä»¤                                               |
| `model`        | ä½¿ç”¨çš„æ¨¡å‹ï¼ˆè¿™é‡Œæ˜¯ `"gpt-4.1"`ï¼Œå¯ä»¥æ›¿æ¢ä¸º `gpt-4o` ç­‰ï¼‰ |
| `output_type`  | æŒ‡å®šè¾“å‡ºä¸º `ReportData` ç±»å‹ï¼Œæ”¯æŒç»“æ„åŒ–ç»“æœ             |


æ•´ä½“æµç¨‹æ€»ç»“å¦‚ä¸‹ï¼š

```text
1. ç”¨æˆ·è¾“å…¥ç ”ç©¶ä¸»é¢˜ â†’ planner_agent â†’ æœç´¢å…³é”®è¯åˆ—è¡¨
2. æ¯ä¸ªå…³é”®è¯ â†’ search_agent â†’ æœç´¢æ‘˜è¦
3. æ‰€æœ‰æ‘˜è¦é›†åˆ + åŸå§‹ä¸»é¢˜ â†’ writer_agent â†’
     ğŸ“Œ è¾“å‡ºï¼š
     - short_summary
     - markdown_reportï¼ˆæ­£æ–‡ï¼‰
     - follow_up_questionsï¼ˆå¯ç»§ç»­ç ”ç©¶çš„é—®é¢˜ï¼‰
```

æœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ä¸ªå®Œæ•´ç»“æ„åŒ–çš„ `ReportData` å¯¹è±¡ã€‚

â€‹	å¸¦å…¥å…¶ä¸­ç¬¬ä¸€ä¸ªæ¡ç›®æœç´¢ç»“æœåå¯ä»¥ç¼–å†™æ–‡æœ¬å¦‚ä¸‹ï¼š



éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®é™…æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¸¦å…¥å…¨éƒ¨æœç´¢æ¡ç›®çš„çŸ­æ–‡æœ¬åå†ç¼–å†™æœ€ç»ˆçš„é•¿æ–‡æœ¬ã€‚

#### 2.6 MCPæœåŠ¡å™¨ä¸»å‡½æ•°ç¼–å†™

â€‹	åœ¨å®ç°äº†è¿™ä¸€ç³»åˆ—Agentsçš„åŸºç¡€åŠŸèƒ½ä¹‹åï¼Œæˆ‘ä»¬æ¥ç¼–å†™å½“å‰MCPæœåŠ¡å™¨çš„ä¸»å‡½æ•°ã€‚å…¶å®MCPæœåŠ¡å™¨çš„ä¸»å‡½æ•°å’ŒFunction callingè¿è¡Œè¿‡ç¨‹ä¸­çš„å¤–éƒ¨å‡½æ•°ç±»ä¼¼ï¼ŒåŸºæœ¬è¦æ±‚å¦‚ä¸‹ï¼š

1. èƒ½å®ç°ç¨³å®šçš„è¾“å…¥å’Œè¾“å‡ºã€‚å¯¹äºå½“å‰Mini DeepResearchæœåŠ¡å™¨æ¥è¯´ï¼Œè¾“å…¥å°±æ˜¯ç”¨æˆ·çš„é—®é¢˜ï¼Œè€Œè¾“å‡ºå°±æ˜¯æœ€ç»ˆçš„è°ƒç ”æŠ¥å‘Šï¼›
2. éœ€è¦ç¼–å†™æ˜ç¡®çš„å‡½æ•°è¯´æ˜ï¼ŒåŒ…æ‹¬å‡½æ•°åŠŸèƒ½ã€å‡½æ•°å‚æ•°å’Œå‡½æ•°è¾“å‡ºç­‰ã€‚è¿™äº›å†…å®¹éƒ½æ˜¯MCPå®¢æˆ·ç«¯å»è¯†åˆ«å¤–éƒ¨å·¥å…·çš„å…³é”®ã€‚
3. æ¨èå¯ä»¥ä½¿ç”¨MCP SDKè¿›è¡ŒæœåŠ¡å™¨å¼€å‘ã€‚

â€‹	è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªdeepresearchå‡½æ•°ç»„ï¼Œè¿™ä¸ªå‡½æ•°ç»„ç”¨äºè°ƒç”¨ä¸Šé¢çš„Agentsæ¥æ‰§è¡Œå®Œæ•´çš„è§„åˆ’ã€æœç´¢å’Œæ–‡æ¡£ç¼–å†™å·¥ä½œï¼Œè¯¥å‡½æ•°ç»„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

```python
import asyncio
import os
import time
from typing import List

async def _plan_searches(query: str) -> WebSearchPlan:
    """
    ç”¨äºè¿›è¡ŒæŸä¸ªæœç´¢ä¸»é¢˜çš„æœç´¢è§„åˆ’
    """
    result = await Runner.run(
        planner_agent,
        f"Query: {query}",
    )
    return result.final_output_as(WebSearchPlan)

async def _perform_searches(search_plan: WebSearchPlan) -> List[str]:
    """
    ç”¨äºå®é™…æ‰§è¡Œæœç´¢ï¼Œå¹¶ç»„æˆæœç´¢æ¡ç›®åˆ—è¡¨
    """
    tasks = [asyncio.create_task(_search(item)) for item in search_plan.searches]
    results = []
    for task in asyncio.as_completed(tasks):
        result = await task
        if result is not None:
            results.append(result)
    return results

async def _search(item: WebSearchItem) -> str | None:
    """
    å®é™…è´Ÿè´£è¿›è¡Œæœç´¢ï¼Œå¹¶å®Œæˆæ¯ä¸ªæœç´¢æ¡ç›®çš„çŸ­æ–‡æœ¬ç¼–å†™
    """
    try:
        result = await Runner.run(
            search_agent,
            input=f"Search term: {item.query}\nReason for searching: {item.reason}"
        )
        return str(result.final_output)
    except Exception:
        return None
    
async def _write_report(query: str, search_results: List[str]) -> ReportData:
    """
    æ ¹æ®æœç´¢çš„æ®µæ–‡æ¡£ï¼Œç¼–å†™é•¿æ–‡æœ¬
    """
    result = await Runner.run(
        writer_agent,
        input=f"Original query: {query}\nSummarized search results: {search_results}",
    )
    return result.final_output_as(ReportData)


async def deepresearch(query: str) -> ReportData:
    """
    ä¸»å‡½æ•°ï¼Œè¾“å…¥ä¸€ä¸ªç ”ç©¶ä¸»é¢˜ï¼Œè‡ªåŠ¨å®Œæˆæœç´¢è§„åˆ’ã€æœç´¢ã€å†™æŠ¥å‘Šã€‚
    è¿”å›æœ€ç»ˆçš„ ReportData å¯¹è±¡ï¼Œå°±æ˜¯ä¸€ä¸ªmarkdownæ ¼å¼çš„å®Œæ•´çš„ç ”ç©¶æŠ¥å‘Šæ–‡æ¡£
    """
    search_plan = await _plan_searches(query)
    search_results = await _perform_searches(search_plan)
    report = await _write_report(query, search_results)
    return report
```

ç¼–å†™å®Œæˆåå¯ä»¥è¾“å…¥å¦‚ä¸‹ä»£ç è¿›è¡Œæµ‹è¯•ï¼š

```python
import nest_asyncio
nest_asyncio.apply()

report = await deepresearch("äººå·¥æ™ºèƒ½åœ¨æ•™è‚²é¢†åŸŸçš„åº”ç”¨")

from rich.markdown import Markdown
display(Markdown(report.markdown_report))
```

å…·ä½“è¿è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š



- è¯¾ä»¶é¢†å–





### 3. MCP Serveré¡¹ç›®å¼€å‘

â€‹	åœ¨å®Œæˆäº†ä»£ç åŠŸèƒ½æµ‹è¯•åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„MCP Serveré¡¹ç›®æ¥å®ç°è¯¥åŠŸèƒ½ã€‚å¯¹äºä¸€ä¸ªå®Œæ•´çš„MCPé¡¹ç›®æ¥è¯´ï¼Œè¦æœ‰å®Œæ•´çš„é¡¹ç›®ä»£ç ç»“æ„ã€ä»¥åŠç¬¦åˆMCPæœåŠ¡å™¨åŸºæœ¬è°ƒç”¨è§„èŒƒã€‚å…·ä½“é¡¹ç›®åˆ›å»ºæµç¨‹å¦‚ä¸‹ï¼š

#### Step 1. å€ŸåŠ©uvåˆ›å»ºPythoné¡¹ç›®

â€‹	MCPå¼€å‘è¦æ±‚å€ŸåŠ©uvè¿›è¡Œè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–ç®¡ç†ã€‚`uv` æ˜¯ä¸€ä¸ª**Python ä¾èµ–ç®¡ç†å·¥å…·**ï¼Œç±»ä¼¼äº `pip` å’Œ `conda`ï¼Œä½†å®ƒæ›´å¿«ã€æ›´é«˜æ•ˆï¼Œå¹¶ä¸”å¯ä»¥æ›´å¥½åœ°ç®¡ç† Python è™šæ‹Ÿç¯å¢ƒå’Œä¾èµ–é¡¹ã€‚å®ƒçš„æ ¸å¿ƒç›®æ ‡æ˜¯**æ›¿ä»£ `pip`ã€`venv` å’Œ `pip-tools`**ï¼Œæä¾›æ›´å¥½çš„æ€§èƒ½å’Œæ›´ä½çš„ç®¡ç†å¼€é”€ã€‚

**`uv` çš„ç‰¹ç‚¹**ï¼š

1. **é€Ÿåº¦æ›´å¿«**ï¼šç›¸æ¯” `pip`ï¼Œ`uv` é‡‡ç”¨ Rust ç¼–å†™ï¼Œæ€§èƒ½æ›´ä¼˜ã€‚
2. **æ”¯æŒ PEP 582**ï¼šæ— éœ€ `virtualenv`ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ `__pypackages__` è¿›è¡Œç®¡ç†ã€‚
3. **å…¼å®¹ `pip`**ï¼šæ”¯æŒ `requirements.txt` å’Œ `pyproject.toml` ä¾èµ–ç®¡ç†ã€‚
4. **æ›¿ä»£ `venv`**ï¼šæä¾› `uv venv` è¿›è¡Œè™šæ‹Ÿç¯å¢ƒç®¡ç†ï¼Œæ¯” `venv` æ›´è½»é‡ã€‚
5. **è·¨å¹³å°**ï¼šæ”¯æŒ Windowsã€macOS å’Œ Linuxã€‚

â€‹	ä»¥Ubuntuç³»ç»Ÿä¸ºä¾‹ï¼Œé¦–å…ˆä½¿ç”¨pipå®‰è£…uvï¼š

```bash
pip install uv
```

> æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨curlå®‰è£…uv
>
> ```bash
> curl -LsSf https://astral.sh/uv/install.sh | sh
> ```

ç„¶åæŒ‰ç…§å¦‚ä¸‹æµç¨‹åˆ›å»ºé¡¹ç›®ä¸»ç›®å½•ï¼š

```bash
# cd /root/autodl-tmp/MCP

# åˆ›å»ºé¡¹ç›®ç›®å½•
uv init mcp-server-deepresearch
cd mcp-server-deepresearch
```





ç„¶åè¾“å…¥å¦‚ä¸‹å‘½ä»¤åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼š

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
uv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate
```

æ­¤æ—¶å°±æ„å»ºäº†ä¸€ä¸ªåŸºç¡€é¡¹ç›®ç»“æ„ï¼š



å„æ–‡ä»¶è§£é‡Šå¦‚ä¸‹ï¼š

| æ–‡ä»¶/æ–‡ä»¶å¤¹       | ä½œç”¨             |
| ----------------- | ---------------- |
| `.git/`           | Git ç‰ˆæœ¬æ§åˆ¶ç›®å½• |
| `.venv/`          | è™šæ‹Ÿç¯å¢ƒ         |
| `.gitignore`      | Git å¿½ç•¥è§„åˆ™     |
| `.python-version` | Pythonç‰ˆæœ¬å£°æ˜   |
| `main.py`         | ä¸»ç¨‹åºå…¥å£       |
| `pyproject.toml`  | é¡¹ç›®é…ç½®æ–‡ä»¶     |
| `README.md`       | é¡¹ç›®è¯´æ˜æ–‡æ¡£     |

#### Step 2. æ·»åŠ é¡¹ç›®ä¾èµ–

â€‹	æ¥ä¸‹æ¥ç»§ç»­ä½¿ç”¨uvå·¥å…·ï¼Œä¸ºæˆ‘ä»¬çš„é¡¹ç›®æ·»åŠ åŸºç¡€ä¾èµ–ã€‚æ ¹æ®æ­¤å‰çš„ä»£ç è§£é‡Šä¸éš¾çœ‹å‡ºï¼Œå½“å‰é¡¹ç›®ä¸»è¦éœ€è¦ç”¨åˆ°`openai`å’Œ`openai-agents`è¿™ä¸¤ä¸ªåº“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ç›¸å…³ä¾èµ–ï¼Œå¹¶åŒæ—¶å®‰è£…mcp sdkï¼š

```bash
# å®‰è£… MCP SDK
uv add mcp openai openai-agents asyncio typing pydantic
```



æ³¨æ„ï¼Œå¯¹äºuvç®¡ç†åº“æ¥è¯´ï¼Œç›¸å…³ä¾èµ–ä¼šå®‰è£…åˆ°.venvæ–‡ä»¶ä¸­ï¼Œå¹¶ä¸ä¼šå’Œç³»ç»Ÿåº“äº§ç”Ÿå†²çªã€‚

#### Step 3.ç¼–å†™é¡¹ç›®æºç 

â€‹	æ¥ä¸‹æ¥åœ¨ä¸»ç›®å½•ä¸‹åˆ›å»º`/src/mcp_server_deepresearch`ä½œä¸ºä»£ç ä¸»ç›®å½•

```bash
mkdir -p ./src/mcp_server_deepresearch
cd ./src/mcp_server_deepresearch
```

ç„¶ååˆ›å»ºserver.pyè„šæœ¬ï¼Œä½œä¸ºæ•´ä¸ªDeepResearch MCPæœåŠ¡å™¨çš„æ ¸å¿ƒè„šæœ¬ï¼Œ



å¹¶å†™å…¥ä»£ç å¦‚ä¸‹ï¼š

```python
import asyncio
import argparse
from typing import List
from mcp.server.fastmcp import FastMCP
from openai import AsyncOpenAI
from pydantic import BaseModel
from agents import OpenAIChatCompletionsModel,Agent,Runner,set_default_openai_client, set_tracing_disabled,WebSearchTool
from agents.model_settings import ModelSettings

# åˆå§‹åŒ– MCP æœåŠ¡å™¨
mcp = FastMCP("DeepResearch")
USER_AGENT = "deepresearch-app/1.0"
API_KEY = None

# åˆ›å»ºplanner_agent
PROMPT = (
    "You are a helpful research assistant. Given a query, come up with a set of web searches "
    "to perform to best answer the query. Output between 10 and 20 terms to query for."
)


class WebSearchItem(BaseModel):
    reason: str
    "Your reasoning for why this search is important to the query."

    query: str
    "The search term to use for the web search."


class WebSearchPlan(BaseModel):
    searches: list[WebSearchItem]
    """A list of web searches to perform to best answer the query."""


planner_agent = Agent(
    name="PlannerAgent",
    instructions=PROMPT,
    model="o3-mini",
    output_type=WebSearchPlan,
)

# åˆ›å»ºsearch_agent
INSTRUCTIONS = (
    "You are a research assistant. Given a search term, you search the web for that term and "
    "produce a concise summary of the results. The summary must 2-3 paragraphs and less than 300 "
    "words. Capture the main points. Write succinctly, no need to have complete sentences or good "
    "grammar. This will be consumed by someone synthesizing a report, so its vital you capture the "
    "essence and ignore any fluff. Do not include any additional commentary other than the summary "
    "itself."
)

search_agent = Agent(
    name="Search agent",
    instructions=INSTRUCTIONS,
    tools=[WebSearchTool()],
    model_settings=ModelSettings(tool_choice="required"),
)

# åˆ›å»ºwriter_agent
PROMPT_TEMP = (
    "You are a senior researcher tasked with writing a cohesive report for a research query. "
    "You will be provided with the original query, and some initial research done by a research "
    "assistant.\n"
    "You should first come up with an outline for the report that describes the structure and "
    "flow of the report. Then, generate the report and return that as your final output.\n"
    "The final output should be in markdown format, and it should be lengthy and detailed. Aim "
    "for 10-20 pages of content, at least 1500 words."
    "æœ€ç»ˆç»“æœè¯·ç”¨ä¸­æ–‡è¾“å‡ºã€‚"
)


class ReportData(BaseModel):
    short_summary: str
    """A short 2-3 sentence summary of the findings."""

    markdown_report: str
    """The final report"""

    follow_up_questions: list[str]
    """Suggested topics to research further"""


writer_agent = Agent(
    name="WriterAgent",
    instructions=PROMPT_TEMP,
    model="o3-mini",
    output_type=ReportData,
)

# è¾…åŠ©å‡½æ•°ç»„
async def _plan_searches(query: str) -> WebSearchPlan:
    """
    ç”¨äºè¿›è¡ŒæŸä¸ªæœç´¢ä¸»é¢˜çš„æœç´¢è§„åˆ’
    """
    result = await Runner.run(
        planner_agent,
        f"Query: {query}",
    )
    return result.final_output_as(WebSearchPlan)

async def _perform_searches(search_plan: WebSearchPlan) -> List[str]:
    """
    ç”¨äºå®é™…æ‰§è¡Œæœç´¢ï¼Œå¹¶ç»„æˆæœç´¢æ¡ç›®åˆ—è¡¨
    """
    tasks = [asyncio.create_task(_search(item)) for item in search_plan.searches]
    results = []
    for task in asyncio.as_completed(tasks):
        result = await task
        if result is not None:
            results.append(result)
    return results

async def _search(item: WebSearchItem) -> str | None:
    """
    å®é™…è´Ÿè´£è¿›è¡Œæœç´¢ï¼Œå¹¶å®Œæˆæ¯ä¸ªæœç´¢æ¡ç›®çš„çŸ­æ–‡æœ¬ç¼–å†™
    """
    try:
        result = await Runner.run(
            search_agent,
            input=f"Search term: {item.query}\nReason for searching: {item.reason}"
        )
        return str(result.final_output)
    except Exception:
        return None
    
async def _write_report(query: str, search_results: List[str]) -> ReportData:
    """
    æ ¹æ®æœç´¢çš„æ®µæ–‡æ¡£ï¼Œç¼–å†™é•¿æ–‡æœ¬
    """
    result = await Runner.run(
        writer_agent,
        input=f"Original query: {query}\nSummarized search results: {search_results}",
    )
    return result.final_output_as(ReportData)

# MCPæœåŠ¡å™¨ä¸»å‡½æ•°
@mcp.tool()
async def deepresearch(query: str) -> ReportData:
    """
    å½“ç”¨æˆ·æ˜ç¡®è¡¨ç¤ºéœ€è¦å›´ç»•æŸä¸ªä¸»é¢˜è¿›è¡Œæ·±å…¥ç ”ç©¶æ—¶ï¼Œè¯·è°ƒæœ¬å‡½æ•°ã€‚
    æœ¬å‡½æ•°èƒ½å¤Ÿå›´ç»•ç”¨æˆ·è¾“å…¥çš„é—®é¢˜è¿›è¡Œè”ç½‘æœç´¢å’Œæ·±å…¥ç ”ç©¶ï¼Œå¹¶åˆ›å»ºä¸€ç¯‡å†…å®¹å®Œæ•´çš„markdownæ ¼å¼çš„ç ”ç©¶æŠ¥å‘Šã€‚
    è¾“å…¥å‚æ•°query:ç”¨æˆ·æå‡ºçš„ç ”ç©¶ä¸»é¢˜ï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºï¼›
    å‡½æ•°è¿”å›ç»“æœä¸ºä¸€ä¸ªmarkdownæ ¼å¼çš„å®Œæ•´çš„ç ”ç©¶æŠ¥å‘Šæ–‡æ¡£ã€‚
    """
    search_plan = await _plan_searches(query)
    search_results = await _perform_searches(search_plan)
    report = await _write_report(query, search_results)
    return report

def main():
    parser = argparse.ArgumentParser(description="DeepResearch Server")
    parser.add_argument("--openai_api_key", type=str, required=True, help="ä½ çš„ OpenAI API Key")
    args = parser.parse_args()

    # åˆå§‹åŒ– external_client å’Œè®¾ç½®
    external_client = AsyncOpenAI(
        base_url = "https://ai.devtool.tech/proxy/v1",
        api_key = args.openai_api_key,
    )
    set_default_openai_client(external_client)
    set_tracing_disabled(True)
    
    mcp.run(transport='stdio')

if __name__ == "__main__":
    main()
```

å…¶ä¸­ä¸»è¦å†…å®¹å‡ä¸ºæ­¤å‰ä»‹ç»çš„ä¸‰ä¸ªAgentå’Œè°ƒåº¦å‡½æ•°ç»„çš„å†…å®¹ï¼Œè€Œæ•´ä¸ªMCPæœåŠ¡å™¨å¼€å‘æ ¸å¿ƒé‡‡ç”¨äº†fastmcpåº“è¿›è¡Œé«˜æ•ˆå¼€å‘ï¼š

```python
from mcp.server.fastmcp import FastMCP
```

å€ŸåŠ©fastmcpï¼Œæˆ‘ä»¬ä»…éœ€åœ¨è„šæœ¬åˆå§‹åŒ–ä¸€ä¸ªMCPæœåŠ¡å™¨å¯¹è±¡ï¼Œ

```python
mcp = FastMCP("DeepResearch")
```

ç„¶åä½¿ç”¨è£…é¥°å™¨ä¸ºå…¶æ·»åŠ ä¸€äº›å‡½æ•°

```python
# MCPæœåŠ¡å™¨ä¸»å‡½æ•°
@mcp.tool()
async def deepresearch(query: str) -> ReportData:
```

ç„¶åå³å¯åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰åŠŸèƒ½çš„MCPæœåŠ¡å™¨ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç®€å•çš„å°†MCPæœåŠ¡å™¨ç†è§£ä¸ºåµŒå¥—åœ¨åŠŸèƒ½å‡½æ•°å¤–å±‚çš„ä¸€ä¸ªå¯¹è±¡ã€‚è€Œåœ¨å®é™…è¿è¡Œçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä»…éœ€åœ¨ä¸»å‡½æ•°çš„å°¾éƒ¨åŠ ä¸Šï¼š

```python
mcp.run(transport='stdio')
```

å³å¯å®ŒæˆMCPæœåŠ¡å™¨è¿›ç¨‹çš„å¼€å¯ã€‚

â€‹	ä¸éš¾çœ‹å‡ºå€ŸåŠ©MCPé«˜çº§SDKå¼€å‘MCPæœåŠ¡å™¨çš„æµç¨‹å®é™…ä¸Šéå¸¸ç®€å•ï¼Œæ•´ä¸ªä»£ç ç¼–å†™è¿‡ç¨‹ä¸»è¦è¿˜æ˜¯éœ€è¦å†™æ¸…æ¥šåŠŸèƒ½å‡½æ•°çš„æ‰§è¡Œé€»è¾‘ã€‚

> æ›´å¤šMCP SDKè¯¦è§å®˜ç½‘ä»‹ç»ï¼šhttps://github.com/modelcontextprotocol/python-sdk
>
> 

â€‹	è€Œparserç›¸å…³ä»£ç åˆ™æ˜¯è§„å®šåœ¨è°ƒç”¨è¯¥è„šæœ¬æ—¶éœ€è¦é€šè¿‡å‚æ•°è¾“å…¥æ¥è®¾ç½®OpenAIçš„API-KEYã€‚å…·ä½“è§£é‡Šå¦‚ä¸‹ï¼š

```python
def main():
```

- å®šä¹‰ä¸€ä¸ªåä¸º `main` çš„å‡½æ•°ï¼Œä½œä¸ºç¨‹åºçš„ä¸»å…¥å£å‡½æ•°ã€‚

```python
    parser = argparse.ArgumentParser(description="DeepResearch Server")
```

- ä½¿ç”¨ `argparse` æ¨¡å—æ¥åˆ›å»ºä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°è§£æå™¨ `parser`ã€‚
- `description="DeepResearch Server"` æ˜¯è¯¥ç¨‹åºçš„æè¿°ï¼Œç”¨äºå‘½ä»¤è¡Œä¸­å¸®åŠ©ä¿¡æ¯çš„å±•ç¤ºã€‚

```python
    parser.add_argument("--openai_api_key", type=str, required=True, help="ä½ çš„ OpenAI API Key")
```

- å®šä¹‰äº†ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•° `--openai_api_key`ï¼Œç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œ**å¿…é¡»æä¾›ï¼ˆ`required=True`ï¼‰**ã€‚
- `help="ä½ çš„ OpenAI API Key"` è¡¨ç¤ºå½“ç”¨æˆ·è¿è¡Œ `python script.py --help` æ—¶ï¼Œä¼šçœ‹åˆ°è¿™æ®µæç¤ºã€‚

âœ… ç¤ºä¾‹è°ƒç”¨ï¼š

```bash
python script.py --openai_api_key sk-xxxxx
```

```python
    args = parser.parse_args()
```

- ä»å‘½ä»¤è¡Œè¯»å–å¹¶è§£æç”¨æˆ·è¾“å…¥çš„å‚æ•°ï¼Œå°†å…¶ä¿å­˜åˆ° `args` å˜é‡ä¸­ã€‚
- ç°åœ¨å¯ä»¥é€šè¿‡ `args.openai_api_key` è®¿é—®ç”¨æˆ·è¾“å…¥çš„ API keyã€‚

```python
    external_client = AsyncOpenAI(
        base_url = "https://ai.devtool.tech/proxy/v1",
        api_key = args.openai_api_key,
    )
```

- åˆ›å»ºä¸€ä¸ª OpenAI çš„å¼‚æ­¥å®¢æˆ·ç«¯å®ä¾‹ `external_client`ï¼Œè¿™ä¸ªå®¢æˆ·ç«¯ä½¿ç”¨äº†ä¸€ä¸ª**ä»£ç†æ¥å£** `https://ai.devtool.tech/proxy/v1`ã€‚
- ä½¿ç”¨äº†ç”¨æˆ·æä¾›çš„ `openai_api_key` ä½œä¸ºèº«ä»½éªŒè¯ã€‚

```python
    set_default_openai_client(external_client)
```

- å°†åˆšåˆšåˆ›å»ºçš„ `external_client` è®¾ç½®ä¸º**å…¨å±€é»˜è®¤çš„ OpenAI å®¢æˆ·ç«¯**ï¼Œåç»­ä»£ç è°ƒç”¨æ¨¡å‹æ¥å£æ—¶å°†è‡ªåŠ¨ä½¿ç”¨è¿™ä¸ªå®¢æˆ·ç«¯ã€‚
- é€šå¸¸ç”¨äºå°è£…åº“å†…éƒ¨ï¼ˆæ¯”å¦‚ Agent æ¡†æ¶ï¼‰ç»Ÿä¸€ä½¿ç”¨è¿™ä¸ªå®¢æˆ·ç«¯ã€‚

```python
    set_tracing_disabled(True)
```

- ç¦ç”¨â€œè¿½è¸ªï¼ˆTracingï¼‰â€åŠŸèƒ½ï¼Œå¯èƒ½ç”¨äºé¿å…è®°å½•æ—¥å¿—æˆ–è¿½è¸ªæ“ä½œã€‚å…·ä½“æ˜¯å¦å½±å“åŠŸèƒ½å–å†³äºä½ ä½¿ç”¨çš„ SDK æˆ– Agent æ¡†æ¶ã€‚

```python
    mcp.run(transport='stdio')
```

- å¯åŠ¨ MCPï¼ˆModel Context Protocolï¼‰æœåŠ¡å™¨ï¼Œé‡‡ç”¨ `stdio` ä½œä¸º**ä¼ è¾“æ–¹å¼**ã€‚
- `stdio` ä¼ è¾“æ–¹å¼é€šå¸¸ç”¨äºä¸ç»ˆç«¯äº¤äº’æˆ–è¢«å…¶ä»–è¿›ç¨‹é€šè¿‡æ ‡å‡†è¾“å…¥/è¾“å‡ºè°ƒç”¨ï¼ˆç±»ä¼¼ CLI å·¥å…·æˆ–åµŒå¥—è°ƒç”¨ï¼‰ã€‚

è¿™æ®µ `main` å‡½æ•°çš„é€»è¾‘æ˜¯ï¼š

1. ä»å‘½ä»¤è¡Œä¸­è·å–ç”¨æˆ·è¾“å…¥çš„ `OpenAI API Key`ã€‚
2. æ„é€ ä¸€ä¸ªé€šè¿‡ä»£ç†åœ°å€è®¿é—® OpenAI çš„å¼‚æ­¥å®¢æˆ·ç«¯ã€‚
3. è®¾ç½®è¿™ä¸ªå®¢æˆ·ç«¯ä¸ºé»˜è®¤å®¢æˆ·ç«¯ï¼Œç¦ç”¨ tracingã€‚
4. ä»¥ `stdio` æ¨¡å¼å¯åŠ¨ MCP Server

æ•´ä¸ªé¡¹ç›®çš„è„šæœ¬æ–‡ä»¶å¯ä»¥åœ¨ç½‘ç›˜ä¸­é¢†å–ï¼š





### 4. å€ŸåŠ©MCP Inspectorè¿›è¡ŒåŠŸèƒ½æµ‹è¯•

â€‹	åœ¨å®Œæˆäº†é¡¹ç›®çš„æºç å¼€å‘åï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨MCPå®˜æ–¹æä¾›çš„Inspectorå·¥å…·è¿›è¡ŒåŠŸèƒ½æµ‹è¯•äº†ã€‚

- Inspectoré¡¹ç›®åœ°å€ï¼šhttps://github.com/modelcontextprotocol/inspector

  

è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºå½“å‰MCPæœåŠ¡å™¨è„šæœ¬æ˜¯ä½¿ç”¨MCP SDKè¿›è¡Œçš„å¼€å‘ï¼Œå¹¶ä¸”MCPæœåŠ¡å™¨çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ä¸ºMCPå®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼Œå› æ­¤å¦‚æœä¸é‡‡ç”¨å®˜æ–¹æä¾›çš„Inspectorè¿›è¡Œdebugï¼Œå°±éœ€è¦è‡ªå·±æ‰‹å†™ä¸€ä¸ªMCP clientå¹¶å°è¯•ä¸MCP serverè¿›è¡Œé€šä¿¡ï¼Œæ‰èƒ½è¿›è¡Œdebugã€‚

â€‹	æ¢è€Œè¨€ä¹‹å°±æ˜¯å®˜æ–¹æä¾›çš„Inspectorå®é™…ä¸Šæ˜¯ä¸€ä¸ªé€šç”¨çš„MCP Clientï¼Œèƒ½å¤Ÿæµ‹è¯•MCP serverå®é™…è¿è¡Œæ•ˆæœã€‚å…·ä½“debugæµç¨‹å¦‚ä¸‹ï¼š

- Step 1.è¿è¡ŒMCPæœåŠ¡å™¨è„šæœ¬

```bash
# å›åˆ°é¡¹ç›®ä¸»ç›®å½•
# cd /root/autodl-tmp/MCP/mcp-server-deepresearch

# è¿è¡ŒInspector
npx -y @modelcontextprotocol/inspector uv run ./src/mcp_server_deepresearch/server.py --openai_api_key YOUR_KEY
```



> æ³¨æ„æ­¤å¤„è¦è¾“å…¥OpenAI-API-KEY

å¯åŠ¨å®Œæˆåèƒ½å¤Ÿçœ‹åˆ°ï¼Œæ­¤æ—¶æœåŠ¡å™¨ç«¯å£å·ä¸º6277ï¼Œè€ŒInspectorç«¯å£å·ä¸º6274ï¼Œå¦‚æœæ˜¯åœ¨æœ¬åœ°è¿è¡Œï¼Œåˆ™å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥`localhost:6274`è¿›å…¥Inspectoré¡µé¢ï¼Œè€Œå¦‚æœæ˜¯åœ¨AutoDLä¸Šè¿è¡Œï¼Œåˆ™éœ€è¦ä½¿ç”¨SSHéš§é“å·¥å…·ï¼Œå°†ä¸¤ä¸ªç«¯å£å·éƒ½æ˜ å°„åˆ°æœ¬åœ°ï¼š



ç„¶åå†åœ¨`localhost:6274`è¿›å…¥Inspectoré¡µé¢ã€‚

- Step 2.è®¾ç½®Inspectorç›¸åº”æ—¶é—´

â€‹	é¦–æ¬¡è¿›å…¥Inspectoré¡µé¢æ—¶éœ€è¦è®¾ç½®å“åº”æ—¶é—´ï¼Œç”±äºå½“å‰å¤–éƒ¨å·¥å…·è¿è¡Œæ—¶é—´è¾ƒé•¿ï¼ŒInspectoré»˜è®¤åªç»™å‡º10ç§’å“åº”çª—å£ï¼Œè¶…æ—¶æœªå“åº”åˆ™ä¼šæŠ¥é”™ï¼Œå› æ­¤è¿™é‡Œéœ€è¦åœ¨Configurationä¸­è¿›è¡Œå“åº”æ—¶é—´è®¾ç½®ï¼š





ç„¶åç‚¹å‡»Connectå³å¯è¿æ¥MCP Serverã€‚

> è¶…æ—¶å“åº”æŠ¥é”™ç¤ºä¾‹ï¼š
>
> 

- Step 4.åœ¨çº¿è¿è¡Œ

â€‹	å½“è¿æ¥ä¸ŠMCP Serverä¹‹åï¼Œæ¥ä¸‹æ¥ç‚¹å‡»Toolsã€å†ç‚¹å‡»List Toolsï¼Œé€‰æ‹©deepresearchå·¥å…·ï¼Œå¹¶åœ¨å³ä¾§è¾“å…¥é—®é¢˜ï¼Œä¾‹å¦‚`ä½ å¥½ï¼Œæˆ‘æƒ³æ·±å…¥äº†è§£ä¸‹åˆ°åº•ä»€ä¹ˆæ˜¯MCPï¼ˆModel Context Protocolï¼‰æŠ€æœ¯`ï¼Œæ¥ä¸‹æ¥MCPæœåŠ¡å™¨ä¼šå¼€å§‹è¿›è¡Œè¿è¡Œï¼š



è¿è¡Œåå³å¯å¾—åˆ°å®Œæ•´è°ƒç ”æŠ¥å‘Šç»“æœï¼š

<video src="https://ml2022.oss-cn-hangzhou.aliyuncs.com/inspector%E6%BC%94%E7%A4%BA.mp4"></video>

ç”±æ­¤å³å®Œæˆäº†å®Œæ•´çš„MCP Serverè„šæœ¬debugã€‚æ¥ä¸‹æ¥å³å¯è€ƒè™‘å°†é¡¹ç›®è¿›è¡Œéƒ¨ç½²ä¸Šçº¿äº†ã€‚

## ä¸‰ã€MCPæœåŠ¡å™¨éƒ¨ç½²æµç¨‹

â€‹	å¯¹äºMCPæœåŠ¡å™¨æ¥è¯´ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯åœ¨çº¿å‘å¸ƒå’Œç¦»çº¿æ‹·è´è¿è¡Œã€‚

- **MCPæœåŠ¡å™¨åœ¨çº¿å‘å¸ƒ**

  â€‹	æ‰€è°“åœ¨çº¿å‘å¸ƒï¼ŒæŒ‡çš„æ˜¯æˆ‘ä»¬å¯ä»¥å°†å¼€å‘å¥½çš„MCPæœåŠ¡å™¨æ‰“åŒ…ä¸Šä¼ åˆ°pypiå¹³å°æˆ–è€…npmå¹³å°è¿›è¡Œäº‘å¹³å°æ‰˜ç®¡ï¼Œä¸€æ—¦ä¸Šä¼ æˆåŠŸï¼Œåç»­ç”¨æˆ·å³å¯ä½¿ç”¨uvxæˆ–è€…npxè¿›è¡Œä¸‹è½½å’Œä½¿ç”¨ã€‚æˆ‘ä»¬åœ¨`3. MCPå·¥å…·æ ‡å‡†æ¥å…¥æµç¨‹`ä¸€èŠ‚ä¸­æ‰€ä»‹ç»çš„å„ä¸»æµMCPå®¢æˆ·ç«¯æ¥å…¥MCPå·¥å…·çš„æ ‡å‡†æµç¨‹ï¼Œå®é™…ä¸Šå°±æ˜¯å®æ—¶ä¸‹è½½MCPå·¥å…·ï¼Œç„¶ååœ¨æœ¬åœ°è¿›è¡Œè¿è¡Œã€‚è€Œå„å¤§MCPå·¥å…·å¹³å°ï¼Œå¦‚Smitheryï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯åœ¨pipyå¹³å°æˆ–è€…npmå¹³å°ä¸Šæ‰˜ç®¡çš„åº“åŸºç¡€ä¸Šè¿›è¡Œçš„è¿›ä¸€æ­¥ç»´æŠ¤ã€‚

  > pipyï¼šhttps://pypi.org/
  >
  > 
  >
  > npmï¼šhttps://www.npmjs.com/
  >
  > 

- **MCPæœåŠ¡å™¨ç¦»çº¿æ‹·è´è¿è¡Œ**

  â€‹        è€Œæ‰€è°“çš„ç¦»çº¿éƒ¨ç½²è¿è¡Œï¼Œå°±å¥½ç†è§£çš„å¤šï¼ŒæŒ‡çš„æ˜¯å°†æ‰“åŒ…å¥½çš„åº“ç›´æ¥æ‹·è´åˆ°æœåŠ¡å™¨ä¸Šæˆ–è€…ç»™ä»–äººè¿›è¡Œä½¿ç”¨ï¼Œæ²¡æœ‰åœ¨äº‘å¹³å°æ‰˜ç®¡çš„è¿™ä¸ªç¯èŠ‚ï¼Œé€‚åˆéå…¬å¼€MCPæœåŠ¡å™¨è¿›è¡Œéƒ¨ç½²ã€‚

æ¥ä¸‹æ¥å›´ç»•æˆ‘ä»¬åˆ›å»ºçš„DeepResearch MCPæœåŠ¡å™¨ï¼Œè¯¦ç»†ä»‹ç»è¿™ä¸¤ç§éƒ¨ç½²æ–¹æ³•ã€‚

### 1. DeepResearché¡¹ç›®å®Œå–„

â€‹	å°½ç®¡æ­¤å‰æˆ‘ä»¬å·²ç»å®Œæˆäº†DeepResearché¡¹ç›®çš„æ ¸å¿ƒè„šæœ¬debugï¼Œä½†å…¶ä»ç„¶ä¸ç®—æ˜¯ä¸€ä¸ªç»“æ„å®Œæ•´çš„é¡¹ç›®ã€‚æ ¸å¿ƒè„šæœ¬çš„è°ƒç”¨å…³ç³»å¹¶ä¸æ˜ç¡®ï¼ŒåŒæ—¶é¡¹ç›®è¯´æ˜ä¹Ÿä¸å¤Ÿå®Œå–„ã€‚å› æ­¤è¿™é‡Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å…ˆå®Œå–„é¡¹ç›®çš„ä¸»ä½“å†…å®¹ï¼Œå†è€ƒè™‘è¿›è¡Œéƒ¨ç½²æˆ–ä¸Šçº¿å‘å¸ƒã€‚

#### 1.1 src layouté¡¹ç›®ç»“æ„

â€‹	å…¶å®åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å°†ä»£ç éƒ½æ”¾åœ¨srcå†…çš„æŸä¸ªæ–‡ä»¶å¤¹é‡Œï¼Œè¿™ç§é¡¹ç›®ç»“æ„ä¹Ÿè¢«ç§°ä½œsrc layouté¡¹ç›®ç»“æ„ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸é€šç”¨ã€åŒæ—¶ä¹Ÿä¾¿äºä»£ç ç»´æŠ¤çš„é¡¹ç›®ç»“æ„ï¼ŒåŸºæœ¬ç¤ºæ„å›¾å¦‚ä¸‹ï¼š

```pgsql
your-project/
â”œâ”€â”€ src/               â† âœ… æ‰€æœ‰ä¸šåŠ¡ä»£ç éƒ½é›†ä¸­åœ¨è¿™é‡Œ
â”‚   â””â”€â”€ your_package/  â† Python åŒ…çš„å®é™…å†…å®¹ï¼ˆå« __init__.pyï¼‰
â”œâ”€â”€ dist/              â† æ„å»ºåçš„åˆ†å‘åŒ…ï¼ˆå¦‚ wheelï¼‰
â”œâ”€â”€ .venv/             â† è™šæ‹Ÿç¯å¢ƒï¼ˆæœ¬åœ°ä¾èµ–éš”ç¦»ï¼‰
â”œâ”€â”€ .git/              â† Git ç®¡ç†
â”œâ”€â”€ pyproject.toml     â† é¡¹ç›®é…ç½®
â”œâ”€â”€ README.md          â† è¯´æ˜æ–‡ä»¶
â”œâ”€â”€ .python-version    â† Pythonç‰ˆæœ¬å£°æ˜
â”œâ”€â”€ .gitignore         â† Git å¿½ç•¥è§„åˆ™
â””â”€â”€ uv.lock            â† uv çš„ä¾èµ–é”æ–‡ä»¶
```

æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜éœ€è¦åœ¨`src/mcp_server_deepresearch`ä¸­åˆ›å»ºä¸¤ä¸ªpyè„šæœ¬ï¼Œå…¶ä¸€æ˜¯`__init__.py`ï¼Œä½¿å½“å‰æ–‡ä»¶å¤¹å¯ä»¥ä½œä¸ºPythonçš„ä¸€ä¸ªåº“è¿›è¡Œå¯¼å…¥ï¼Œéœ€è¦åœ¨`__init__.py`å†™å…¥å¦‚ä¸‹ä»£ç ï¼š

```python
from .server import main
```

åŒæ—¶å†åˆ›å»ºä¸€ä¸ª`__main__.py`ï¼Œç”¨äºå®é™…æ‰§è¡Œä¸»å‡½æ•°è°ƒç”¨æµç¨‹ï¼š

```python
from mcp_server_deepresearch import main

main()
```

æœ€ç»ˆ`src/mcp_server_deepresearch`ä¸­ä»£ç æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š



æ•´ä¸ªé¡¹ç›®çš„è„šæœ¬æ–‡ä»¶å¯ä»¥åœ¨ç½‘ç›˜ä¸­é¢†å–ï¼š





#### 1.2 ä¿®æ”¹pyproject.toml

â€‹	åˆ›å»ºå®ŒåŸºæœ¬é¡¹ç›®ç»“æ„åï¼Œè®©æˆ‘ä»¬å›åˆ°å½“å‰é¡¹ç›®ä¸»ç›®å½•ä¸‹ï¼Œåˆ é™¤`main.py`ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œç„¶åä¿®æ”¹é¡¹ç›®é…ç½®æ–‡ä»¶`pyproject.toml`:

```toml
[build-system]
requires = ["setuptools>=61.0", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "mcp-server-deepresearch"
version = "0.1.2"
description = "å®ç°ç±»deepresearchåŠŸèƒ½çš„MCPå·¥å…·"
readme = "README.md"
requires-python = ">=3.10"
dependencies = [
    "asyncio>=3.4.3",
    "mcp>=1.6.0",
    "openai>=1.75.0",
    "openai-agents>=0.0.12",
    "pydantic>=2.11.3",
    "typing>=3.10.0.0",
]

[project.scripts]
mcp-server-deepresearch = "mcp_server_deepresearch:main"

[tool.setuptools]
package-dir = {"" = "src"}

[tool.setuptools.packages.find]
where = ["src"]
```

å…·ä½“é…ç½®è§£é‡Šå¦‚ä¸‹ï¼š

 `[build-system]` æ®µ

```toml
[build-system]
requires = ["setuptools>=61.0", "wheel"]
build-backend = "setuptools.build_meta"
```

å‘Šè¯‰ Python æ„å»ºå·¥å…·ï¼ˆå¦‚ `pip`, `uv`, `build`ï¼‰ï¼š

- è¦ä½¿ç”¨ `setuptools` æ¥æ„å»ºé¡¹ç›®
- åŒæ—¶ä¾èµ– `wheel`ï¼Œå› ä¸ºä½ è¦æ„å»º `.whl` åŒ…

`[project]` æ®µ

```toml
[project]
name = "mcp-server-deepresearch"
version = "0.1.2"
description = "å®ç°ç±»deepresearchåŠŸèƒ½çš„MCPå·¥å…·"
readme = "README.md"
requires-python = ">=3.10"
dependencies = [
    "asyncio>=3.4.3",
    "mcp>=1.6.0",
    "openai>=1.75.0",
    "openai-agents>=0.0.12",
    "pydantic>=2.11.3",
    "typing>=3.10.0.0",
]
```

å®šä¹‰é¡¹ç›®çš„**å…ƒæ•°æ®**ï¼ŒåŒ…æ‹¬ï¼š

- é¡¹ç›®åç§°ã€ç‰ˆæœ¬ã€æè¿°
- Python æœ€ä½ç‰ˆæœ¬è¦æ±‚
- è‡ªåŠ¨å®‰è£…çš„ä¾èµ–é¡¹ï¼ˆç›¸å½“äº `requirements.txt`ï¼‰

 `[project.scripts]`ï¼šå‘½ä»¤è¡Œå…¥å£

```toml
[project.scripts]
mcp-server-deepresearch = "mcp_server_deepresearch:main"
```

å®šä¹‰ä¸€ä¸ª**å¯æ‰§è¡Œå‘½ä»¤è¡Œè„šæœ¬**ï¼Œç­‰ä»·äºåœ¨ç»ˆç«¯ä¸­ç›´æ¥è¿è¡Œï¼š

```bash
mcp-server-deepresearch --openai_api_key=...
```

å®ƒä¼šè‡ªåŠ¨è°ƒç”¨ä½ åŒ…å†…çš„ï¼š

```python
mcp_server_deepresearch/main.py é‡Œçš„ main() å‡½æ•°
```

ä¹Ÿæ”¯æŒï¼š

```python
mcp_server_deepresearch/__init__.py ä¸­çš„ main() å‡½æ•°
```

åªè¦æ˜¯ `main()` å‡½æ•°å³å¯ã€‚

```toml
[tool.setuptools]
package-dir = {"" = "src"}

[tool.setuptools.packages.find]
where = ["src"]
```

æ˜ç¡®å‘Šè¯‰ setuptoolsï¼š

- ä½ çš„é¡¹ç›®æºä»£ç éƒ½åœ¨ `src/` ç›®å½•ä¸‹
- è¯·å» `src/` ä¸­æŸ¥æ‰¾ Python åŒ…ï¼ˆå³åŒ…å« `__init__.py` çš„ç›®å½•ï¼‰

| åŒºå—                | ä½œç”¨                     | è¯„ä»·                                          |
| ------------------- | ------------------------ | --------------------------------------------- |
| `[build-system]`    | å‘Šè¯‰æ„å»ºå·¥å…·å¦‚ä½•æ„å»ºé¡¹ç›® | âœ… éå¸¸è§„èŒƒ                                    |
| `[project]`         | å®šä¹‰é¡¹ç›®åŸºæœ¬ä¿¡æ¯å’Œä¾èµ–   | âœ… å¯ä»¥åˆ æ‰ asyncio å’Œ typing                  |
| `[project.scripts]` | å®šä¹‰å‘½ä»¤è¡Œå·¥å…·           | âœ… å¯ç›´æ¥ç”¨ `mcp-server-deepresearch` å‘½ä»¤è¿è¡Œ |
| `[tool.setuptools]` | æŒ‡å®šæºç ä½ç½®             | âœ… ä¸ src layout å®Œç¾é…åˆ                      |

ç„¶åå¯¹æ•´ä¸ªé¡¹ç›®è¿›è¡Œæ‰“åŒ…ã€‚é¦–å…ˆéœ€è¦å®‰è£…æ‰“åŒ…ï¼ˆå’Œä¸Šä¼ ï¼‰å·¥å…·ï¼š

```bash
uv pip install build twine
```



ç„¶åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ‰“åŒ…ï¼š

```bash
# å›åˆ°é¡¹ç›®ä¸»ç›®å½•
# cd /root/autodl-tmp/MCP/mcp-server-deepresearch

# æ‰“åŒ…
python -m build
```



æ‰“åŒ…å®Œæˆåä¼šåœ¨ä¸»ç›®å½•ä¸‹æ–°å¢ä¸€ä¸ªdistæ–‡ä»¶å¤¹ï¼š



ä»¥åŠåœ¨srcç›®å½•ä¸‹ä¼šåˆ›å»ºä¸€ä¸ª.egg-infoæ–‡ä»¶å¤¹ï¼Œ



è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹å†…å®¹è§£é‡Šå¦‚ä¸‹ï¼š

-  `dist/` æ–‡ä»¶å¤¹ï¼š**æ‰“åŒ…äº§ç‰©ç›®å½•**ï¼Œä¼šåœ¨ åŒ…å«å¦‚ä¸‹æ–‡ä»¶ï¼š

| æ–‡ä»¶ç±»å‹       | è¯´æ˜                                    |
| -------------- | --------------------------------------- |
| `.whl` æ–‡ä»¶    | Python wheel æ ¼å¼çš„äºŒè¿›åˆ¶åˆ†å‘åŒ…ï¼Œæœ€å¸¸ç”¨ |
| `.tar.gz` æ–‡ä»¶ | æºä»£ç åŒ…ï¼ˆsource distributionï¼‰         |

è€Œåœ¨ç¦»çº¿éƒ¨ç½²æ—¶å€™ï¼Œåˆ«äººå®‰è£…æ—¶åªè¦ `pip install xxx.whl` å°±å¯ä»¥äº†ï¼ˆæ— éœ€æºç ï¼‰ï¼ŒåŒæ—¶ä¸Šä¼ åˆ° PyPIã€å†…ç½‘ PyPIã€AI æ¨¡å‹å¹³å°ç­‰åœ°æ–¹éƒ¨ç½²ã€‚

- `<project-name>.egg-info/` æ–‡ä»¶å¤¹ï¼š**å…ƒæ•°æ®æ–‡ä»¶å¤¹**ï¼Œè¿™ä¸ªæ˜¯ `setuptools` åœ¨æ„å»ºæˆ–æ‰“åŒ…æ—¶ç”Ÿæˆçš„ä¸€ä¸ªâ€œé¡¹ç›®å…ƒä¿¡æ¯ç›®å½•â€ã€‚æ¯”å¦‚ä¼šçœ‹åˆ°è¿™æ ·çš„ç»“æ„ï¼š

```
mcp_server_deepresearch.egg-info/
â”œâ”€â”€ PKG-INFO
â”œâ”€â”€ SOURCES.txt
â”œâ”€â”€ top_level.txt
â”œâ”€â”€ dependency_links.txt
â”œâ”€â”€ requires.txt
```

`PKG-INFO`ï¼šä½ é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ï¼ˆåç§°ã€ç‰ˆæœ¬ã€ä½œè€…ã€ä¾èµ–ç­‰ï¼‰ï¼Œ`requires.txt`ï¼šåˆ—å‡ºä¾èµ–é¡¹ï¼Œ`SOURCES.txt`ï¼šåˆ—å‡ºæ‰€æœ‰æ‰“åŒ…è¿› `.whl` çš„æ–‡ä»¶ï¼Œ`top_level.txt`ï¼šé¡¶å±‚åŒ…åï¼ˆæ¯”å¦‚ `mcp_server_deepresearch`ï¼‰ã€‚

### 2. é¡¹ç›®ç¦»çº¿æ‹·è´

â€‹	æ¥ä¸‹æ¥ç»§ç»­ä»‹ç»ç¦»çº¿æ‹·è´æµç¨‹ã€‚å‡è®¾æˆ‘ä»¬ç°åœ¨éœ€è¦ä»æœåŠ¡å™¨Aä¸ŠæŠŠé¡¹ç›®æ‹·è´åˆ°æœåŠ¡å™¨Bä¸Šï¼Œæœ€ç®€å•çš„æ–¹æ³•é¦–å…ˆæ˜¯åœ¨æœåŠ¡å™¨Aä¸Šè¿›è¡Œé¡¹ç›®å‹ç¼©ï¼š

```bash
# å›åˆ°ä¸»ç›®å½• 
# cd /root/autodl-tmp/MCP/mcp-server-deepresearch
tar --exclude='.venv' -czvf mcp-server-deepresearch.tar.gz *
```

å‹ç¼©åä¼šåˆ›å»ºä¸€ä¸ªåä¸ºmcp-server-deepresearch.tar.gzçš„æ–‡ä»¶ï¼š



å°†å…¶ä¸‹è½½åå³å¯ä¸Šä¼ åˆ°æœåŠ¡å™¨Bä¸Šï¼Œä¾‹å¦‚å°†å…¶ä¸Šä¼ åˆ°BæœåŠ¡å™¨çš„`/root/autodl-tmp/MCP/MCP-Test`è·¯å¾„ä¸‹ï¼š



ç„¶åå³å¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œè§£å‹ç¼©ï¼š

```bash
tar -xzvf mcp-server-deepresearch.tar.gz
```



ç„¶åå³å¯æ¿€æ´»è™šæ‹Ÿç¯å¢ƒå¹¶ç›¸å…³ä¾èµ–ï¼š

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
uv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate

# ä½¿ç”¨uvï¼ˆæ¨èï¼‰æˆ–pipå®‰è£…
uv pip install .
```



ç„¶åå³å¯è¿è¡ŒInspectorè¿›è¡Œæµ‹è¯•ï¼š

```bash
# è¿è¡ŒInspector
npx -y @modelcontextprotocol/inspector uv run ./src/mcp_server_deepresearch/server.py --openai_api_key YOUR_KEY
```





å®Œæ•´é¡¹ç›®å‹ç¼©åŒ…åœ¨ç½‘ç›˜ä¸­é¢†å–ï¼š





### 3. é¡¹ç›®å‘å¸ƒåˆ°pipyå¹³å°

â€‹	é™¤äº†ç¦»çº¿æ‹·è´ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠè‡ªå·±å¼€å‘å®Œæˆçš„MCP Serverå‘å¸ƒåˆ°ä¸€äº›æ‰˜ç®¡å¹³å°ä¸Šæ–¹ä¾¿å…¶ä»–äººä¸‹è½½ä½¿ç”¨ï¼Œå¦‚æœæ˜¯jså¼€å‘çš„MCP Serverå¯ä»¥å‘å¸ƒåœ¨npmå¹³å°ä¸Šï¼Œè€Œå¦‚æœæ˜¯Pythoné¡¹ç›®ï¼Œåˆ™å¯ä»¥å‘å¸ƒåœ¨pypiä¸Šã€‚æˆ‘ä»¬è¿™é‡Œä»¥pypiå‘å¸ƒæµç¨‹ä¸ºä¾‹è¿›è¡Œæ¼”ç¤ºã€‚é¦–å…ˆéœ€è¦å…ˆåœ¨pypiï¼šhttps://pypi.org/ä¸Šè¿›è¡Œè´¦å·æ³¨å†Œï¼Œç„¶åè·å–API-KEYä½œä¸ºèº«ä»½éªŒè¯ï¼Œ



ç„¶åéœ€è¦å†æ¬¡ç¡®è®¤æ‰“åŒ…å®Œæˆï¼Œå¹¶å¼€å¯ä¸Šä¼ 

```bash
# å›åˆ°é¡¹ç›®ä¸»ç›®å½•
# cd /root/autodl-tmp/MCP/mcp-server-deepresearch

# è‹¥æ­¤å‰æ‰“åŒ…å®Œæˆï¼Œåˆ™æ— éœ€å†æ¬¡æ‰“åŒ…
# python -m build

# ä¸Šä¼ åˆ°pypiå¹³å°
python -m twine upload dist/*
```



ä¸Šä¼ å®Œæˆåå³å¯åœ¨pypiä¸­æœç´¢åˆ°åŒ…çš„ä¿¡æ¯ï¼š





ç„¶åå³å¯åœ¨æœ¬åœ°æµ‹è¯•è°ƒç”¨ã€‚

â€‹	è¿™é‡Œä»¥Cherry studioä¸ºä¾‹ï¼Œå°è¯•è°ƒç”¨æˆ‘ä»¬åˆšåˆšå‘å¸ƒçš„DeepResearchåŒ…ã€‚ç‚¹å‡»æ·»åŠ æœåŠ¡å™¨ï¼š





ç„¶åè¾“å…¥MCPæœåŠ¡å™¨åç§°ï¼ˆéšæ„å¡«å†™ï¼‰ï¼Œç„¶åä½¿ç”¨uvxè¿›è¡Œä¸‹è½½ï¼ŒåŒæ—¶æ˜¯stdioé€šä¿¡æ ‡å‡†ï¼Œå¹¶åœ¨å‚æ•°ä¸­è¾“å…¥ä»¥ä¸‹ä¸‰è¡Œï¼š

```bash
mcp-server-deepresearch
--openai_api_key
YOUR_API_KEY
```



ç„¶åç‚¹å‡»å³ä¸Šæ–¹ä¿å­˜ï¼Œå³å¯å¼€å¯éªŒè¯å¹¶è‡ªåŠ¨å¼€å¯è¿™é¡¹MCPå·¥å…·ã€‚ç´§æ¥ç€åœ¨å¯¹è¯è¿‡ç¨‹ä¸­é€‰æ‹©deepresearchå·¥å…·ï¼Œåªè¦å¯¹è¯ä¸­æ˜ç¡®è¡¨è¾¾äº†å¸Œæœ›å›´ç»•æŸä¸ªé—®é¢˜è¿›è¡Œæ·±å…¥ç ”ç©¶ï¼Œæ¨¡å‹å°±ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥MCPå·¥å…·è¿›è¡Œæ·±åº¦è°ƒç ”ï¼š



å®é™…æ¼”ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š

<video src="https://ml2022.oss-cn-hangzhou.aliyuncs.com/deepresearch%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA3.mp4"></video>

> æ³¨ï¼Œå¦‚æœæ˜¯ç¦»çº¿æ‹·è´çš„é¡¹ç›®å¸Œæœ›ä½¿ç”¨cherry studioè¿›è¡Œè°ƒç”¨ï¼Œä»…éœ€åœ¨é…ç½®ä¸­å†™å…¥ï¼š
>
> ```bash
> /path/to/your/mcp-server-deepresearch
> --openai_api_key
> YOUR_API_KEY
> ```
>
> ä¹Ÿå°±æ˜¯ç¬¬ä¸€è¡Œæ”¹ä¸ºç¦»çº¿é¡¹ç›®çš„æœ¬åœ°å­˜å‚¨åœ°å€å³å¯ã€‚

> æ­¤å¤–ï¼Œè‹¥æ˜¯åœ¨Cursorä¸­è°ƒç”¨ï¼Œåˆ™å¯ä»¥å†™å…¥å¦‚ä¸‹é…ç½®ï¼š
>
> ```json
> {
> "mcpServers": {
>  "deepresearch": {
>    "command": "uvx",
>    "args": [
>      "mcp-server-deepresearch",
>      "--openai_api_key",
>      "OPENAI_API_KEY"
>    ]
>  }
> }
> ```

## å››ã€åŸºäºSSEä¼ è¾“æ–¹å¼çš„MCPæœåŠ¡å™¨åˆ›å»ºæµç¨‹

â€‹	ä»¥ä¸ŠMCPæœåŠ¡å™¨éƒ½æ˜¯stdioä¼ è¾“æ–¹å¼ï¼Œè€Œé™¤æ­¤ä¹‹å¤–ï¼Œç›®å‰MCPæœåŠ¡å™¨è¿˜æ”¯æŒSSEä¼ è¾“å’ŒåŸºäºHTTPçš„æµå¼ä¼ è¾“ã€‚è¿™ä¸¤ç§ä¼ è¾“æ–¹å¼ä¹Ÿæœ‰éå¸¸å¹¿æ³›çš„å®é™…ç”¨é€”ï¼Œæ¥ä¸‹æ¥è¯¦ç»†ä»‹ç»å¦‚ä½•æ„å»ºåŸºäºSSEå’ŒHTTPæµå¼ä¼ è¾“çš„MCPæœåŠ¡å™¨ã€‚

### 1. stdioã€SSEä¸åŸºäºHTTPçš„æµå¼ä¼ è¾“å½¢å¼å¯¹æ¯”

#### 1.1 MCPé€šä¿¡åè®®ä»‹ç»

â€‹	MCPï¼ˆModel Context Protocolï¼‰æ˜¯ä¸€ç§ä¸ºäº†ç»Ÿä¸€å¤§è§„æ¨¡æ¨¡å‹å’Œå·¥å…·é—´é€šä¿¡è€Œè®¾è®¡çš„åè®®ï¼Œå®ƒå®šä¹‰äº†æ¶ˆæ¯æ ¼å¼å’Œé€šä¿¡æ–¹å¼ã€‚MCP åè®®æ”¯æŒå¤šç§ä¼ è¾“æœºåˆ¶ï¼Œå…¶ä¸­åŒ…æ‹¬ **`stdio`ã€Server-Sent Eventsï¼ˆSSEï¼‰** å’Œ **Streamable HTTP**ã€‚æ¯ç§é€šä¿¡æ–¹æ³•åœ¨ä¸åŒçš„åº”ç”¨åœºæ™¯ä¸­å…·æœ‰ä¸åŒçš„ä¼˜åŠ£åŠ¿ï¼Œé€‚ç”¨äºä¸åŒçš„éœ€æ±‚ã€‚

#### 1.2 **Stdio ä¼ è¾“ï¼ˆStandard Input/Outputï¼‰**

â€‹	`stdio` ä¼ è¾“æ–¹å¼æ˜¯æœ€ç®€å•çš„é€šä¿¡æ–¹å¼ï¼Œé€šå¸¸åœ¨æœ¬åœ°å·¥å…·ä¹‹é—´è¿›è¡Œæ¶ˆæ¯ä¼ é€’æ—¶ä½¿ç”¨ã€‚å®ƒåˆ©ç”¨æ ‡å‡†è¾“å…¥è¾“å‡ºï¼ˆstdin/stdoutï¼‰ä½œä¸ºæ•°æ®ä¼ è¾“é€šé“ï¼Œé€‚ç”¨äºæœ¬åœ°è¿›ç¨‹é—´çš„äº¤äº’ã€‚

- **å·¥ä½œæ–¹å¼**ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šè¿‡æ ‡å‡†è¾“å…¥è¾“å‡ºæµï¼ˆstdin/stdoutï¼‰è¿›è¡Œé€šä¿¡ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€å‘½ä»¤å’Œæ•°æ®ï¼ŒæœåŠ¡å™¨æ‰§è¡Œå¹¶é€šè¿‡æ ‡å‡†è¾“å‡ºè¿”å›ç»“æœã€‚
- **åº”ç”¨åœºæ™¯**ï¼šé€‚ç”¨äºæœ¬åœ°å¼€å‘ã€å‘½ä»¤è¡Œå·¥å…·ã€è°ƒè¯•ç¯å¢ƒï¼Œæˆ–è€…æ¨¡å‹å’Œå·¥å…·æœåŠ¡åœ¨åŒä¸€è¿›ç¨‹å†…è¿è¡Œçš„æƒ…å†µã€‚

#### 1.3 **Server-Sent Eventsï¼ˆSSEï¼‰**

â€‹	SSE æ˜¯åŸºäº HTTP åè®®çš„æµå¼ä¼ è¾“æœºåˆ¶ï¼Œå®ƒå…è®¸æœåŠ¡å™¨é€šè¿‡ HTTP å•å‘æ¨é€äº‹ä»¶åˆ°å®¢æˆ·ç«¯ã€‚SSE é€‚ç”¨äºå®¢æˆ·ç«¯éœ€è¦æ¥æ”¶æœåŠ¡å™¨æ¨é€çš„åœºæ™¯ï¼Œé€šå¸¸ç”¨äºå®æ—¶æ•°æ®æ›´æ–°ã€‚

- **å·¥ä½œæ–¹å¼**ï¼šå®¢æˆ·ç«¯é€šè¿‡ HTTP GET è¯·æ±‚å»ºç«‹ä¸æœåŠ¡å™¨çš„è¿æ¥ï¼ŒæœåŠ¡å™¨ä»¥æµå¼æ–¹å¼æŒç»­å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œå®¢æˆ·ç«¯é€šè¿‡è§£ææµæ•°æ®æ¥è·å–å®æ—¶ä¿¡æ¯ã€‚

- **åº”ç”¨åœºæ™¯**ï¼šé€‚ç”¨äºéœ€è¦æœåŠ¡å™¨ä¸»åŠ¨æ¨é€æ•°æ®çš„åœºæ™¯ï¼Œå¦‚å®æ—¶èŠå¤©ã€å¤©æ°”é¢„æŠ¥ã€æ–°é—»æ›´æ–°ç­‰ã€‚

#### 1.4 **Streamable HTTP**

- MCPæ›´æ–°å…¬å‘Šï¼šhttps://modelcontextprotocol.io/development/updates

  

- Streamable HTTPåè®®å†…å®¹ï¼šhttps://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/docs/specification/2025-03-26/basic/transports.mdx#streamable-http

  

â€‹	Streamable HTTP æ˜¯ MCP åè®®ä¸­æ–°å¼•å…¥çš„ä¸€ç§ä¼ è¾“æ–¹å¼ï¼Œå®ƒåŸºäº HTTP åè®®æ”¯æŒåŒå‘æµå¼ä¼ è¾“ã€‚ä¸ä¼ ç»Ÿçš„ HTTP è¯·æ±‚å“åº”æ¨¡å‹ä¸åŒï¼ŒStreamable HTTP å…è®¸æœåŠ¡å™¨åœ¨ä¸€ä¸ªé•¿è¿æ¥ä¸­å®æ—¶å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒå¤šä¸ªè¯·æ±‚å’Œå“åº”çš„æµå¼ä¼ è¾“ã€‚

â€‹	ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMCPåªæä¾›äº†Streamable HTTPåè®®å±‚çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯è§„èŒƒäº†MCPå®¢æˆ·ç«¯åœ¨ä½¿ç”¨Streamable HTTPé€šä¿¡æ—¶çš„é€šä¿¡è§„åˆ™ï¼Œè€Œå¹¶æ²¡æœ‰æä¾›ç›¸å…³çš„SDKå®¢æˆ·ç«¯ã€‚å¼€å‘è€…åœ¨å¼€å‘Streamable HTTPæœºåˆ¶ä¸‹çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ¯”å¦‚Python httpxåº“è¿›è¡Œå¼€å‘ã€‚

- **å·¥ä½œæ–¹å¼**ï¼šå®¢æˆ·ç«¯é€šè¿‡ HTTP POST å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå¹¶å¯ä»¥æ¥æ”¶æµå¼å“åº”ï¼ˆå¦‚ JSON-RPC å“åº”æˆ– SSE æµï¼‰ã€‚å½“è¯·æ±‚æ•°æ®è¾ƒå¤šæˆ–éœ€è¦å¤šæ¬¡äº¤äº’æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡é•¿è¿æ¥å’Œåˆ†æ‰¹æ¨é€çš„æ–¹å¼è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚

- **åº”ç”¨åœºæ™¯**ï¼šé€‚ç”¨äºéœ€è¦æ”¯æŒé«˜å¹¶å‘ã€ä½å»¶è¿Ÿé€šä¿¡çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå°¤å…¶æ˜¯è·¨æœåŠ¡æˆ–è·¨ç½‘ç»œçš„åº”ç”¨ã€‚é€‚åˆé«˜å¹¶å‘çš„åœºæ™¯ï¼Œå¦‚å®æ—¶æµåª’ä½“ã€åœ¨çº¿æ¸¸æˆã€é‡‘èäº¤æ˜“ç³»ç»Ÿç­‰ã€‚

#### 1.1.4 **MCP ä¼ è¾“æ–¹å¼ä¼˜åŠ£åŠ¿å¯¹æ¯”**

| ç‰¹æ€§               | **Stdio**                | **SSE**                          | **Streamable HTTP**                |
| ------------------ | ------------------------ | -------------------------------- | ---------------------------------- |
| **é€šä¿¡æ–¹å‘**       | åŒå‘ï¼ˆä½†ä»…é™æœ¬åœ°ï¼‰       | å•å‘ï¼ˆæœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯ï¼‰           | åŒå‘ï¼ˆé€‚ç”¨äºå¤æ‚äº¤äº’ï¼‰             |
| **ä½¿ç”¨åœºæ™¯**       | æœ¬åœ°è¿›ç¨‹é—´é€šä¿¡           | å®æ—¶æ•°æ®æ¨é€ï¼Œæµè§ˆå™¨æ”¯æŒ         | è·¨æœåŠ¡ã€åˆ†å¸ƒå¼ç³»ç»Ÿã€å¤§è§„æ¨¡å¹¶å‘æ”¯æŒ |
| **æ”¯æŒå¹¶å‘è¿æ¥æ•°** | ä½                       | ä¸­ç­‰                             | é«˜ï¼ˆé€‚åˆå¤§è§„æ¨¡å¹¶å‘ï¼‰               |
| **é€‚åº”æ€§**         | å±€é™äºæœ¬åœ°ç¯å¢ƒ           | æ”¯æŒæµè§ˆå™¨ï¼Œä½†å•å‘é€šä¿¡           | é«˜çµæ´»æ€§ï¼Œæ”¯æŒæµå¼æ•°æ®ä¸è¯·æ±‚æ‰¹å¤„ç† |
| **å®ç°éš¾åº¦**       | ç®€å•ï¼Œé€‚åˆæœ¬åœ°è°ƒè¯•       | ç®€å•ï¼Œä½†æµè§ˆå™¨å…¼å®¹æ€§å’Œé•¿è¿æ¥é™åˆ¶ | å¤æ‚ï¼Œéœ€å¤„ç†é•¿è¿æ¥å’Œæµç®¡ç†         |
| **é€‚åˆçš„ä¸šåŠ¡ç±»å‹** | æœ¬åœ°å‘½ä»¤è¡Œå·¥å…·ï¼Œè°ƒè¯•ç¯å¢ƒ | å®æ—¶æ¨é€ï¼Œæ–°é—»ã€è‚¡ç¥¨ç­‰å®æ—¶æ›´æ–°   | é«˜å¹¶å‘ã€åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå®æ—¶äº¤äº’ç³»ç»Ÿ   |

ä¸‰ç§ä¼ è¾“æ–¹å¼æ€»ç»“å¦‚ä¸‹ï¼š

- **`Stdio` ä¼ è¾“**ï¼šé€‚åˆæœ¬åœ°è¿›ç¨‹ä¹‹é—´çš„ç®€å•é€šä¿¡ï¼Œé€‚åˆå‘½ä»¤è¡Œå·¥å…·æˆ–è°ƒè¯•é˜¶æ®µï¼Œä½†ä¸æ”¯æŒåˆ†å¸ƒå¼ã€‚
- **`SSE` ä¼ è¾“**ï¼šé€‚åˆå®æ—¶æ¨é€å’Œå®¢æˆ·ç«¯/æµè§ˆå™¨çš„å•å‘é€šçŸ¥ï¼Œä½†æ— æ³•æ»¡è¶³åŒå‘å¤æ‚äº¤äº’éœ€æ±‚ã€‚
- **`Streamable HTTP` ä¼ è¾“**ï¼šæœ€çµæ´»ã€æœ€å¼ºå¤§çš„é€‰é¡¹ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡å¹¶å‘ã€é«˜åº¦äº¤äº’çš„åˆ†å¸ƒå¼åº”ç”¨ç³»ç»Ÿï¼Œè™½ç„¶å®ç°è¾ƒå¤æ‚ï¼Œä½†èƒ½å¤Ÿå¤„ç†æ›´å¤æ‚çš„åœºæ™¯ã€‚

### 2. åŸºäºSSEä¼ è¾“çš„MCPæœåŠ¡å™¨åˆ›å»ºæµç¨‹

â€‹	éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›®å‰MCP SDKåªæä¾›äº†stdioå’ŒSSEä¸¤ç§ä¼ è¾“æ–¹å¼çš„å¼€å‘åº“ï¼Œè€Œæš‚æ—¶è¿˜æ²¡æœ‰æä¾›åŸºäºæµå¼HTTPä¼ è¾“çš„å¼€å‘å·¥å…·ã€‚å› æ­¤åœ¨è¿›è¡ŒMCPå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå®ç°stdioå’ŒSSEä¼ è¾“æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œä½†è¦å®ç°æµå¼ä¼ è¾“çš„HTTPæµç¨‹åˆ™ä¼šéå¸¸å¤æ‚ã€‚

â€‹	è¿™é‡Œæˆ‘ä»¬å…ˆä»‹ç»ç›¸å¯¹ç®€å•çš„SSEä¼ è¾“æ–¹å¼çš„å®ç°æ–¹æ³•ã€‚å½“æˆ‘ä»¬ä½¿ç”¨MCP Python SDKå¼€å‘MCPæœåŠ¡å™¨æ—¶ï¼Œåªéœ€è¦åœ¨æ­¤å¤„è¿›è¡Œè®¾ç½®ï¼š

```python
mcp.run(transport='sse')
```

å³å¯è®©MCPæœåŠ¡å™¨å¼€å¯SSEæ¨¡å¼ï¼Œéå¸¸ç®€å•ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥åˆ›å»ºä¸€ä¸ªæŸ¥è¯¢å¤©æ°”MCPæœåŠ¡å™¨ä¸ºä¾‹è¿›è¡Œæ¼”ç¤ºã€‚

- åˆ›å»ºé¡¹ç›®ä¸»ç›®å½•

```bash
cd /root/autodl-tmp/MCP
mkdir ./MCP-sse-test
cd ./MCP-sse-test
```

- åˆ›å»ºåŸºç¡€é¡¹ç›®ç»“æ„

```bash
uv init mcp-get-weather
cd mcp-get-weather

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
uv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate

uv add mcp httpx
```



ç„¶ååˆ é™¤ä¸»ç›®å½•ä¸‹çš„main.pyæ–‡ä»¶ï¼Œå¹¶åˆ›å»ºä»£ç æ–‡ä»¶å¤¹ï¼š

```bash
mkdir -p ./src/mcp_get_weather
cd ./src/mcp_get_weather
```

- åˆ›å»ºæœåŠ¡å™¨æ ¸å¿ƒä»£ç 

â€‹	åœ¨src/mcp_get_weatherä¸­åˆ›å»ºä¸‰ä¸ªä»£ç æ–‡ä»¶ï¼š



å…¶ä¸­server.pyä¸»è¦è´Ÿè´£è¿›è¡Œå¤©æ°”æŸ¥è¯¢ï¼Œä»£ç å¦‚ä¸‹ï¼š

```python
import json
import httpx
import argparse  
from typing import Any
from mcp.server.fastmcp import FastMCP

# åˆå§‹åŒ– MCP æœåŠ¡å™¨
mcp = FastMCP("WeatherServer")

# OpenWeather API é…ç½®
OPENWEATHER_API_BASE = "https://api.openweathermap.org/data/2.5/weather"
API_KEY = None  
USER_AGENT = "weather-app/1.0"

async def fetch_weather(city: str) -> dict[str, Any] | None:
    """
    ä» OpenWeather API è·å–å¤©æ°”ä¿¡æ¯ã€‚
    """
    if API_KEY is None:
        return {"error": "API_KEY æœªè®¾ç½®ï¼Œè¯·æä¾›æœ‰æ•ˆçš„ OpenWeather API Keyã€‚"}

    params = {
        "q": city,
        "appid": API_KEY,
        "units": "metric",
        "lang": "zh_cn"
    }
    headers = {"User-Agent": USER_AGENT}

    async with httpx.AsyncClient() as client:
        try:
            response = await client.get(OPENWEATHER_API_BASE, params=params, headers=headers, timeout=30.0)
            response.raise_for_status()
            return response.json()
        except httpx.HTTPStatusError as e:
            return {"error": f"HTTP é”™è¯¯: {e.response.status_code}"}
        except Exception as e:
            return {"error": f"è¯·æ±‚å¤±è´¥: {str(e)}"}

def format_weather(data: dict[str, Any] | str) -> str:
    """
    å°†å¤©æ°”æ•°æ®æ ¼å¼åŒ–ä¸ºæ˜“è¯»æ–‡æœ¬ã€‚
    """
    if isinstance(data, str):
        try:
            data = json.loads(data)
        except Exception as e:
            return f"æ— æ³•è§£æå¤©æ°”æ•°æ®: {e}"

    if "error" in data:
        return f"âš ï¸ {data['error']}"

    city = data.get("name", "æœªçŸ¥")
    country = data.get("sys", {}).get("country", "æœªçŸ¥")
    temp = data.get("main", {}).get("temp", "N/A")
    humidity = data.get("main", {}).get("humidity", "N/A")
    wind_speed = data.get("wind", {}).get("speed", "N/A")
    weather_list = data.get("weather", [{}])
    description = weather_list[0].get("description", "æœªçŸ¥")

    return (
        f"ğŸŒ {city}, {country}\n"
        f"ğŸŒ¡ æ¸©åº¦: {temp}Â°C\n"
        f"ğŸ’§ æ¹¿åº¦: {humidity}%\n"
        f"ğŸŒ¬ é£é€Ÿ: {wind_speed} m/s\n"
        f"ğŸŒ¤ å¤©æ°”: {description}\n"
    )

@mcp.tool()
async def query_weather(city: str) -> str:
    """
    è¾“å…¥æŒ‡å®šåŸå¸‚çš„è‹±æ–‡åç§°ï¼Œè¿”å›ä»Šæ—¥å¤©æ°”æŸ¥è¯¢ç»“æœã€‚
    """
    data = await fetch_weather(city)
    return format_weather(data)

def main():
    parser = argparse.ArgumentParser(description="Weather Server")
    parser.add_argument("--api_key", type=str, required=True, help="ä½ çš„ OpenWeather API Key")
    args = parser.parse_args()
    global API_KEY
    API_KEY = args.api_key
    mcp.run(transport='sse')

if __name__ == "__main__":
    main()
```

å…¶ä»ç„¶æ˜¯é‡‡ç”¨äº†fastmcpè¿›è¡Œåˆ›å»ºï¼Œè€Œåœ¨mcp.runä¸­è®¾ç½®äº†ä½¿ç”¨sseæ–¹å¼è¿›è¡Œä¼ è¾“ã€‚

```python
mcp.run(transport='sse')
```

æ­¤å¤–éœ€è¦åœ¨`__init__.py`ä¸­å†™å…¥

```python
from .server import main
```

è€Œåœ¨`__main__.py`ä¸­å†™å…¥ï¼š

```python
from mcp_get_weather import main

main()
```

åŒæ—¶å›åˆ°ä¸»ç›®å½•ï¼Œä¿®æ”¹é¡¹ç›®é…ç½®æ–‡ä»¶`pyproject.toml`ï¼š

```toml
[build-system]
requires = ["setuptools>=61.0", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "mcp-get-weather"
version = "0.1.5"
description = "è¾“å…¥OpenWeather-API-KEYï¼Œè·å–å¤©æ°”ä¿¡æ¯ã€‚"
readme = "README.md"
requires-python = ">=3.9"
dependencies = [
    "httpx>=0.28.1",
    "mcp>=1.6.0",
    "openai>=1.75.0",
    "python-dotenv>=1.1.0",
]

[project.scripts]
mcp-get-weather = "mcp_get_weather:main"

[tool.setuptools]
package-dir = {"" = "src"}

[tool.setuptools.packages.find]
where = ["src"]
```

è‡³æ­¤å³å®Œæˆäº†æ•´ä¸ªé¡¹ç›®çš„ä»£ç ç¼–å†™å·¥ä½œã€‚å®Œæ•´é¡¹ç›®ä»£ç å¯åœ¨ç½‘ç›˜ä¸­é¢†å–ï¼š





### 3. åŸºäºSSEçš„MCPæœåŠ¡å™¨æµ‹è¯•ä¸å‘å¸ƒæµç¨‹

#### 3.1 SSE MCPæœåŠ¡å™¨æµ‹è¯•æµç¨‹

â€‹	åŒæ ·ï¼Œæ¥ä¸‹æ¥å¯ä»¥ä½¿ç”¨Inspectorè¿›è¡ŒæœåŠ¡å™¨æ€§èƒ½æµ‹è¯•ï¼Œä½†æœ‰æ‰€ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¼€å¯MCPæœåŠ¡å™¨ï¼Œç„¶åå†å¼€å¯Inspectorï¼š

> åœ¨stdioæ¨¡å¼ä¸‹æ˜¯å¼€å¯Inspectoræ—¶åŒæ­¥å¼€å¯MCP Server

- å¼€å¯SSE MCPæœåŠ¡å™¨ï¼š

  ```bash
  # å›åˆ°é¡¹ç›®ä¸»ç›®å½•
  # cd /root/autodl-tmp/MCP/MCP-sse-test/mcp-get-weather
  
  uv run ./src/mcp_get_weather/server.py --api_key YOUR_KEY
  ```

  

- å¼€å¯Inspector

  ```bash
  # å›åˆ°é¡¹ç›®ä¸»ç›®å½•
  # cd /root/autodl-tmp/MCP/MCP-sse-test/mcp-get-weather
  
  npx -y @modelcontextprotocol/inspector uv run ./src/mcp_get_weather/server.py --api_key YOUR_KEY
  ```

  

- è¿›è¡Œæµ‹è¯•

  åŒæ ·ï¼Œå¦‚æœæ˜¯ä½¿ç”¨AutoDLï¼Œåˆ™å…ˆéœ€è¦ä½¿ç”¨éš§é“å·¥å…·å°†ç«¯å£æ˜ å°„åˆ°æœ¬åœ°è¿›è¡Œè¿è¡Œï¼š



ç„¶åæ‰“å¼€Inspectorï¼Œå¹¶é€‰æ‹©SSEæ¨¡å¼ï¼Œé€‰æ‹©é»˜è®¤è¿è¡Œåœ°å€ï¼š`http://localhost:8000/sse`ï¼Œç„¶åç‚¹å‡»connectï¼š



ç„¶åè¾“å…¥åœ°åè¿›è¡Œæµ‹è¯•ï¼š



å®Œæ•´æµ‹è¯•æµç¨‹å¦‚ä¸‹ï¼š

<video src="https://ml2022.oss-cn-hangzhou.aliyuncs.com/Inspector%E6%BC%94%E7%A4%BA1.mp4"></video>

#### 3.2 SSE MCPæœåŠ¡å™¨å‘å¸ƒä¸è°ƒç”¨æµç¨‹

â€‹	æµ‹è¯•å®Œæˆåï¼Œå³å¯ä¸Šçº¿å‘å¸ƒã€‚è¿™é‡Œä»ç„¶è€ƒè™‘å‘å¸ƒåˆ°pypiå¹³å°ï¼Œå¹¶ä½¿ç”¨cherry studioè¿›è¡Œæœ¬åœ°è°ƒç”¨æµ‹è¯•ã€‚

- æ‰“åŒ…ä¸Šä¼ ï¼š

```bash
# å›åˆ°é¡¹ç›®ä¸»ç›®å½•
# cd /root/autodl-tmp/MCP/MCP-sse-test/mcp-get-weather

uv pip install build twine
python -m build
python -m twine upload dist/*
```



- æŸ¥çœ‹å‘å¸ƒçš„åº“ï¼šhttps://pypi.org/search/?q=mcp-get-weather



- æœ¬åœ°å®‰è£…ï¼š

```bash
pip install mcp-get-weather
```



- å¼€å¯æœåŠ¡ï¼šuv run mcp-get-weather



ç„¶åå³å¯æ‰“å¼€æµè§ˆå™¨è¾“å…¥`http://localhost:8000/sse`æµ‹è¯•è¿æ¥æƒ…å†µ



> æ³¨æ„ï¼Œè¿™é‡Œåœ¨æœåŠ¡å™¨ä¸Šå¼€å¯æœåŠ¡ç„¶åæœ¬åœ°è¿æ¥ä¹Ÿå¯ä»¥ï¼Œå’Œstdioä¸åŒï¼ŒSSEæ¨¡å¼ä¸‹çš„MCPæœåŠ¡å™¨å¹¶ä¸éœ€è¦æœ¬åœ°è¿è¡Œã€‚

- ä½¿ç”¨Cherry studioè¿›è¡Œè¿æ¥

â€‹	ç„¶åå³å¯ä½¿ç”¨Cherry studioè¿æ¥SSEæ¨¡å¼ä¸‹çš„MCPæœåŠ¡å™¨ï¼Œè¿™é‡Œåªéœ€è¦è¾“å…¥æœåŠ¡å™¨åœ°å€å³å¯ï¼š



å…·ä½“æ¼”ç¤ºæ•ˆæœå¦‚ä¸‹

<video src="https://ml2022.oss-cn-hangzhou.aliyuncs.com/sse%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA.mp4"></video>

è‡³æ­¤æˆ‘ä»¬å°±å®Œæˆäº†ä¸¤ä¸ªæœåŠ¡å™¨ã€åŒæ—¶ä¹Ÿæ˜¯ä¸¤ç§ç±»å‹çš„æœåŠ¡å™¨çš„å¼€å‘ä¸éƒ¨ç½²æµç¨‹ã€‚

## äº”ã€åŸºäºHTTPæµå¼ä¼ è¾“çš„MCPæœåŠ¡å™¨åˆ›å»ºæµç¨‹

â€‹	æœ€åä¸€éƒ¨åˆ†ï¼Œè®©æˆ‘ä»¬æ¥ä»‹ç»åŸºäºHTTPæµå¼ä¼ è¾“çš„MCPæœåŠ¡å™¨åˆ›å»ºæµç¨‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡HTTPæµå¼ä¼ è¾“æ˜¯ç†è®ºä¸Šæ€§èƒ½æœ€å¥½çš„ä¼ è¾“æ–¹å¼ï¼Œä½†å¼€å‘å’Œåº”ç”¨çš„é—¨æ§›éƒ½å¾ˆå¤§ï¼Œä¸ä»…ç›®å‰MCP SDKæ²¡æœ‰HTTPæµå¼ä¼ è¾“å¼€å‘å·¥å…·ï¼Œè€Œä¸”ç›®å‰ä¸»æµçš„MCPå®¢æˆ·ç«¯ï¼Œå¦‚Cherry Studioå’ŒCursorç­‰ï¼Œå¯¹äºHTTPæµå¼ä¼ è¾“çš„MCPæœåŠ¡å™¨è°ƒç”¨æ”¯æŒéƒ½å¾ˆå·®ï¼Œå› æ­¤ç›®å‰å¯¹äºMCPæ¥è¯´ï¼ŒHTTPæµå¼ä¼ è¾“åŠŸèƒ½è¿˜å¤„äºåˆçº§é˜¶æ®µã€‚

### 1. HTTPæµå¼ä¼ è¾“åè®®

â€‹	ä¸Šé¢è°ˆåˆ°ï¼Œç›®å‰MCPçš„å„å®˜æ–¹SDKå¹¶æ²¡æœ‰æä¾›HTTPæµå¼ä¼ è¾“çš„MCPå¼€å‘å·¥å…·ï¼Œå› æ­¤HTTPæµå¼ä¼ è¾“çš„MCPæœåŠ¡å™¨å°šä¸”åœç•™åœ¨â€œåè®®é˜¶æ®µâ€ï¼Œä¹Ÿå°±æ˜¯è¯´MCPæä¾›äº†HTTPçš„ä¼ è¾“åè®®ï¼Œä½†æ²¡æœ‰æä¾›å¯¹åº”èƒ½å®Œæˆç›¸å…³åŠŸèƒ½å¼€å‘çš„SDKï¼Œå¼€å‘è€…å¦‚æœéœ€è¦åˆ›å»ºHTTPæµå¼ä¼ è¾“çš„MCPæœåŠ¡å™¨ï¼Œåˆ™éœ€è¦å…ˆç ”ç©¶MCP HTTPæµå¼ä¼ è¾“åè®®ï¼Œç„¶åæ‰‹åŠ¨åˆ›å»ºæ»¡è¶³è¯¥åè®®çš„MCP Serverã€‚æ•´ä½“æ¥çœ‹ç ”å‘éš¾åº¦è¾ƒå¤§ã€‚

â€‹	ä¸ºæ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ·±å…¥ç ”ç©¶MCPæå‡ºçš„HTTPæµå¼ä¼ è¾“åŸºæœ¬åè®®ã€‚æ•´ä¸ªåè®®å†…å®¹è¾ƒå¤šï¼Œè¿™é‡Œéœ€è¦é‡ç‚¹å…³æ³¨ä»¥ä¸‹å‡ åˆ†ææ–™ï¼š

#### 1.1 Streamable HTTPåè®®ç®€ä»‹

- æ–‡æ¡£è¿æ¥ï¼šhttps://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/docs/specification/2025-03-26/basic/transports.mdx#streamable-http



å…¶ä¸­è¯¦ç»†è¯´æ˜äº†HTTPæµå¼ä¼ è¾“çš„åŸºæœ¬åè®®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹æµç¨‹è¿›è¡Œè¯´æ˜ï¼š



#### 1.2 HTTPè¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ

- æ–‡æ¡£åœ°å€ï¼šhttps://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/docs/specification/2025-03-26/basic/lifecycle.mdx



å…¶ä¸­è¯¦ç»†ä»‹ç»äº†ä»å¼€å§‹ä¼šè¯åˆ°ç»“æŸçš„å®Œæ•´æœåŠ¡å™¨ç”Ÿå‘½å‘¨æœŸè¿›ç¨‹ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸‹å›¾è¿›è¡Œå±•ç¤ºï¼š



#### 1.3 HTTPæœåŠ¡å™¨å¤–éƒ¨å·¥å…·è°ƒç”¨è¯†åˆ«ä¸è°ƒç”¨æµç¨‹

- æ–‡æ¡£åœ°å€ï¼šhttps://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/docs/specification/2025-03-26/server/tools.mdx



å…¶ä¸­è¯¦ç»†è¯´æ˜äº†HTTPæµå¼ä¼ è¾“æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡æµç¨‹ï¼Œä»¥åŠå¤–éƒ¨å·¥å…·ä¿¡æ¯åŒæ­¥æ ¼å¼ä¸æµç¨‹ç­‰ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸‹å›¾è¿›è¡Œè¯´æ˜ï¼š



#### 1.4 HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šä¿¡æµç¨‹

â€‹	ä¸‹é¢æŒ‰ **å®¢æˆ·ç«¯é¦–æ¬¡å¯åŠ¨ âœ æˆåŠŸè¿åˆ°æœåŠ¡å™¨ âœ ç­‰å¾…ç”¨æˆ·æé—®** è¿™ä¸€å®Œæ•´è¿‡ç¨‹ï¼ŒæŠŠ **MCP Streamable HTTP çš„è¯·æ±‚â€“å“åº”é¡ºåº**ç”¨æ—¶é—´çº¿åˆ—å‡ºæ¥ï¼Œå¸®åŠ©ä½ å®Œå…¨æŒæ¡æ¯ä¸€æ­¥åœ¨å¹²ä»€ä¹ˆã€‚

- **å¯åŠ¨æ—¶ï¼š 3 æ­¥æ¡æ‰‹ï¼ˆæ— ç”¨æˆ·è¾“å…¥ï¼‰**

| æ—¶åˆ»  | HTTP          | JSON-RPC `method`           | ä½œç”¨                                                         | æœåŠ¡å™¨å…¸å‹å“åº”                                               |
| ----- | ------------- | --------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **â‘ ** | **POST /mcp** | `initialize`                | åå•†åè®®ç‰ˆæœ¬ & èƒ½åŠ›                                          | `result.protocolVersion` = `2024-11-05``result.capabilities.tools.listChanged` = `true` |
| **â‘¡** | **POST /mcp** | `notifications/initialized` | å‘Šè¯‰æœåŠ¡å™¨â€œæˆ‘å·²å°±ç»ªâ€ï¼ˆé€šçŸ¥ â‡’ æœåŠ¡å™¨åªå› **204 No Content**ï¼‰ | HTTP `204` æ— åŒ…ä½“                                            |
| **â‘¢** | **POST /mcp** | `tools/list`                | å‘æœåŠ¡å™¨è¦å·¥å…·æ¸…å•                                           | `result.tools` æ•°ç»„ + `nextCursor`                           |

- **å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡æé—®æ—¶ï¼ˆæ¨¡å‹åˆ¤æ–­è¦ç”¨å·¥å…·ï¼‰**

| æ—¶åˆ»  | HTTP          | JSON-RPC `method`   | å†…å®¹è¦ç‚¹                                                     |
| ----- | ------------- | ------------------- | ------------------------------------------------------------ |
| **â‘£** | **POST /mcp** | `tools/call`        | `params.name` = `get_weather``params.arguments.city` æˆ– `location` |
| **â‘¤** | **æµå¼å“åº”**  | `stream` / `result` | æœåŠ¡å™¨é€è¡Œæ¨é€ï¼šâ€¢ è¿›åº¦ `stream`â€¢ æˆåŠŸ `result.content[]`     |

å®¢æˆ·ç«¯åœ¨æ”¶åˆ° **â‘¤** çš„æœ€ç»ˆ `result` åï¼ŒæŠŠæ–‡æœ¬å›å¡«åˆ° LLMï¼ŒLLM å†è¾“å‡ºç»™ç»ˆç«¯â€”â€”ä½ å°±çœ‹åˆ°å¤©æ°”ç»“æœå•¦ã€‚

- **è¯¦ç»†é¡ºåºï¼ˆå¸¦çŠ¶æ€ç ï¼‰**

1. **POST /mcp â†’ 200**â€ƒ`initialize`
2. **POST /mcp â†’ 204**â€ƒ`notifications/initialized`
3. **POST /mcp â†’ 200**â€ƒ`tools/list`
4. â€”â€”ç­‰å¾…ç”¨æˆ·â€”â€”
5. **POST /mcp â†’ 200/stream**â€ƒ`tools/call` ï¼ˆæœåŠ¡å™¨ä¿æŒè¿æ¥ï¼Œé€è¡Œæ¨æµï¼‰
   - JSON ä¸€è¡Œ `{"stream": "æ­£åœ¨æŸ¥è¯¢â€¦"}â€¦`
   - JSON ä¸€è¡Œ `{"result": { "content":[â€¦] }}` â†’ æœåŠ¡å™¨éšåå…³é—­æµ

> å¦‚æœæœ‰å¤šæ¬¡å·¥å…·è°ƒç”¨ï¼Œæ­¥éª¤ â‘£â€Šâ€“â€Šâ‘¤ ä¼šé‡å¤ï¼Œæ¯æ¬¡ `id` è‡ªå¢ã€‚

å®Œæ•´æµç¨‹æ€»ç»“å¦‚ä¸‹ï¼š

| åœºæ™¯                 | æœåŠ¡å™¨åº”å½“â€¦                                                  |
| -------------------- | ------------------------------------------------------------ |
| **å®¢æˆ·ç«¯é‡æ–°è¿æ¥**   | å†èµ° â‘ â‘¡â‘¢ï¼Œæ¯è½® `initialize` ä¼šè¯ç‹¬ç«‹                         |
| **éœ€è¦åˆ†é¡µå·¥å…·**     | åœ¨ â‘¢ è¿”å› `nextCursor` â‰  `null`ï¼Œå®¢æˆ·ç«¯ä¼šç»§ç»­ `tools/list`   |
| **é€šçŸ¥å·¥å…·åˆ—è¡¨å˜æ›´** | ä¸»åŠ¨ `notifications/tools/list_changed`ï¼Œå®¢æˆ·ç«¯å†å‘ `tools/list` æ‹‰æ–°åˆ—è¡¨ |

> **JSON-RPC** æ˜¯ä¸€ç§ç”¨ JSON ç¼–å†™çš„ã€ç»“æ„åŒ–çš„è¿œç¨‹è°ƒç”¨åè®®ã€‚å…¶åŸºæœ¬æ ¼å¼ç»“æ„å¦‚ä¸‹ï¼š
>
> | ç±»å‹ | å­—æ®µ      | è¯´æ˜                                  |
> | ---- | --------- | ------------------------------------- |
> | è¯·æ±‚ | `jsonrpc` | å›ºå®šä¸º `"2.0"`                        |
> |      | `id`      | è¯·æ±‚ç¼–å·ï¼Œç”¨äºå¯¹åº”è¯·æ±‚ä¸å“åº”          |
> |      | `method`  | è¦è°ƒç”¨çš„æ–¹æ³•åï¼ˆæ¯”å¦‚ `"tools/call"`ï¼‰ |
> |      | `params`  | æ–¹æ³•å‚æ•°ï¼ˆå¯ä»¥æ˜¯å¯¹è±¡æˆ–æ•°ç»„ï¼‰          |
> | å“åº” | `jsonrpc` | ä¹Ÿè¦å†™ `"2.0"`                        |
> |      | `id`      | ä¸è¯·æ±‚çš„ ID ä¸€è‡´                      |
> |      | `result`  | æˆåŠŸè¿”å›å€¼ï¼ˆåªéœ€ resultï¼‰             |
> |      | `error`   | å¦‚æœå‡ºé”™åˆ™è¿”å› error å¯¹è±¡             |

### 2. HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨å¼€å‘æµç¨‹

- åˆ›å»ºé¡¹ç›®æ–‡ä»¶ï¼š

```bash
cd /root/autodl-tmp/MCP/MCP-sse-test
uv init mcp-weather-http
cd mcp-weather-http

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
uv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate

uv add mcp httpx fastapi
```



```bash
mkdir -p ./src/mcp_weather_http
cd ./src/mcp_weather_http
```

ç„¶ååˆ›å»º`server.py`



å¹¶å†™å…¥å¦‚ä¸‹ä»£ç ï¼š

```python
"""weather_http_server_v8.py â€“ MCP Streamable HTTP (Cherryâ€‘Studio verified)
==========================================================================
â€¢ initialize  â†’ protocolVersion + capabilities(streaming + tools.listChanged)
                + friendly instructions
â€¢ notifications/initialized â†’ ignored (204)
â€¢ tools/list  â†’ single-page tool registry (get_weather)
â€¢ tools/call  â†’ execute get_weather, stream JSON (content[])
â€¢ GET â†’ 405 (no SSE stream implemented)
"""

from __future__ import annotations

import argparse
import asyncio
import json
from typing import Any, AsyncIterator

import httpx
from fastapi import FastAPI, Request, Response, status
from fastapi.responses import StreamingResponse

# ---------------------------------------------------------------------------
# Server constants
# ---------------------------------------------------------------------------
SERVER_NAME = "WeatherServer"
SERVER_VERSION = "1.0.0"
PROTOCOL_VERSION = "2024-11-05"  # Cherry Studio current

# ---------------------------------------------------------------------------
# Weather helpers
# ---------------------------------------------------------------------------
OPENWEATHER_URL = "https://api.openweathermap.org/data/2.5/weather"
API_KEY: str | None = None
USER_AGENT = "weather-app/1.0"


async def fetch_weather(city: str) -> dict[str, Any]:
    if not API_KEY:
        return {"error": "API_KEY æœªè®¾ç½®ï¼Œè¯·æä¾›æœ‰æ•ˆçš„ OpenWeather API Keyã€‚"}
    params = {"q": city, "appid": API_KEY, "units": "metric", "lang": "zh_cn"}
    headers = {"User-Agent": USER_AGENT}
    async with httpx.AsyncClient(timeout=30.0) as client:
        try:
            r = await client.get(OPENWEATHER_URL, params=params, headers=headers)
            r.raise_for_status()
            return r.json()
        except httpx.HTTPStatusError as exc:
            return {"error": f"HTTP é”™è¯¯: {exc.response.status_code}"}
        except Exception as exc:  # noqa: BLE001
            return {"error": f"è¯·æ±‚å¤±è´¥: {exc}"}


def format_weather(data: dict[str, Any]) -> str:
    if "error" in data:
        return data["error"]
    city = data.get("name", "æœªçŸ¥")
    country = data.get("sys", {}).get("country", "æœªçŸ¥")
    temp = data.get("main", {}).get("temp", "N/A")
    humidity = data.get("main", {}).get("humidity", "N/A")
    wind = data.get("wind", {}).get("speed", "N/A")
    desc = data.get("weather", [{}])[0].get("description", "æœªçŸ¥")
    return (
        f"ğŸŒ {city}, {country}\n"
        f"ğŸŒ¡ æ¸©åº¦: {temp}Â°C\n"
        f"ğŸ’§ æ¹¿åº¦: {humidity}%\n"
        f"ğŸŒ¬ é£é€Ÿ: {wind} m/s\n"
        f"ğŸŒ¤ å¤©æ°”: {desc}"
    )


async def stream_weather(city: str, req_id: int | str) -> AsyncIterator[bytes]:
    # progress chunk
    yield json.dumps({"jsonrpc": "2.0", "id": req_id, "stream": f"æŸ¥è¯¢ {city} å¤©æ°”ä¸­â€¦"}).encode() + b"\n"

    await asyncio.sleep(0.3)
    data = await fetch_weather(city)

    if "error" in data:
        yield json.dumps({"jsonrpc": "2.0", "id": req_id, "error": {"code": -32000, "message": data["error"]}}).encode() + b"\n"
        return

    yield json.dumps({
        "jsonrpc": "2.0", "id": req_id,
        "result": {
            "content": [
                {"type": "text", "text": format_weather(data)}
            ],
            "isError": False
        }
    }).encode() + b"\n"

# ---------------------------------------------------------------------------
# FastAPI app
# ---------------------------------------------------------------------------
app = FastAPI(title="WeatherServer HTTP-Stream v8")

TOOLS_REGISTRY = {
    "tools": [
        {
            "name": "get_weather",
            "description": "ç”¨äºè¿›è¡Œå¤©æ°”ä¿¡æ¯æŸ¥è¯¢çš„å‡½æ•°ï¼Œè¾“å…¥åŸå¸‚è‹±æ–‡åç§°ï¼Œå³å¯è·å¾—å½“å‰åŸå¸‚å¤©æ°”ä¿¡æ¯ã€‚",
            "inputSchema": {
                "type": "object",
                "properties": {
                    "city": {
                        "type": "string",
                        "description": "City name, e.g. 'Hangzhou'"
                    }
                },
                "required": ["city"]
            }
        }
    ],
    "nextCursor": None
}


@app.get("/mcp")
async def mcp_initialize_via_get():
    #  GET è¯·æ±‚ä¹Ÿæ‰§è¡Œäº† initialize æ–¹æ³•
    return {
        "jsonrpc": "2.0",
        "id": 0,
        "result": {
            "protocolVersion": PROTOCOL_VERSION,
            "capabilities": {
                "streaming": True,
                "tools": {"listChanged": True}
            },
            "serverInfo": {
                "name": SERVER_NAME,
                "version": SERVER_VERSION
            },
            "instructions": "Use the get_weather tool to fetch weather by city name."
        }
    }

@app.post("/mcp")
async def mcp_endpoint(request: Request):
    try:
        body = await request.json()
        # âœ… æ‰“å°å®¢æˆ·ç«¯è¯·æ±‚å†…å®¹
        print("ğŸ’¡ æ”¶åˆ°è¯·æ±‚:", json.dumps(body, ensure_ascii=False, indent=2))
    except Exception:
        return {"jsonrpc": "2.0", "id": None, "error": {"code": -32700, "message": "Parse error"}}

    req_id = body.get("id", 1)
    method = body.get("method")
    
    # âœ… æ‰“å°å½“å‰æ–¹æ³•ç±»å‹
    print(f"ğŸ”§ æ–¹æ³•: {method}")
    
    # 0) Ignore initialized notification (no response required)
    if method == "notifications/initialized":
        return Response(status_code=status.HTTP_204_NO_CONTENT)

    # 1) Activation probe (no method)
    if method is None:
        return {"jsonrpc": "2.0", "id": req_id, "result": {"status": "MCP server online."}}

    # 2) initialize
    if method == "initialize":
        return {
            "jsonrpc": "2.0", "id": req_id,
            "result": {
                "protocolVersion": PROTOCOL_VERSION,
                "capabilities": {
                    "streaming": True,
                    "tools": {"listChanged": True}
                },
                "serverInfo": {"name": SERVER_NAME, "version": SERVER_VERSION},
                "instructions": "Use the get_weather tool to fetch weather by city name."
            }
        }

    # 3) tools/list
    if method == "tools/list":
        print(json.dumps(TOOLS_REGISTRY, indent=2, ensure_ascii=False))
        return {"jsonrpc": "2.0", "id": req_id, "result": TOOLS_REGISTRY}

    # 4) tools/call
    if method == "tools/call":
        params = body.get("params", {})
        tool_name = params.get("name")
        args = params.get("arguments", {})

        if tool_name != "get_weather":
            return {"jsonrpc": "2.0", "id": req_id, "error": {"code": -32602, "message": "Unknown tool"}}

        city = args.get("city")
        if not city:
            return {"jsonrpc": "2.0", "id": req_id, "error": {"code": -32602, "message": "Missing city"}}

        return StreamingResponse(stream_weather(city, req_id), media_type="application/json")

    # 5) unknown method
    return {"jsonrpc": "2.0", "id": req_id, "error": {"code": -32601, "message": "Method not found"}}

# ---------------------------------------------------------------------------
# Runner
# ---------------------------------------------------------------------------

def main() -> None:
    parser = argparse.ArgumentParser(description="Weather MCP HTTP-Stream v8")
    parser.add_argument("--api_key", required=True)
    parser.add_argument("--host", default="127.0.0.1")
    parser.add_argument("--port", type=int, default=8000)
    args = parser.parse_args()

    global API_KEY
    API_KEY = args.api_key

    import uvicorn
    uvicorn.run(app, host=args.host, port=args.port, log_level="info")


if __name__ == "__main__":
    main()
```

ä»£ç è§£é‡Šå¦‚ä¸‹ï¼šæ€»ä½“ç»“æ„è¯´æ˜

```text
ğŸ“¦ weather_http_server_v8.py
â”œâ”€â”€ å¸¸é‡å®šä¹‰ï¼ˆåè®®ç‰ˆæœ¬ + OpenWeather é…ç½®ï¼‰
â”œâ”€â”€ å·¥å…·æ–¹æ³•ï¼ˆfetch_weatherã€format_weatherã€stream_weatherï¼‰
â”œâ”€â”€ FastAPI è·¯ç”±
â”‚   â”œâ”€â”€ GET /mcp  â†’ å¯é€‰æ”¯æŒ
â”‚   â””â”€â”€ POST /mcp â†’ æ”¯æŒæ‰€æœ‰ JSON-RPC è°ƒç”¨
â””â”€â”€ main()        â†’ å¯åŠ¨ uvicorn æœåŠ¡å™¨
```

1ï¸âƒ£ å¤´éƒ¨ä¿¡æ¯ï¼ˆå…ƒæ•°æ® + æ¨¡å—å¼•å…¥ï¼‰

```python
"""weather_http_server_v8.py â€“ MCP Streamable HTTP (Cherryâ€‘Studio verified)
â€¢ initialize â†’ å£°æ˜ streaming + tools.listChanged èƒ½åŠ›
â€¢ tools/list â†’ æä¾› get_weather å·¥å…·
â€¢ tools/call â†’ è°ƒç”¨å stream JSON æ•°æ®
â€¢ GET â†’ 405 æˆ–ç®€å•è¿”å›ä¿¡æ¯ï¼ˆæ”¯æŒ Cherry æ¢æµ‹ï¼‰
"""
```

âœ” ç®€æ´æ˜äº†åœ°è¯´æ˜è¿™ä¸ªæœåŠ¡ç¬¦åˆ Cherry Studio æ‰€æ”¯æŒçš„ MCP HTTP åè®®å­é›†ã€‚

2ï¸âƒ£ å¸¸é‡å®šä¹‰

```python
SERVER_NAME = "WeatherServer"
SERVER_VERSION = "1.0.0"
PROTOCOL_VERSION = "2024-11-05"  # MCP è§„å®šç‰ˆæœ¬å·

OPENWEATHER_URL = "https://api.openweathermap.org/data/2.5/weather"
API_KEY: str | None = None  # å¯åŠ¨æ—¶æ³¨å…¥
USER_AGENT = "weather-app/1.0"
```

âœ” æå‰å®šä¹‰ç‰ˆæœ¬å·ã€å¤©æ°”æ¥å£ã€å…¨å±€å˜é‡ç­‰ã€‚

3ï¸âƒ£ å¤©æ°”å¤„ç†é€»è¾‘

```python
async def fetch_weather(city: str) -> dict[str, Any]:
```

- å‘ OpenWeather API è¯·æ±‚å¤©æ°”æ•°æ®
- è‡ªåŠ¨å¤„ç†é”™è¯¯ï¼ˆæ¯”å¦‚ key ä¸å¯¹ã€è¶…æ—¶ï¼‰

```python
def format_weather(data: dict[str, Any]) -> str:
```

- æŠŠåŸå§‹ JSON æ ¼å¼åŒ–æˆå¯è¯»æ–‡æœ¬ ğŸŒ¤ï¸

```python
async def stream_weather(city: str, req_id: int | str) -> AsyncIterator[bytes]:
```

- ç”Ÿæˆå™¨æµå¼è¿”å›å¤©æ°”å†…å®¹ï¼ˆç¬¦åˆ MCP åè®®çš„é€è¡Œ JSONï¼‰

ç¤ºä¾‹è¾“å‡ºï¼š

```json
{"jsonrpc": "2.0", "id": 1, "stream": "æŸ¥è¯¢ Hangzhou å¤©æ°”ä¸­â€¦"}
{"jsonrpc": "2.0", "id": 1, "result": { "content": [{"type":"text","text":"ğŸŒ¡ æ¸©åº¦: 22Â°C"}] }}
```

4ï¸âƒ£ MCP å·¥å…·æ³¨å†Œè¡¨

```python
TOOLS_REGISTRY = {
  "tools": [
    {
      "name": "get_weather",
      "description": "...",
      "inputSchema": {
        "type": "object",
        "properties": {
          "city": {
            "type": "string",
            "description": "City name, e.g. 'Hangzhou'"
          }
        },
        "required": ["city"]
      }
    }
  ],
  "nextCursor": None
}
```

âœ” ç¬¦åˆ MCP 2025-03-26 æ–‡æ¡£å¯¹ `tools/list` çš„æ ¼å¼è¦æ±‚ã€‚

5ï¸âƒ£ æ ¸å¿ƒè·¯ç”±é€»è¾‘ï¼ˆFastAPIï¼‰

âœ” `/mcp [GET]`

```python
@app.get("/mcp")
```

- Cherry Studio åœ¨æ¢æµ‹æ—¶ä¼šå‘ GET è¯·æ±‚
- æˆ‘ä»¬è¿™é‡Œè¿”å›ä¸€ä¸ª `initialize` é£æ ¼çš„å“åº”

âœ” `/mcp [POST]`

```python
@app.post("/mcp")
async def mcp_endpoint(request: Request):
```

æ•´ä¸ª MCP åè®®çš„æ ¸å¿ƒè·¯ç”±ï¼

| JSON-RPC æ–¹æ³•               | è¯´æ˜                   |
| --------------------------- | ---------------------- |
| `initialize`                | è¿”å›åè®®ç‰ˆæœ¬ã€èƒ½åŠ›åˆ—è¡¨ |
| `notifications/initialized` | æ— éœ€å“åº”ï¼ˆ204ï¼‰        |
| `tools/list`                | è¿”å›å·¥å…·æ¸…å•           |
| `tools/call`                | å¼€å§‹å¤©æ°”æŸ¥è¯¢ï¼ˆæµå¼ï¼‰   |
| æœªçŸ¥ method                 | è¿”å› `-32601` é”™è¯¯     |

6ï¸âƒ£main() å¯åŠ¨é€»è¾‘

```python
def main():
    parser.add_argument("--api_key", required=True)
    uvicorn.run(app, host=..., port=...)
```

âœ” ä»å‘½ä»¤è¡Œä¼ å…¥ OpenWeather çš„ API Key å¹¶å¯åŠ¨æœåŠ¡ã€‚

```bash
uv run ./server.py --api_key ä½ çš„key
```

### 3. HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨å¼€å¯ä¸æµ‹è¯•

â€‹	åœ¨åˆ›å»ºå®Œ`server.py`åï¼Œæˆ‘ä»¬å¯ä»¥å¼€å¯æœåŠ¡å¹¶è¿›è¡Œæµ‹è¯•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒInspectorå¹¶ä¸æ”¯æŒæµå¼ä¼ è¾“çš„MCPæœåŠ¡å™¨æµ‹è¯•ï¼Œæˆ‘ä»¬åªèƒ½åŸºäºå¯¹HTTPæµå¼ä¼ è¾“çš„åè®®ç†è§£ï¼Œåˆ›å»ºä¸€ä¸ªæµ‹è¯•æµç¨‹ã€‚

- å¼€å¯HTTPæµå¼ä¼ è¾“æœåŠ¡å™¨

  ```bash
  # å›åˆ°é¡¹ç›®ä¸»ç›®å½•
  # cd /root/autodl-tmp/MCP/MCP-sse-test/mcp-weather-http
  uv run ./src/mcp_weather_http/server.py --api_key YOUR_API_KEY
  ```



æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ **4 ä¸ª `curl` å‘½ä»¤**æ¥æ¨¡æ‹Ÿ MCP å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„æ ‡å‡†é€šä¿¡æµç¨‹ã€‚

- â‘  `initialize` è¯·æ±‚ï¼ˆèƒ½åŠ›åå•†ï¼‰

```bash
curl -X POST http://localhost:8000/mcp \
  -H "Content-Type: application/json" \
  -d '{
        "jsonrpc": "2.0",
        "id": 1,
        "method": "initialize",
        "params": {
          "protocolVersion": "2024-11-05"
        }
      }'
```

æœŸæœ›å“åº”ï¼šè¿”å›æœåŠ¡å™¨æ”¯æŒçš„åè®®ç‰ˆæœ¬ã€åŠŸèƒ½ï¼š





- â‘¡ `notifications/initialized` é€šçŸ¥ï¼ˆç¡®è®¤ä¸Šçº¿ï¼‰

```bash
curl -X POST http://localhost:8000/mcp \
  -H "Content-Type: application/json" \
  -d '{
        "jsonrpc": "2.0",
        "method": "notifications/initialized"
      }'
```

ğŸ“¥ æœŸæœ›å“åº”ï¼š`204 No Content`ï¼ˆå› ä¸ºæ˜¯é€šçŸ¥ç±»å‹ï¼‰ï¼š



- â‘¢ `tools/list` è¯·æ±‚ï¼ˆè·å–å·¥å…·æ³¨å†Œè¡¨ï¼‰

```bash
curl -X POST http://localhost:8000/mcp \
  -H "Content-Type: application/json" \
  -d '{
        "jsonrpc": "2.0",
        "id": 2,
        "method": "tools/list",
        "params": {}
      }'
```

ğŸ“¥ æœŸæœ›å“åº”ï¼šè¿”å›å·¥å…·æ¸…å•ï¼Œ `get_weather` å·¥å…·çš„ç»“æ„ä½“å’Œ schemaï¼š





- â‘£ `tools/call` è¯·æ±‚ï¼ˆè°ƒç”¨å®é™…å·¥å…·ï¼Œæµå¼è¿”å›ï¼‰

```bash
curl -N -X POST http://localhost:8000/mcp \
  -H "Content-Type: application/json" \
  -d '{
        "jsonrpc": "2.0",
        "id": 3,
        "method": "tools/call",
        "params": {
          "name": "get_weather",
          "arguments": {
            "city": "Hangzhou"
          }
        }
      }'
```

ğŸ“¥ æœŸæœ›å“åº”ï¼ˆé€è¡Œè¾“å‡ºï¼‰ï¼š





è„šæœ¬å®Œæ•´ä»£ç ï¼š





### 4. HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨Cherry Studioè°ƒç”¨æµ‹è¯•

â€‹	åœ¨åŸºæœ¬æµ‹è¯•å®ŒHTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨åŸºæœ¬åŠŸèƒ½åï¼Œæ¥ä¸‹æ¥å³å¯æ¥å…¥MCPè¿›è¡Œæµ‹è¯•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›®å‰Cherry Studioç‰ˆæœ¬æ›´æ–°è¿­ä»£è¾ƒå¿«ï¼Œéƒ¨åˆ†æƒ…å†µä¸‹å°šæ— æ³•ç¨³å®šæ”¯æŒHTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨çš„è°ƒç”¨ï¼Œå› æ­¤ä»¥ä¸‹æµç¨‹ä¸ä¸€å®šèƒ½é¡ºåˆ©å®Œæˆã€‚è‹¥ä»¥ä¸‹æµç¨‹æ— æ³•é¡ºåˆ©å®Œæˆï¼Œå¯ä»¥çœ‹ä¸‹ä¸€èŠ‚è‡ªå®šä¹‰MCP HTTPæµå¼ä¼ è¾“å®¢æˆ·ç«¯è¿›è¡Œè°ƒç”¨æµ‹è¯•ã€‚

- å·¥å…·åç§°ï¼šweather-http
- URLï¼šhttp://localhost:8000/mcp
- è¯·æ±‚å¤´ï¼šContent-Type=application/json



å…·ä½“æ¼”ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š

<video src="https://ml2022.oss-cn-hangzhou.aliyuncs.com/http%E6%B5%81%E5%BC%8F%E4%BC%A0%E8%BE%93%E6%BC%94%E7%A4%BA.mp4"></video>

### 5. è‡ªå®šä¹‰MCPå®¢æˆ·ç«¯Clientæ¥å…¥HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨

â€‹	æˆªæ­¢ç›®å‰ï¼Œä¸»æµçš„MCPå®¢æˆ·ç«¯éƒ½æ— æ³•å¾ˆå¥½çš„å®ŒæˆHTTPæµå¼MCPæœåŠ¡å™¨çš„æ¥å…¥ï¼Œå› æ­¤è¿™é‡Œä¸ºå¤§å®¶ä»‹ç»å¦‚ä½•ä»é›¶ç¼–å†™MCPå®¢æˆ·ç«¯ï¼Œå¹¶æŒ‰ç…§æ ‡å‡†æµç¨‹æ¥å…¥HTTPæµå¼MCPæœåŠ¡å™¨ã€‚

#### 5.1 ç¼–å†™client.pyè„šæœ¬

```bash
# å›åˆ°ä»£ç æ–‡ä»¶å¤¹
cd /root/autodl-tmp/MCP/MCP-sse-test/mcp-weather-http/src/mcp_weather_http
```

åˆ›å»º`client.py`ï¼š



ç„¶åå†™å…¥å¦‚ä¸‹ä»£ç ï¼š

```python
"""mcp_http_client.py â€“ Async MCP client (Streamable HTTP)
===========================================================
â€¢ å®Œå…¨ç§»é™¤ stdio ä¼ è¾“ï¼Œæ”¹ç”¨ Streamable HTTP (POST + optional SSE)
â€¢ æ”¯æŒ initialize â†’ notifications/initialized â†’ tools/list â†’ tools/call
â€¢ è‡ªåŠ¨å¤„ç† lineâ€‘delimited JSON stream (application/json æˆ– text/event-stream)
â€¢ ä¿ç•™äº¤äº’å¼ chat_loopï¼Œå…¼å®¹ OpenAI Function Calling
"""

from __future__ import annotations

import asyncio
import json
import logging
import os
from contextlib import AsyncExitStack
from typing import Any, Dict, List, Optional

import httpx
from dotenv import load_dotenv
from openai import OpenAI

################################################################################
# é€šç”¨é…ç½®åŠ è½½
################################################################################

class Configuration:
    def __init__(self) -> None:
        load_dotenv()
        self.api_key = os.getenv("LLM_API_KEY")
        self.base_url = os.getenv("BASE_URL")
        self.model = os.getenv("MODEL", "gpt-4o")
        if not self.api_key:
            raise ValueError("âŒ æœªæ‰¾åˆ° LLM_API_KEYï¼Œè¯·åœ¨ .env æ–‡ä»¶ä¸­é…ç½®")

    @staticmethod
    def load_config(path: str) -> Dict[str, Any]:
        with open(path, "r", encoding="utf-8") as f:
            return json.load(f)

################################################################################
# HTTPâ€‘based MCP Server wrapper
################################################################################

class HTTPMCPServer:
    """ä¸å•ä¸ª MCP Streamable HTTP æœåŠ¡å™¨é€šä¿¡"""

    def __init__(self, name: str, endpoint: str) -> None:
        self.name = name
        self.endpoint = endpoint.rstrip("/")  # e.g. http://localhost:8000/mcp
        self.session: Optional[httpx.AsyncClient] = None
        self.protocol_version: str = "2024-11-05"

    async def initialize(self) -> None:
        self.session = httpx.AsyncClient(timeout=httpx.Timeout(30.0))
        # 1) initialize
        init_req = {
            "jsonrpc": "2.0",
            "id": 0,
            "method": "initialize",
            "params": {
                "protocolVersion": self.protocol_version,
                "capabilities": {},
                "clientInfo": {"name": "HTTP-MCP-Demo", "version": "0.1"},
            },
        }
        r = await self._post_json(init_req)
        if "error" in r:
            raise RuntimeError(f"Initialize error: {r['error']}")
        # 2) send initialized notification (no response expected)
        await self._post_json({"jsonrpc": "2.0", "method": "notifications/initialized"})

    async def list_tools(self) -> List[Dict[str, Any]]:
        req = {"jsonrpc": "2.0", "id": 1, "method": "tools/list", "params": {}}
        res = await self._post_json(req)
        return res["result"]["tools"]

    async def call_tool_stream(self, tool_name: str, arguments: Dict[str, Any]) -> str:
        """è°ƒç”¨å·¥å…·å¹¶å°†æµå¼ç»“æœæ‹¼æ¥ä¸ºå®Œæ•´æ–‡æœ¬"""
        req = {
            "jsonrpc": "2.0",
            "id": 3,
            "method": "tools/call",
            "params": {"name": tool_name, "arguments": arguments},
        }
        assert self.session is not None
        async with self.session.stream(
            "POST", self.endpoint, json=req, headers={"Accept": "application/json"}
        ) as resp:
            if resp.status_code != 200:
                raise RuntimeError(f"HTTP {resp.status_code}")
            collected_text: List[str] = []
            async for line in resp.aiter_lines():
                if not line:
                    continue
                chunk = json.loads(line)
                if "stream" in chunk:
                    continue  # ä¸­é—´è¿›åº¦
                if "error" in chunk:
                    raise RuntimeError(chunk["error"]["message"])
                if "result" in chunk:
                    # æ ¹æ®åè®®ï¼Œæ–‡æœ¬åœ¨ result.content[0].text
                    for item in chunk["result"]["content"]:
                        if item["type"] == "text":
                            collected_text.append(item["text"])
            return "\n".join(collected_text)

    async def _post_json(self, payload: Dict[str, Any]) -> Dict[str, Any]:
        assert self.session is not None
        r = await self.session.post(self.endpoint, json=payload, headers={"Accept": "application/json"})
        if r.status_code == 204 or not r.content:
            return {}          # â† é€šçŸ¥æ— å“åº”ä½“
        r.raise_for_status()
        return r.json()

    async def close(self) -> None:
        if self.session:
            await self.session.aclose()
            self.session = None

################################################################################
# LLM å°è£…ï¼ˆOpenAI Functionâ€‘Callingï¼‰
################################################################################

class LLMClient:
    def __init__(self, api_key: str, base_url: Optional[str], model: str) -> None:
        self.client = OpenAI(api_key=api_key, base_url=base_url)
        self.model = model

    def chat(self, messages: List[Dict[str, Any]], tools: Optional[List[Dict[str, Any]]]):
        return self.client.chat.completions.create(model=self.model, messages=messages, tools=tools)

################################################################################
# å¤šæœåŠ¡å™¨ MCP + LLM Function Calling
################################################################################

class MultiHTTPMCPClient:
    def __init__(self, servers_conf: Dict[str, Any], api_key: str, base_url: Optional[str], model: str) -> None:
        self.servers: Dict[str, HTTPMCPServer] = {
            name: HTTPMCPServer(name, cfg["endpoint"]) for name, cfg in servers_conf.items()
        }
        self.llm = LLMClient(api_key, base_url, model)
        self.all_tools: List[Dict[str, Any]] = []  # è½¬ä¸º OAI FC çš„ tools æ•°ç»„

    async def start(self):
        for srv in self.servers.values():
            await srv.initialize()
            tools = await srv.list_tools()
            for t in tools:
                # é‡å‘½åä»¥åŒºåˆ†ä¸åŒæœåŠ¡å™¨
                full_name = f"{srv.name}_{t['name']}"
                self.all_tools.append({
                    "type": "function",
                    "function": {
                        "name": full_name,
                        "description": t["description"],
                        "parameters": t["inputSchema"],
                    },
                })
        logging.info("å·²è¿æ¥æœåŠ¡å™¨å¹¶æ±‡æ€»å·¥å…·ï¼š%s", [t["function"]["name"] for t in self.all_tools])

    async def call_local_tool(self, full_name: str, args: Dict[str, Any]) -> str:
        srv_name, tool_name = full_name.split("_", 1)
        srv = self.servers[srv_name]
        # å…¼å®¹ city/location
        city = args.get("city") or args.get("location")
        if not city:
            raise ValueError("Missing city/location")
        return await srv.call_tool_stream(tool_name, {"city": city})

    async def chat_loop(self):
        print("ğŸ¤– HTTP MCP + Function Calling å®¢æˆ·ç«¯å·²å¯åŠ¨ï¼Œè¾“å…¥ quit é€€å‡º")
        messages: List[Dict[str, Any]] = []
        while True:
            user = input("ä½ : ").strip()
            if user.lower() == "quit":
                break
            messages.append({"role": "user", "content": user})
            # 1st LLM call
            resp = self.llm.chat(messages, self.all_tools)
            choice = resp.choices[0]
            if choice.finish_reason == "tool_calls":
                tc = choice.message.tool_calls[0]
                tool_name = tc.function.name
                tool_args = json.loads(tc.function.arguments)
                print(f"[è°ƒç”¨å·¥å…·] {tool_name} â†’ {tool_args}")
                tool_resp = await self.call_local_tool(tool_name, tool_args)
                messages.append(choice.message.model_dump())
                messages.append({"role": "tool", "content": tool_resp, "tool_call_id": tc.id})
                resp2 = self.llm.chat(messages, self.all_tools)
                print("AI:", resp2.choices[0].message.content)
                messages.append(resp2.choices[0].message.model_dump())
            else:
                print("AI:", choice.message.content)
                messages.append(choice.message.model_dump())

    async def close(self):
        for s in self.servers.values():
            await s.close()

################################################################################
# main entry
################################################################################

async def main():
    logging.basicConfig(level=logging.INFO, format="%(asctime)s - %(levelname)s - %(message)s")
    conf = Configuration()
    servers_conf = conf.load_config("./src/mcp_weather_http/servers_config.json").get("mcpServers", {})
    client = MultiHTTPMCPClient(servers_conf, conf.api_key, conf.base_url, conf.model)
    try:
        await client.start()
        await client.chat_loop()
    finally:
        await client.close()

if __name__ == "__main__":
    asyncio.run(main())
```

å…·ä½“ä»£ç è§£é‡Šå¦‚ä¸‹ï¼šæ¨¡å—ç»“æ„æ¦‚è§ˆ

```text
mcp_http_client.py
â”œâ”€â”€ Configuration         # è¯»å– API Key å’ŒæœåŠ¡å™¨é…ç½®
â”œâ”€â”€ HTTPMCPServer         # å•ä¸ª HTTP-MCP æœåŠ¡å™¨çš„è¿æ¥é€»è¾‘
â”œâ”€â”€ LLMClient             # OpenAI Function Calling åŒ…è£…å™¨
â”œâ”€â”€ MultiHTTPMCPClient    # å¤šæœåŠ¡å™¨åè°ƒ + èŠå¤©äº¤äº’å¾ªç¯
â””â”€â”€ main()                # å¯åŠ¨å…¥å£
```

1ï¸âƒ£ `Configuration`ï¼šç¯å¢ƒå˜é‡å’Œ JSON é…ç½®åŠ è½½å™¨

```python
class Configuration:
    def __init__(self):
        load_dotenv()
        self.api_key = os.getenv("LLM_API_KEY")
        self.base_url = os.getenv("BASE_URL")
        self.model = os.getenv("MODEL", "gpt-4o")
```

âœ” æ”¯æŒä» `.env` ä¸­åŠ è½½ API keyï¼Œå¹¶è¯»å– `servers_config.json` æ¥é…ç½® MCP æœåŠ¡å™¨ï¼š

```json
{
  "mcpServers": {
    "weather": {
      "endpoint": "http://localhost:8000/mcp"
    }
  }
}
```

2ï¸âƒ£ `HTTPMCPServer`ï¼šä¸å•ä¸ª MCP æœåŠ¡å™¨äº¤äº’

è¿™æ˜¯æ¯ä¸ª MCP å·¥å…·æœåŠ¡å™¨çš„**å°åŠ©æ‰‹**ï¼Œæ”¯æŒå››ä¸ªæ ¸å¿ƒæ“ä½œï¼š

âœ” åˆå§‹åŒ– handshakeï¼ˆåˆå§‹åŒ– â†’ åˆå§‹åŒ–é€šçŸ¥ï¼‰

```python
await self._post_json({
  "method": "initialize",
  "params": {"protocolVersion": "2024-11-05", ...}
})
await self._post_json({
  "method": "notifications/initialized"
})
```

æœåŠ¡å™¨è¿”å›æ”¯æŒçš„åŠŸèƒ½åï¼Œå®¢æˆ·ç«¯è¡¨ç¤ºâ€œå‡†å¤‡å¥½äº†â€ã€‚

âœ” è·å–å·¥å…·åˆ—è¡¨

```python
await self._post_json({
  "method": "tools/list",
  "params": {}
})
```

è¿”å›æ‰€æœ‰æ”¯æŒçš„å·¥å…·å®šä¹‰ï¼ŒåŒ…æ‹¬ nameã€descriptionã€inputSchemaã€‚

âœ” å·¥å…·è°ƒç”¨ï¼ˆæµå¼è¯»å–ï¼‰

```python
async def call_tool_stream(...)
```

ä½¿ç”¨ `httpx.stream(...)` å¼€å§‹è°ƒç”¨ï¼Œé€è¡Œ `aiter_lines()` è¯»å–æœåŠ¡å™¨å“åº”ã€‚

- è·³è¿‡ `"stream"` å­—æ®µ
- æ•è· `"result"` â†’ æ‹¼æ¥æˆæ–‡æœ¬
- æŠ›å‡º `"error"` â†’ æŠ¥é”™æç¤º

ä¾‹å¦‚å¤©æ°”æœåŠ¡ä¼šé€è¡Œè¿”å›ï¼š

```json
{"stream": "æ­£åœ¨æŸ¥è¯¢"}
{"result": {"content": [{"type":"text", "text":"ğŸŒ¤ æ­å·"}]}}
```

âœ” `_post_json` æ–¹æ³•

è‡ªåŠ¨å¤„ç†ï¼š

- `204 No Content` â†’ è¿”å›ç©º `{}`ï¼Œç”¨äºé€šçŸ¥ç±»æ–¹æ³•
- é `200` â†’ æŠ¥é”™æç¤º
- è¿”å› JSON å†…å®¹ä½“

3ï¸âƒ£ `LLMClient`ï¼šOpenAI å¯¹è¯æ¥å£ï¼ˆæ”¯æŒ tools å‚æ•°ï¼‰

```python
def chat(self, messages, tools):
    return self.client.chat.completions.create(...)
```

ä¼ å…¥å†å²æ¶ˆæ¯ + toolsï¼Œè‡ªåŠ¨å¤„ç†å·¥å…·è°ƒç”¨çš„äº¤äº’ã€‚

4ï¸âƒ£ `MultiHTTPMCPClient`ï¼šåè°ƒå¤šä¸ªæœåŠ¡å™¨ + äº¤äº’æµç¨‹

âœ” `start()` åˆå§‹åŒ–é˜¶æ®µ

```python
await server.initialize()
tools = await server.list_tools()
```

- æ±‡æ€»æ‰€æœ‰ MCP å·¥å…·ï¼Œè½¬ä¸º OpenAI çš„ Function Calling æ ¼å¼
- å·¥å…·åæ”¹æˆ `weather_get_weather` è¿™æ ·çš„ç»„åˆ

âœ” `chat_loop()`ï¼šäº¤äº’ä¸»å¾ªç¯

```text
ä½ : è¯·å‘Šè¯‰æˆ‘æ­å·çš„å¤©æ°”
ğŸ¤– AI â†’ æ¨ç† â†’ è¿”å› tool_call
ğŸ” è°ƒç”¨ MCP å·¥å…· â†’ è·å–æµå¼å“åº”
ğŸ“© æŠŠç»“æœé€å› LLM â†’ è¾“å‡ºæœ€ç»ˆç»“æœ
```

- æ”¯æŒå¤šè½®å¯¹è¯
- è‡ªåŠ¨è¯†åˆ«æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·
- è‡ªåŠ¨å¤„ç†å·¥å…·å‚æ•°è§£æå’Œè°ƒç”¨é€»è¾‘

clientäº®ç‚¹æ€»ç»“ï¼š

| ç‰¹æ€§                        | è¯´æ˜                                        |
| --------------------------- | ------------------------------------------- |
| âœ… å®Œå…¨å¼‚æ­¥                  | ä½¿ç”¨ `asyncio + httpx.AsyncClient` ä¿è¯æ€§èƒ½ |
| âœ… æ”¯æŒæµå¼å·¥å…·è°ƒç”¨          | ä¸æµå¼ HTTP å·¥å…·æ— ç¼é…åˆ                    |
| âœ… æ”¯æŒå¤šæœåŠ¡å™¨              | å¯ä»¥ä¸€æ¬¡è¿å¤šä¸ª MCP æœåŠ¡ï¼Œæ‹¼æ¥ç»Ÿä¸€å·¥å…·åˆ—è¡¨   |
| âœ… æ”¯æŒ LLM Function Calling | ä¸ `gpt-4-turbo`ã€`gpt-4o` ç­‰æ¨¡å‹æ·±åº¦é›†æˆ   |
| âœ… æ”¯æŒå®¹é”™å’Œé”™è¯¯å¤„ç†        | è¿æ¥å¤±è´¥ã€è°ƒç”¨é”™è¯¯éƒ½æœ‰æ˜ç¡®æç¤º              |





#### 5.2 åˆ›å»º.envå’Œservers_config.jsonæ–‡ä»¶

â€‹	ç„¶ååœ¨srcæ–‡ä»¶å¤¹å†…åˆ›å»º.envæ–‡ä»¶ï¼Œå¹¶å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š



- BASE_URL=â€œå¤§æ¨¡å‹è¯·æ±‚åœ°å€â€
- MODEL=â€œæ¨¡å‹åç§°â€
- LLM_API_KEY=â€œAPI-KEYâ€

ç„¶ååˆ›å»º`servers_config.json`ï¼Œç”¨äºè®°å½•HTTPæµå¼ä¼ è¾“æœåŠ¡å™¨åœ°å€ï¼Œä¾‹å¦‚ï¼š

```json
{
  "mcpServers": {
    "weather": {
      "endpoint": "http://127.0.0.1:8000/mcp"
    }
  }
}
```

#### 5.3 å€ŸåŠ©è‡ªå®šä¹‰clientæ¥å…¥æµå¼HTTP MCPæœåŠ¡å™¨

- å¼€å¯æµå¼HTTP MCPæœåŠ¡å™¨

  ```bash
  uv run ./src/mcp_weather_http/server.py --api_key YOUR_API_KRI
  ```

  

- è¿è¡Œclient.pyè„šæœ¬

  ```bash
  # å›åˆ°é¡¹ç›®ä¸»ç›®å½•
  # cd /root/autodl-tmp/MCP/MCP-sse-test/mcp-weather-http
  
  uv run ./src/mcp_weather_http/client.py
  ```

- å°è¯•è¿›è¡Œé—®ç­”

  `ä½ å¥½ï¼Œå¥½ä¹…ä¸è§`

  `è¯·é—®åŒ—äº¬ä»Šå¤©å¤©æ°”å¦‚ä½•ï¼Ÿ`



- è§‚å¯ŸHTTPæµå¼ä¼ è¾“æœåŠ¡å™¨ç«¯è¿è¡Œæ•ˆæœ





---

- ä½“éªŒè¯¾å†…å®¹èŠ‚é€‰è‡ª[ã€Š2025å¤§æ¨¡å‹Agentæ™ºèƒ½ä½“å¼€å‘å®æˆ˜ã€‹(æ˜¥å­£ç­)](https://whakv.xetslk.com/s/pxKHG)å®Œæ•´ç‰ˆä»˜è´¹è¯¾ç¨‹

&emsp;&emsp;ä½“éªŒè¯¾æ—¶é—´æœ‰é™ï¼Œè‹¥æƒ³æ·±åº¦å­¦ä¹ å¤§æ¨¡å‹æŠ€æœ¯ï¼Œæ¬¢è¿å¤§å®¶æŠ¥åç”±æˆ‘ä¸»è®²çš„[ã€Š2025å¤§æ¨¡å‹Agentæ™ºèƒ½ä½“å¼€å‘å®æˆ˜ã€‹(æ˜¥å­£ç­)](https://whakv.xetslk.com/s/pxKHG)



**[ã€Š2025å¤§æ¨¡å‹Agentæ™ºèƒ½ä½“å¼€å‘å®æˆ˜ã€‹(æ˜¥å­£ç­)](https://whakv.xetslk.com/s/pxKHG)ä¸ºã€100+å°æ—¶ã€‘ä½“ç³»å¤§è¯¾ï¼Œæ€»å…±20å¤§æ¨¡å—ç²¾è®²ç²¾æï¼Œé›¶åŸºç¡€ç›´è¾¾å¤§æ¨¡å‹ä¼ä¸šçº§åº”ç”¨ï¼**





### éƒ¨åˆ†è¯¾ç¨‹æˆæœæ¼”ç¤º

- Dify+DeepSeekæ­å»ºæ™ºèƒ½å®¢æœ

<video src="https://ml2022.oss-cn-hangzhou.aliyuncs.com/2f1b47f42c65fd59e8d3a83e6cb9f13b_raw.mp4"></video>

- å¯è§†åŒ–æ•°æ®åˆ†æMulti-Agent

<video src="https://ml2022.oss-cn-hangzhou.aliyuncs.com/%E5%8F%AF%E8%A7%86%E5%8C%96%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90Multi-Agent%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA%E6%95%88%E6%9E%9C.mp4"></video>

- Ollama è‡ªåŠ¨åŒ–å¹¶å‘è¯·æ±‚æµ‹è¯•ä¸åŠ¨æ€èµ„æºç›‘æ§

<video src="https://ml2022.oss-cn-hangzhou.aliyuncs.com/3.Ollama%20%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B9%B6%E5%8F%91%E8%AF%B7%E6%B1%82%E6%B5%8B%E8%AF%95%E4%B8%8E%E5%8A%A8%E6%80%81%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7.mp4"></video>

- Neo4jå¹¶è¡Œå¤šçº¿ç¨‹å¯¼å…¥ç™¾ä¸‡çº§æ–‡æœ¬æ–¹æ³•ä¸å®è·µ

<video src="https://ml2022.oss-cn-hangzhou.aliyuncs.com/2.Neo4j%E5%B9%B6%E8%A1%8C%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AF%BC%E5%85%A5%E7%99%BE%E4%B8%87%E7%BA%A7%E6%96%87%E6%9C%AC%E6%96%B9%E6%B3%95%E4%B8%8E%E5%AE%9E%E6%88%98%E6%BC%94%E7%A4%BA.mp4"></video>

- MateGen Pro é¡¹ç›®åŠŸèƒ½æ¼”ç¤º

<video src="https://ml2022.oss-cn-hangzhou.aliyuncs.com/4.MateGen%20Pro%20%E9%A1%B9%E7%9B%AE%E5%8A%9F%E8%83%BD%E6%BC%94%E7%A4%BA.mp4"></video>

æ­¤å¤–ï¼Œè‹¥æ˜¯å¯¹å¤§æ¨¡å‹åº•å±‚åŸç†æ„Ÿå…´è¶£ï¼Œä¹Ÿæ¬¢è¿æŠ¥åç”±æˆ‘å’Œèœèœè€å¸ˆå…±åŒä¸»è®²çš„[ã€Š2025å¤§æ¨¡å‹åŸç†ä¸å®æˆ˜è¯¾ç¨‹ã€‹](https://whakv.xetslk.com/s/3p66pN)



**ä¸¤é—¨å¤§æ¨¡å‹è¯¾ç¨‹æ˜¥å­£ç­ä½“éªŒè¯¾ç‰¹æƒ æŒç»­è¿›è¡Œä¸­ï¼Œç«‹å‡2000èµ·ï¼Œåˆè´­è¿˜æœ‰æ›´å¤šä¼˜æƒ å“¦~<span style="color:red;">è¯¦ç»†ä¿¡æ¯æ‰«ç æ·»åŠ åŠ©æ•™ï¼Œå›å¤â€œå¤§æ¨¡å‹â€ï¼Œå³å¯é¢†å–è¯¾ç¨‹å¤§çº²&æŸ¥çœ‹è¯¾ç¨‹è¯¦æƒ…ğŸ‘‡</span>**

